tidyvalgen<-function(mod,obs,lbreaks=c(0,0),hbreaks=c(0,0),dir=NULL,type=NULL,tech=NULL,plotlyy=TRUE,CF=TRUE,unitsy=FALSE){

#if(max(mod)>1||max(obs)>1){{stop("please convert inputs to capacity factors", call. = TRUE, domain = NULL)}  
if (!require("tidyverse")) install.packages("tidyverse")  
if (!require("dplyr")) install.packages("dplyr")  
if (!require("plotly")) install.packages("plotly")  
if (!require("webshot")) install.packages("webshot")
if (!require("knitr")) install.packages("knitr")
if (!require("gridExtra")) install.packages("gridExtra")

  library(tidyverse)
  library(dplyr)
  library(plotly)
  library(webshot)
  library(knitr)
  library(gridExtra)
  
  filtersx<-function(x,upperl,lowerl){
  return(x<upperl & x>lowerl)
}
  
  lengthEvents<-function(x){
   r<-rle(x)
   return(r$lengths[r$values])
  }
  
  
  
binwidths <- max(obs$effekt)/100
binwidths2 <- max(obs$effekt)/9
hthres <- max(mod$effekt,obs$effekt)
#mod<-dat[which(dat$type=="model"),]
#obs<-dat[which(dat$type=="observation"),]  
if(is.null(type)){type<-1}
if(is.null(dir)){dir<-getwd()}else{dir<-paste(getwd(),"/",dir,"/",sep="")}
#if(is.null(type)){type<-total}else{type<-type}
  
#dirs<<-dir  
  
 # if(length(lbreaks)!=3){
 #    lbreaks[1]<-(ceiling(min(obs$effekt)*10)/10)+0.1
 #    lbreaks[2]<-(ceiling(min(obs$effekt)*10)/10)+0.2
 #    lbreaks[3]<-(ceiling(min(obs$effekt)*10)/10)+0.3
 # }
 #  
 # if(length(hbreaks)!=3){
 #    hbreaks[1]<-(floor(max(obs$effekt)*10)/10)-0.3
 #    hbreaks[2]<-(floor(max(obs$effekt)*10)/10)-0.2
 #    hbreaks[3]<-(floor(max(obs$effekt)*10)/10)-0.1}

 if(length(lbreaks)!=3){
    lbreaks[1]<-quantile(actual$effekt,  probs = c(0.1, 0.5, 1, 2, 5, 10, 50, NA)/100)[4]
    lbreaks[2]<-quantile(actual$effekt,  probs = c(0.1, 0.5, 1, 2, 5, 10, 50, NA)/100)[5]
    lbreaks[3]<-quantile(actual$effekt,  probs = c(0.1, 0.5, 1, 2, 5, 10, 50, NA)/100)[6]
 }
  
 if(length(hbreaks)!=3){
    hbreaks[1]<-quantile(actual$effekt,  probs = c( 95, 99, 99.9, NA)/100)[1]
    hbreaks[2]<-quantile(actual$effekt,  probs = c( 95, 99, 99.9, NA)/100)[2]
    hbreaks[3]<-quantile(actual$effekt,  probs = c( 95, 99, 99.9, NA)/100)[3]}

lbreakss<<-lbreaks
hbreakss<<-hbreaks

if(CF==TRUE){unit<-"CF"}else{unit<-"RU"}
if(unitsy==TRUE){unit2<-"MW"}else{unit2<-unit}

l1<-paste("<",lbreaks[1] ,sep="")
l2<-paste("<",lbreaks[2] ,sep="")
l3<-paste("<",lbreaks[3] ,sep="")
h1<-paste(">",hbreaks[1] ,sep="")
h2<-paste(">",hbreaks[2] ,sep="")
h3<-paste(">",hbreaks[3] ,sep="")

names(mod)<-c("date","effekt")
names(obs)<-c("date","effekt")

#yearsx<-unique(format(obs$date,"%Y"))


obsw<<-obs[which(as.numeric(format(obs$date,"%m"))<3 | as.numeric(format(obs$date,"%m")) == 12),]
obssp<-obs[which(as.numeric(format(obs$date,"%m"))>2 & as.numeric(format(obs$date,"%m")) < 6),]
obss<<-obs[which(as.numeric(format(obs$date,"%m"))>5 & as.numeric(format(obs$date,"%m")) < 9 ),]
obsa<-obs[which(as.numeric(format(obs$date,"%m"))>8 & as.numeric(format(obs$date,"%m")) < 12),]

#mod<-as_tibble(data.frame(obs$date,mod))
#names(mod)<-c("date","effekt")

modw<<-mod[which(as.numeric(format(mod$date,"%m"))<3 | as.numeric(format(mod$date,"%m")) == 12),]
modsp<-mod[which(as.numeric(format(mod$date,"%m"))>2 & as.numeric(format(mod$date,"%m")) < 6),]
mods<<-mod[which(as.numeric(format(mod$date,"%m"))>5 & as.numeric(format(mod$date,"%m")) < 9 ),]
moda<-mod[which(as.numeric(format(mod$date,"%m"))>8 & as.numeric(format(mod$date,"%m")) < 12),]

#stpsp<-c(length(modsp$date[which(as.numeric(format(modsp$date,"%Y"))==2008)]),length(modsp$date[which(as.numeric(format(modsp$date,"%Y"))==2010)]),length(modsp$date[which(as.numeric(format(modsp$date,"%Y"))==2012)]))
# stpsp<-length(modsp$date[which(as.numeric(format(modsp$date,"%Y"))==years[1])])#,length(modsp$date[which(as.numeric(format(modsp$date,"%Y"))==2010)]),length(modsp$date[which(as.numeric(format(modsp$date,"%Y"))==2012)]))
# stpw<-length(modw$date[which(as.numeric(format(modw$date,"%Y"))==years[1])])#,length(modw$date[which(as.numeric(format(modw$date,"%Y"))==2010)]),length(modw$date[which(as.numeric(format(modw$date,"%Y"))==2012)]))
# stps<-length(mods$date[which(as.numeric(format(mods$date,"%Y"))==years[1])])#,length(mods$date[which(as.numeric(format(mods$date,"%Y"))==2010)]),length(mods$date[which(as.numeric(format(mods$date,"%Y"))==2012)]))
# stpa<-length(moda$date[which(as.numeric(format(moda$date,"%Y"))==years[1])])#,length(moda$date[which(as.numeric(format(moda$date,"%Y"))==2010)]),length(moda$date[which(as.numeric(format(moda$date,"%Y"))==2012)]))
# 
# stposp<-length(obssp$date[which(as.numeric(format(obssp$date,"%Y"))==yearsx[1])])#,length(obssp$date[which(as.numeric(format(obssp$date,"%Y"))==2010)]),length(obssp$date[which(as.numeric(format(obssp$date,"%Y"))==2012)]))
# stpow<-length(obsw$date[which(as.numeric(format(obsw$date,"%Y"))==years[1])])#,length(obsw$date[which(as.numeric(format(obsw$date,"%Y"))==2010)]),length(obsw$date[which(as.numeric(format(obsw$date,"%Y"))==2012)]))
# stpos<-length(obss$date[which(as.numeric(format(obss$date,"%Y"))==years[1])])#,length(obss$date[which(as.numeric(format(obss$date,"%Y"))==2010)]),length(obss$date[which(as.numeric(format(obss$date,"%Y"))==2012)]))
# stpoa<-length(obsa$date[which(as.numeric(format(obsa$date,"%Y"))==years[1])])#,length(obsa$date[which(as.numeric(format(obsa$date,"%Y"))==2010)]),length(obsa$date[which(as.numeric(format(obsa$date,"%Y"))==2012)]))

# lapply(1:length(years),function(i,obs,yearsx){
#     stposp<-length(obs$date[which(as.numeric(format(obs$date,"%Y"))==yearsx[i])])},obs=obssp,yearsx=yearsx)
       

dct<<-as_tibble(data.frame(obs,mod))
names(dct)<-c("date","effektobs","date2", "modeffekt")


  ############ basic measures
bcor<-cor(mod$effekt,obs$effekt)

bnmae<-mean(abs(mod$effekt-obs$effekt))/mean(obs$effekt)

#rmse
#%rmse
bnrmse<-sqrt(mean((mod$effekt-obs$effekt)^2))/mean(obs$effekt)
bn<-length(mod$effekt)

#%rmse


#w

wcor<-cor(modw$effekt,obsw$effekt)

wnmae<-mean(abs(modw$effekt-obsw$effekt))/mean(obsw$effekt)
#rmse
#sqrt(mean((modw$effekt-obsw$effekt)^2))
#%rmse
wnrmse<-sqrt(mean((modw$effekt-obsw$effekt)^2))/mean(obsw$effekt)
wn<-length(modw$effekt)

#sp

spcor<-cor(modsp$effekt,obssp$effekt)

spnmae<-mean(abs(modsp$effekt-obssp$effekt))/mean(obssp$effekt)
#rmse
#sqrt(mean((modsp$effekt-obssp$effekt)^2))
#%rmse
sprmse<-sqrt(mean((modsp$effekt-obssp$effekt)^2))/mean(obssp$effekt)
spn<-length(modsp$effekt)
#s

scor<-cor(mods$effekt,obss$effekt)

snmae<-mean(abs(mods$effekt-obss$effekt))/mean(obss$effekt)
#rmseobss
#sqrt(mean((mods$effekt-obss$effekt)^2))
#%rmse
snrmse<-sqrt(mean((mods$effekt-obss$effekt)^2))/mean(obss$effekt)
sn<-length(mods$effekt)

#a

acor<-cor(moda$effekt,obsa$effekt)

anmae<-mean(abs(moda$effekt-obsa$effekt))/mean(obsa$effekt)
#rmse
#sqrt(mean((moda$effekt-obsa$effekt)^2))
#%rmse
anrmse<-sqrt(mean((moda$effekt-obsa$effekt)^2))/mean(obsa$effekt)
an<-length(moda$effekt)

##aggregated

ttt<-format(dct$date,"%Y%m")
ttt1<-format(dct$date,"%Y%m%d")
ttt2<-format(dct$date,"%H")
ttt4<-format(dct$date,"%Y")

ag_mon<-aggregate(dct$modeffekt,by=list(ttt),sum)
ag_mon2<-aggregate(dct$effektobs,by=list(ttt),sum)
bmcor<-cor(ag_mon[,2],ag_mon2[,2])
bmnmae<-mean(abs(ag_mon[,2]-ag_mon2[,2]))/mean(ag_mon2[,2])
bmnrmse<-sqrt(mean((ag_mon[,2]-ag_mon2[,2])^2))/mean(ag_mon2[,2])
nm<-length(ag_mon2$x)

ag_day<-aggregate(dct$modeffekt,by=list(ttt1),sum)
ag_day2<-aggregate(dct$effektobs,by=list(ttt1),sum)
bdcor<-cor(ag_day[,2],ag_day2[,2])
bdnmae<-mean(abs(ag_day[,2]-ag_day2[,2]))/mean(ag_day2[,2])
bdnrmse<-sqrt(mean((ag_day[,2]-ag_day2[,2])^2))/mean(ag_day2[,2])
nd<-length(ag_day2$x)

dtb<-data.frame(rbind(bcor,bnmae,bnrmse,bn),rbind(bdcor,bdnmae,bdnrmse,nd))
names(dtb)<-c("Hourly","Daily")
rownames(dtb)<-c("correlation","NMAE","NRMSE","n")

png(paste("",dir,"dtb.png",sep=""), height = 50*nrow(dtb), width = 200*ncol(dtb))
grid.table(dtb)
dev.off()

# kb<-kable(dtb,digits=2)
# kb
# write(kb,file='kb.html')

#w
dctw<-as_tibble(data.frame(obsw,modw))
dctw$date<-1:nrow(dctw)
names(dctw)<-c("no","effektobs","date","modeffekt")
ttt<-format(dctw$date,"%Y%m")
ttt1<-format(dctw$date,"%Y%m%d")
ttt4<-format(dctw$date,"%Y")

ag_mon<-aggregate(dctw$modeffekt,by=list(ttt),sum)
ag_mon2<-aggregate(dctw$effektobs,by=list(ttt),sum)
wmcor<-cor(ag_mon[,2],ag_mon2[,2])
wmnmae<-mean(abs(ag_mon[,2]-ag_mon2[,2]))/mean(ag_mon2[,2])
wmnrmse<-sqrt(mean((ag_mon[,2]-ag_mon2[,2])^2))/mean(ag_mon2[,2])
wnm<-length(ag_mon2$x)

ag_day<-aggregate(dctw$modeffekt,by=list(ttt1),sum)
ag_day2<-aggregate(dctw$effektobs,by=list(ttt1),sum)
wdcor<-cor(ag_day[,2],ag_day2[,2])
wdnmae<-mean(abs(ag_day[,2]-ag_day2[,2]))/mean(ag_day2[,2])
wdnrmse<-sqrt(mean((ag_day[,2]-ag_day2[,2])^2))/mean(ag_day2[,2])
wnd<-length(ag_day2$x)

#sp
dctsp<-as_tibble(data.frame(obssp,modsp))
dctsp$date<-1:nrow(dctsp)
names(dctsp)<-c("no","effektobs","date","modeffekt")
ttt<-format(dctsp$date,"%Y%m")
ttt1<-format(dctsp$date,"%Y%m%d")
ttt4<-format(dctsp$date,"%Y")

ag_mon<-aggregate(dctsp$modeffekt,by=list(ttt),sum)
ag_mon2<-aggregate(dctsp$effektobs,by=list(ttt),sum)
spmcor<-cor(ag_mon[,2],ag_mon2[,2])
spmnmae<-mean(abs(ag_mon[,2]-ag_mon2[,2]))/mean(ag_mon2[,2])
spmnrmse<-sqrt(mean((ag_mon[,2]-ag_mon2[,2])^2))/mean(ag_mon2[,2])
spnm<-length(ag_mon2$x)

ag_day<-aggregate(dctsp$modeffekt,by=list(ttt1),sum)
ag_day2<-aggregate(dctsp$effektobs,by=list(ttt1),sum)
spdcor<-cor(ag_day[,2],ag_day2[,2])
spdnmae<-mean(abs(ag_day[,2]-ag_day2[,2]))/mean(ag_day2[,2])
spdnrmse<-sqrt(mean((ag_day[,2]-ag_day2[,2])^2))/mean(ag_day2[,2])
spnd<-length(ag_day2$x)

#s
dcts<-as_tibble(data.frame(obss,mods))
dcts$date<-1:nrow(dcts)
names(dcts)<-c("no","effektobs","date","modeffekt")
ttt<-format(dcts$date,"%Y%m")
ttt1<-format(dcts$date,"%Y%m%d")
ttt4<-format(dcts$date,"%Y")

ag_mon<-aggregate(dcts$modeffekt,by=list(ttt),sum)
ag_mon2<-aggregate(dcts$effektobs,by=list(ttt),sum)
smcor<-cor(ag_mon[,2],ag_mon2[,2])
smnmae<-mean(abs(ag_mon[,2]-ag_mon2[,2]))/mean(ag_mon2[,2])
smnrmse<-sqrt(mean((ag_mon[,2]-ag_mon2[,2])^2))/mean(ag_mon2[,2])
snm<-length(ag_mon2$x)

ag_day<-aggregate(dcts$modeffekt,by=list(ttt1),sum)
ag_day2<-aggregate(dcts$effektobs,by=list(ttt1),sum)
sdcor<-cor(ag_day[,2],ag_day2[,2])
sdnmae<-mean(abs(ag_day[,2]-ag_day2[,2]))/mean(ag_day2[,2])
sdnrmse<-sqrt(mean((ag_day[,2]-ag_day2[,2])^2))/mean(ag_day2[,2])
snd<-length(ag_day2$x)

# ag_y<-aggregate(dcts$modeffekt,by=list(ttt4),sum)
# ag_y2<-aggregate(dcts$effektobs,by=list(ttt4),sum)
# cor(ag_y[,2],ag_y2[,2])
# mean(abs(ag_y[,2]-ag_y2[,2]))/mean(ag_y2[,2])
# sqrt(mean((ag_y[,2]-ag_y2[,2])^2))/mean(ag_y2[,2])

#a
dcta<-as_tibble(data.frame(obsa,moda))
dcta$date<-1:nrow(dcta)
names(dcta)<-c("no","effektobs","date","modeffekt")
ttt<-format(dcta$date,"%Y%m")
ttt1<-format(dcta$date,"%Y%m%d")
ttt4<-format(dcta$date,"%Y")

ag_mon<-aggregate(dcta$modeffekt,by=list(ttt),sum)
ag_mon2<-aggregate(dcta$effektobs,by=list(ttt),sum)
amcor<-cor(ag_mon[,2],ag_mon2[,2])
amnmae<-mean(abs(ag_mon[,2]-ag_mon2[,2]))/mean(ag_mon2[,2])
amnrmse<-sqrt(mean((ag_mon[,2]-ag_mon2[,2])^2))/mean(ag_mon2[,2])
anm<-length(ag_mon2$x)

ag_day<-aggregate(dcta$modeffekt,by=list(ttt1),sum)
ag_day2<-aggregate(dcta$effektobs,by=list(ttt1),sum)
adcor<-cor(ag_day[,2],ag_day2[,2])
adnmae<-mean(abs(ag_day[,2]-ag_day2[,2]))/mean(ag_day2[,2])
adnrmse<-sqrt(mean((ag_day[,2]-ag_day2[,2])^2))/mean(ag_day2[,2])
and<-length(ag_day2$x)

# ag_y<-aggregate(dcta$modeffekt,by=list(ttt4),sum)
# ag_y2<-aggregate(dcta$effektobs,by=list(ttt4),sum)
# cor(ag_y[,2],ag_y2[,2])
# mean(abs(ag_y[,2]-ag_y2[,2]))/mean(ag_y2[,2])
# sqrt(mean((ag_y[,2]-ag_y2[,2])^2))/mean(ag_y2[,2])

stb<-data.frame(rbind(wdcor,wmcor),rbind(wdnmae,wmnmae),rbind(wdnrmse,wmnrmse),rbind(wnd,wnm),rbind(spdcor,spmcor),rbind(spdnmae,spmnmae),rbind(spdnrmse,spmnrmse),rbind(spnd,spnm),rbind(sdcor,smcor),rbind(sdnmae,smnmae),rbind(sdnrmse,smnrmse),rbind(snd,snm),rbind(adcor,amcor),rbind(adnmae,amnmae),rbind(adnrmse,amnrmse),rbind(and,anm))
names(stb)<-rep(c("correlation","NMAE","NRMSE","n"),4)
rownames(stb)<-c("Hourly","Monthly")

png(paste("",dir,"stb.png",sep=""), height = 50*nrow(stb), width = 200*ncol(stb))
grid.table(stb)
dev.off()

# sb<-kable(stb,digits=2)
# sb
# write(sb,file='sb.html')

########################### basic plotting ######################################

theme<-theme_set(theme_classic(base_size = 10))

if(type==1||type==2){

p20 <- ggplot() +
  geom_line(data=dct,aes(x=date,y=effektobs, color="Observations"))+
  geom_line(data=dct,aes(x=date,y=modeffekt, color="Model"))+
  theme(legend.title=element_blank())+
  xlab("Generation Date")+
  ylab(paste(unit2))+
  scale_color_manual(values=c("Observations"="green",
                              "Model"="orange"))

p20  

ggsave(paste("",dir,"1yrcap.png",sep=""))
print("saved 1.image")

p21 <- ggplot() +
  geom_line(data=dct[1:1000,],aes(x=date,y=effektobs, color="Observations"))+
  geom_line(data=dct[1:1000,],aes(x=date,y=modeffekt, color="Model"))+
  theme(legend.title=element_blank())+
  ylab(paste(unit2))+
  xlab("Generation Date")+
  scale_color_manual(values=c("Observations"="green",
                              "Model"="orange"))

p21  

ggsave(paste("",dir,"1000hcap.png",sep=""))
print("saved 2.image")

}

if(type==1||type==3){

# p43 <- ggplot() +
#   geom_line(data=dcts[which(as.numeric(format(dcts$date,"%Y"))<=years[1]),],aes(x=date,y=effektobs, color="Observations"))+
#   geom_line(data=dcts[which(as.numeric(format(dcts$date,"%Y"))<=years[1]),],aes(x=date,y=modeffekt, color="Model"))+
#   theme(legend.title=element_blank())+
#   ylab("Capacity Factor")+
#   xlab("Generation Date")+
#   scale_color_manual(values=c("Observations"="green",
#                               "Model"="orange"))
# 
# p43  
# 
# ggsave(paste("",dir,"1ycapsum.png",sep=""))

#dcts[which(as.numeric(format(dcts$date,"%Y"))>2009),]

# p44 <- ggplot() +
#   geom_line(data=dcts[which(as.numeric(format(dcts$date,"%Y"))>=years[1]),],aes(x=date,y=effektobs, color="Observations"))+
#   geom_line(data=dcts[which(as.numeric(format(dcts$date,"%Y"))>=years[1]),],aes(x=date,y=modeffekt, color="Model"))+
#   theme(legend.title=element_blank())+
#   ylab("Capacity Factor")+
#   xlab("Generation Date")+
#   scale_color_manual(values=c("Observations"="green", 
#                               "Model"="orange"))
# 
# p44 
# 
# ggsave(paste("",dir,"1ycapsum.png",sep=""))

# p45 <- ggplot() +
#   geom_line(data=dcts[which(as.numeric(format(dcts$date,"%Y"))>=years[1] & as.numeric(format(dcts$date,"%Y"))>=years[1]),],aes(x=date,y=effektobs, color="Observations"))+
#   geom_line(data=dcts[which(as.numeric(format(dcts$date,"%Y"))>=years[1] & as.numeric(format(dcts$date,"%Y"))>=years[1]),],aes(x=date,y=modeffekt, color="Model"))+
#   theme(legend.title=element_blank())+
#   ylab("Capacity Factor")+
#   xlab("Generation Date")+
#   scale_color_manual(values=c("Observations"="green", 
#                               "Model"="orange"))
# 
# p45 
# 
# ggsave(paste("",dir,"1ycapsum.png",sep=""))
try(
p46 <- ggplot() +
  geom_line(data=dctw[30:100,],aes(x=date,y=effektobs, color="Observations"))+
  geom_line(data=dctw[30:100,],aes(x=date,y=modeffekt, color="Model"))+
  theme(legend.title=element_blank())+
  ylab(paste(unit2))+
  xlab("Generation Date")+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))
)
try(p46) 

try(ggsave(paste("",dir,"100hcap.png",sep="")))
try(print("saved 3.image"))

}

################### histogram overlay

if(type==1||type==2){
  
p22 <- ggplot() +
  geom_histogram(data=dct,aes(x=effektobs, fill="Observations"),alpha=0.6,position="identity", binwidth=binwidths)+
  geom_histogram(data=dct,aes(x=modeffekt, fill="Model"),alpha=0.6,position="identity", binwidth=binwidths)+
  theme(legend.title=element_blank())+
  xlab(paste(unit2))+
  ylab("Frequency")+
  scale_fill_manual(values=c("Observations"="green", "Model"="orange"))+
  scale_color_manual(values=c("Observations"="green",
                              "Model"="orange"))
p22

ggsave(paste("",dir,"histoverlaytot.png",sep=""))
print("saved 4.image")

}

#winter
if(type==1||type==3){
dctw<<-as_tibble(data.frame(obsw,modw))
dctw$date<-1:nrow(dctw)
names(dctw)<-c("date","effektobs","date2","modeffekt")

p31 <- ggplot() +
  geom_histogram(data=dctw,aes(x=effektobs, fill="Observations"),alpha=0.6,position="identity", binwidth=binwidths)+
  geom_histogram(data=dctw,aes(x=modeffekt, fill="Model"),alpha=0.6,position="identity", binwidth=binwidths)+
  theme(legend.title=element_blank())+
  xlab(paste(unit2))+
  ylab("Frequency")+
  scale_fill_manual(values=c("Observations"="green",  "Model"="orange"))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))
p31

ggsave(paste("",dir,"histoverlaywin.png",sep=""))
print("saved 5.image")

#spring

dctsp<<-as_tibble(data.frame(obssp,modsp))
dctsp$date<-1:nrow(dctsp)
names(dctsp)<-c("date","effektobs","date2","modeffekt")

p32 <- ggplot() +
  geom_histogram(data=dctsp,aes(x=effektobs, fill="Observations"),alpha=0.6,position="identity", binwidth=binwidths)+
  geom_histogram(data=dctsp,aes(x=modeffekt, fill="Model"),alpha=0.6,position="identity", binwidth=binwidths)+
  theme(legend.title=element_blank())+
  xlab(paste(unit2))+
  ylab("Frequency")+
  scale_fill_manual(values=c("Observations"="green",  "Model"="orange"))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))
p32

ggsave(paste("",dir,"histoverlayspr.png",sep=""))
print("saved 6.image")

#summer

dcts<<-as_tibble(data.frame(obss,mods))
dcts$date<-1:nrow(dcts)
names(dcts)<-c("date","effektobs","date2","modeffekt")

p30 <- ggplot() +
  geom_histogram(data=dcts,aes(x=effektobs, fill="Observations"),alpha=0.6,position="identity", binwidth=binwidths)+
  geom_histogram(data=dcts,aes(x=modeffekt, fill="Model"),alpha=0.6,position="identity", binwidth=binwidths)+
  theme(legend.title=element_blank())+
  xlab(paste(unit2))+
  ylab("Frequency")+
  scale_fill_manual(values=c("Observations"="green",  "Model"="orange"))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))
p30

ggsave(paste("",dir,"histoverlaysum.png",sep=""))
print("saved 7.image")

#autumn

dcta<<-as_tibble(data.frame(obsa,moda))
dcta$date<-1:nrow(dcta)
names(dcta)<-c("date","effektobs","date2","modeffekt")

p33 <- ggplot() +
  geom_histogram(data=dcta,aes(x=effektobs, fill="Observations"),alpha=0.6,position="identity", binwidth=binwidths)+
  geom_histogram(data=dcta,aes(x=modeffekt, fill="Model"),alpha=0.6,position="identity", binwidth=binwidths)+
  theme(legend.title=element_blank())+
  xlab(paste(unit2))+
  ylab("Frequency")+
  scale_fill_manual(values=c("Observations"="green",  "Model"="orange"))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))
p33
ggsave(paste("",dir,"histoverlayaut.png",sep=""))
print("saved 8.image")

# p22 <- ggplot() +
#   geom_histogram(data=dct,aes(x=effektobs, fill="red"),alpha=0.2)
#   
# p22 <- ggplot() +
#   geom_histogram(data=dct,aes(x=modeffekt, fill=mycol),alpha=0.2)
# 
# p22 
}
###########Duration of High and Low Generation Events####################
if(type==1){
#  perslowobs<-lengthEvents(filtersx(obs$effekt,lbreaks[1],-1))
#  mlobs<-mean(perslowobs)
#  maxlobs<-max(perslowobs)
#  m24lobs<-mean(perslowobs[which(perslowobs>=24)])
#  flobs<-length(which(filtersx(obs$effekt,lbreaks[1],-1)==TRUE))
#  f24lobs<-length(perslowobs[which(perslowobs>=24)])
# 
# perslow1obs<-lengthEvents(filtersx(obs$effekt,lbreaks[2],-1))
# mlobs1<-mean(perslow1obs)
# maxlobs1<-max(perslow1obs)
# m24lobs1<-mean(perslow1obs[which(perslow1obs>=24)])
# flobs1<-length(which(filtersx(obs$effekt,lbreaks[2],-1)==TRUE))
# f24lobs1<-length(perslow1obs[which(perslow1obs>=24)])
# 
# perslow2obs<-lengthEvents(filtersx(obs$effekt,lbreaks[3],-1))
# mlobs2<-mean(perslow2obs)
# maxlobs2<-max(perslow2obs)
# m24lobs2<-mean(perslow2obs[which(perslow2obs>=24)])
# flobs2<-length(which(filtersx(obs$effekt,lbreaks[3],-1)==TRUE))
# f24lobs2<-length(perslow2obs[which(perslow2obs>=24)])
# 
# perslowmod<-lengthEvents(filtersx(mod$effekt,lbreaks[1],-1))
# mlmod<-mean(perslowmod)
# maxlmod<-max(perslowmod)
# m24lmod<-mean(perslowmod[which(perslowmod>=24)])
# flmod<-length(which(filtersx(mod$effekt,lbreaks[1],-1)==TRUE))
# f24lmod<-length(perslowmod[which(perslowmod>=24)])
# 
# perslow1mod<-lengthEvents(filtersx(mod$effekt,lbreaks[2],-1))
# mlmod1<-mean(perslow1mod)
# maxlmod1<-max(perslow1mod)
# m24lmod1<-mean(perslow1mod[which(perslow1mod>=24)])
# flmod1<-length(which(filtersx(mod$effekt,lbreaks[2],-1)==TRUE))
# f24lmod1<-length(perslow1mod[which(perslow1mod>=24)])
# 
# perslow2mod<-lengthEvents(filtersx(mod$effekt,lbreaks[3],-1))
# mlmod2<-mean(perslow2mod)
# maxlmod2<-max(perslow2mod)
# m24lmod2<-mean(perslow2mod[which(perslow2mod>=24)])
# flmod2<-length(which(filtersx(mod$effekt,lbreaks[3],-1)==TRUE))
# f24lmod2<-length(perslow2mod[which(perslow2mod>=24)])
# 
# pershighobs<<-lengthEvents(filtersx(obs$effekt,hthres,hbreaks[1]))
# mhobs<-mean(pershighobs)
# maxhobs<-max(pershighobs)
# m24hobs<-mean(pershighobs[which(pershighobs>=24)])
# fhobs<-length(which(filtersx(obs$effekt,hthres,hbreaks[1])==TRUE))
# f24hobs<-length(pershighobs[which(pershighobs>=24)])
# 
# pershigh1obs<<-lengthEvents(filtersx(obs$effekt,hthres,hbreaks[2]))
# mhobs1<-mean(pershigh1obs)
# maxhobs1<-max(pershigh1obs)
# m24hobs1<-mean(pershigh1obs[which(pershigh1obs>=24)])
# fhobs1<-length(which(filtersx(obs$effekt,hthres,hbreaks[2])==TRUE))
# f24hobs1<-length(pershigh1obs[which(pershigh1obs>=24)])
# 
# pershigh2obs<<-lengthEvents(filtersx(obs$effekt,hthres,hbreaks[3]))
# mhobs2<-mean(pershigh2obs)
# maxhobs2<-max(pershigh2obs)
# m24hobs2<-mean(pershigh2obs[which(pershigh2obs>=24)])
# fhobs2<-length(which(filtersx(obs$effekt,hthres,hbreaks[3])==TRUE))
# f24hobs2<-length(pershigh2obs[which(pershigh2obs>=24)])
# 
# pershighmod<<-lengthEvents(filtersx(mod$effekt,hthres,hbreaks[1]))
# mhmod<-mean(pershighmod)
# maxhmod<-max(pershighmod)
# m24hmod<-mean(pershighmod[which(pershighmod>=24)])
# fhmod<-length(which(filtersx(mod$effekt,hthres,hbreaks[1])==TRUE))
# f24hmod<-length(pershighmod[which(pershighmod>=24)])
# 
# pershigh1mod<<-lengthEvents(filtersx(mod$effekt,hthres,hbreaks[2]))
# mhmod1<-mean(pershigh1mod)
# maxhmod1<-max(pershigh1mod)
# m24hmod1<-mean(pershigh1mod[which(pershigh1mod>=24)])
# fhmod1<-length(which(filtersx(mod$effekt,hthres,hbreaks[2])==TRUE))
# f24hmod1<-length(pershigh1mod[which(pershigh1mod>=24)])
# 
# pershigh2mod<<-lengthEvents(filtersx(mod$effekt,hthres,hbreaks[3]))
# mhmod2<-mean(pershigh2mod)
# maxhmod2<-max(pershigh2mod)
# m24hmod2<-mean(pershigh2mod[which(pershigh2mod>=24)])
# fhmod2<-length(which(filtersx(mod$effekt,hthres,hbreaks[3])==TRUE))
# f24hmod2<-length(pershigh2mod[which(pershigh2mod>=24)])
# 
# dft<-data.frame(rbind(flmod,mlmod,maxlmod,flobs,mlobs,maxlobs),rbind(flmod1,mlmod1,maxlmod1,flobs1,mlobs1,maxlobs1),rbind(flmod2,mlmod2,maxlmod2,flobs2,mlobs2,maxlobs2),rbind(fhmod,mhmod,maxhmod,fhobs,mhobs,maxhobs),rbind(fhmod1,mhmod1,maxhmod1,fhobs1,mhobs1,maxhobs1),rbind(fhmod2,mhmod2,maxhmod2,fhobs2,mhobs2,maxhobs2))
# rownames(dft)<-c("m-freq","m-mean","m-max","o-freq","o-mean","o-max")
# names(dft)<-c(l1,l2,l3,h1,h2,h3)
# 
# png(paste("",dir,"dft.png",sep=""), height = 50*nrow(dft), width = 200*ncol(dft))
# grid.table(dft)
# dev.off()
# 
# #dfts<<-dft
# 
# df24t<-data.frame(rbind(f24lmod,m24lmod,f24lobs,m24lobs),rbind(f24lmod1,m24lmod1,f24lobs1,m24lobs1),rbind(f24lmod2,m24lmod2,f24lobs2,m24lobs2),rbind(f24hmod,m24hmod,f24hobs,m24hobs),rbind(f24hmod1,m24hmod1,f24hobs1,m24hobs1),rbind(f24hmod2,m24hmod2,f24hobs2,m24hobs2))
# rownames(df24t)<-c("m-freq","m-mean","o-freq","o-mean")
# names(df24t)<-c(l1,l2,l3,h1,h2,h3)
# 
# png(paste("",dir,"df24t.png",sep=""), height = 50*nrow(df24t), width = 200*ncol(df24t))
# grid.table(df24t)
# dev.off()
# #dfts
# 
# breaks = seq(1, max(perslowmod), by=1) 
# persduration.cut = cut(perslowmod, breaks, right=FALSE) 
# persduration.freq = c(table(persduration.cut),0)
# low1mod<-as_tibble(data.frame(breaks,persduration.freq))
# 
# breaks2 = seq(1, max(perslow1mod), by=1) 
# persduration.cut2 = cut(perslow1mod, breaks2, right=FALSE) 
# persduration.freq2 = c(table(persduration.cut2),0)
# low2mod<-as_tibble(data.frame(breaks2,persduration.freq2))
# 
# breaks3 = seq(1, max(perslow2mod), by=1) 
# persduration.cut3 = cut(perslow2mod, breaks3, right=FALSE) 
# persduration.freq3 = c(table(persduration.cut3),0)
# low3mod<-as_tibble(data.frame(breaks3,persduration.freq3))
# 
# breaks4 = seq(1, max(perslowobs), by=1) 
# persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
# persduration.freq4 = c(table(persduration.cut4),0)
# low1obs<-as_tibble(data.frame(breaks4,persduration.freq4))
# 
# breaks5 = seq(1, max(perslow1obs), by=1) 
# persduration.cut5 = cut(perslow1obs, breaks5, right=FALSE) 
# persduration.freq5 = c(table(persduration.cut5),0)
# low2obs<-as_tibble(data.frame(breaks5,persduration.freq5))
# 
# breaks6 = seq(1, max(perslow2obs), by=1) 
# persduration.cut6 = cut(perslow2obs, breaks6, right=FALSE) 
# persduration.freq6 = c(table(persduration.cut6),0)
# low3obs<-as_tibble(data.frame(breaks6,persduration.freq6))
# 
# l1m<-data.frame(low1mod, rep(l1,length(low1mod$breaks)), rep("Model",length(low1mod$breaks)))
# names(l1m)<-c("breaks","Frequency","CF","type")
# l2m<-data.frame(low2mod, rep(l2,length(low2mod$breaks2)), rep("Model",length(low2mod$breaks2)))
# names(l2m)<-c("breaks","Frequency","CF","type")
# l3m<-data.frame(low3mod, rep(l3,length(low3mod$breaks3)), rep("Model",length(low3mod$breaks3)))
# names(l3m)<-c("breaks","Frequency","CF","type")
# l1o<-data.frame(low1obs, rep(l1,length(low1obs$breaks4)), rep("Observations",length(low1obs$breaks4)))
# names(l1o)<-c("breaks","Frequency","CF","type")
# l2o<-data.frame(low2obs, rep(l2,length(low2obs$breaks5)), rep("Observations",length(low2obs$breaks5))) 
# names(l2o)<-c("breaks","Frequency","CF","type")
# l3o<-data.frame(low3obs, rep(l3,length(low3obs$breaks6)), rep("Observations",length(low3obs$breaks6)))
# names(l3o)<-c("breaks","Frequency","CF","type")
# low<<-rbind(l1m,l2m,l3m,l1o,l2o,l3o)
# #lines(breaks2[1:length(breaks2)], persduration.freq2,col="grey",lwd=2,lty="dashed")
# 
# p1 <- ggplot(data=low[which(low$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
#   geom_tile(aes(fill = Frequency)) +
#   theme_grey(base_size = 10)+
#   scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
#   facet_grid(.~type)+
#   xlab(paste(unit2,"Threshold")) +
#   ylab("Duration of Events(h)")
#   
# p1
# 
# ggsave(paste("",dir,"lowcapfreqdurtot.png",sep=""))
# print("saved 9.image")
# 
# breaks7 = seq(1, max(pershighmod), by=1) 
# persduration.cut7 = cut(pershighmod, breaks7, right=FALSE) 
# persduration.freq7 = c(table(persduration.cut7),0)
# high1mod<<-as_tibble(data.frame(breaks7,persduration.freq7))
# 
# if(length(pershigh1mod)>0){breaks8 = seq(1, max(pershigh1mod), by=1) 
# if(length(breaks8) > 1) {persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
# persduration.freq8 = c(table(persduration.cut8),0)
# high2mod<<-as_tibble(data.frame(breaks8,persduration.freq8))}else{high2mod<<-data.frame(breaks8,pershigh1mod)}}else {
#   breaks8<-0
#   persduration.freq8<-0
#   high2mod<<-as_tibble(data.frame(breaks8,persduration.freq8))}
# 
# # breaks8 = seq(1, max(pershigh1mod), by=1) 
# # persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
# # persduration.freq8 = c(table(persduration.cut8),0)
# # high2mod<-as_tibble(data.frame(breaks8,persduration.freq8))
# 
# if(length(pershigh2mod)>0){breaks9 = seq(1, max(pershigh2mod), by=1) 
# if(length(breaks9) > 1) {persduration.cut9 = cut(pershigh2mod, breaks9, right=FALSE) 
# persduration.freq9 = c(table(persduration.cut9),0)
# high3mod<<-as_tibble(data.frame(breaks9,persduration.freq9))}else{high3mod<<-data.frame(breaks9,pershigh2mod)}}else {
#   breaks9<-0
#   persduration.freq9<-0
#   high3mod<<-as_tibble(data.frame(breaks9,persduration.freq9))}
# 
# # breaks9 = seq(1, max(pershigh2mod), by=1) 
# # persduration.cut9 = cut(pershigh2mod, breaks9, right=FALSE) 
# # persduration.freq9 = c(table(persduration.cut9),0)
# # high3mod<-as_tibble(data.frame(breaks9,persduration.freq9))
# 
# breaks10 = seq(1, max(pershighobs), by=1) 
# persduration.cut10 = cut(pershighobs, breaks10, right=FALSE) 
# persduration.freq10 = c(table(persduration.cut10),0)
# high1obs<<-as_tibble(data.frame(breaks10,persduration.freq10))
# 
# if(length(pershigh1obs)>0){breaks11 = seq(1, max(pershigh1obs), by=1) 
# if(length(breaks11) > 1) {persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
# persduration.freq11 = c(table(persduration.cut11),0)
# high2obs<<-as_tibble(data.frame(breaks11,persduration.freq11))}else{high2obs<<-data.frame(breaks11,pershigh1obs)}}else {
#   breaks11<-0
#   persduration.freq11<-0
#   high2obs<<-as_tibble(data.frame(breaks11,persduration.freq11))}
# 
# # breaks11 = seq(1, max(pershigh1obs), by=1) 
# # persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
# # persduration.freq11 = c(table(persduration.cut11),0)
# # high2obs<-as_tibble(data.frame(breaks11,persduration.freq11))
# 
# if(length(pershigh2obs)>0){breaks12 = seq(1, max(pershigh2obs), by=1) 
# if(length(breaks12) > 1) {persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
# persduration.freq12 = c(table(persduration.cut12),0)
# high3obs<<-as_tibble(data.frame(breaks12,persduration.freq12))}else{high3obs<<-data.frame(breaks12,pershigh2obs)}}else {
#   breaks12<-0
#   persduration.freq12<-0
#   high3obs<<-as_tibble(data.frame(breaks12,persduration.freq12))}
# 
# # breaks12 = seq(1, max(pershigh2obs), by=1) 
# # persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
# # persduration.freq12 = c(table(persduration.cut12),0)
# # high3obs<-as_tibble(data.frame(breaks12,persduration.freq12))
# 
# h1m<-data.frame(high1mod, rep(h1,length(high1mod$breaks7)), rep("Model",length(high1mod$breaks7)))
# names(h1m)<-c("breaks","Frequency","CF","type")
# h2m<-data.frame(high2mod, rep(h2,length(high2mod$breaks8)), rep("Model",length(high2mod$breaks8)))
# names(h2m)<-c("breaks","Frequency","CF","type")
# h3m<-data.frame(high3mod, rep(h3,length(high3mod$breaks9)), rep("Model",length(high3mod$breaks9)))
# names(h3m)<-c("breaks","Frequency","CF","type")
# h1o<-data.frame(high1obs, rep(h1,length(high1obs$breaks10)), rep("Observations",length(high1obs$breaks10)))
# names(h1o)<-c("breaks","Frequency","CF","type")
# h2o<-data.frame(high2obs, rep(h2,length(high2obs$breaks11)), rep("Observations",length(high2obs$breaks11))) 
# names(h2o)<-c("breaks","Frequency","CF","type")
# h3o<-data.frame(high3obs, rep(h3,length(high3obs$breaks12)), rep("Observations",length(high3obs$breaks12)))
# names(h3o)<-c("breaks","Frequency","CF","type")
# high<<-rbind(h1m,h2m,h3m,h1o,h2o,h3o)
# 
# p2<- ggplot(data=high[which(high$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
#   geom_tile(aes(fill = Frequency)) +
#   theme_grey(base_size = 10)+
#   scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
#   facet_grid(.~type)+
#   xlab(paste(unit2,"Threshold"))+
#   ylab("Duration of Events(h)")
#   
# p2
# 
# ggsave(paste("",dir,"highcapfreqdurtot.png",sep=""))
# print("saved 10.image")

}


########################Capacity Factor Error############################################

if(type==1||type==2){
#error<-abs(mod$effekt-obs$effekt)
error<-mod$effekt-obs$effekt

err<-data.frame(obs$effekt,error)
#bre<-seq(0.1,0.9,0.1)
#err.cut = cut(err, bre, right=TRUE) 
#errt<-split(err,err[,1])

errtd<-vector("list", 9)

pseq <- seq(0,max(obs$effekt),binwidths2)

errt<-split(err,cut(err[,1], breaks = pseq,include.lowest = TRUE, right = TRUE))

errtd<-lapply(1:length(errt),function(i){
  if(length(errt[[i]][,1])==0){
  hh<-data.frame(0,0)
  names(hh)<-c(names(err))
  errtd[[i]]<-hh
  }else{errtd[[i]]<-errt[[i]]
  }
  })

errtt<<-errtd

erb<-lapply(1:length(errt),function(i,errt){
  if(i<9){
  erb<-rep(paste("0.",i-1,"-","0.",i, sep=""),length(errt[[i]]$error))}else{rep(">0.8",length(errt[[i]]$error))}
   
  },errt=errt)

errd<<-as_tibble(data.frame(bind_rows(errt),unlist(erb)))

p28 <- ggplot() +
  geom_boxplot(data=errtd[[1]],aes(x="0 - 0.1",y=errtd[[1]][,2],fill="error"))+
  geom_boxplot(data=errtd[[2]],aes(x="0.1 - 0.2",y=errtd[[2]][,2],fill="error"))+
  geom_boxplot(data=errtd[[3]],aes(x="0.2 - 0.3",y=errtd[[3]][,2],fill="error"))+
  geom_boxplot(data=errtd[[4]],aes(x="0.3 - 0.4",y=errtd[[4]][,2],fill="error"))+
  geom_boxplot(data=errtd[[5]],aes(x="0.4 - 0.5",y=errtd[[5]][,2],fill="error"))+
  geom_boxplot(data=errtd[[6]],aes(x="0.5 - 0.6",y=errtd[[6]][,2],fill="error"))+
  geom_boxplot(data=errtd[[7]],aes(x="0.6 - 0.7",y=errtd[[7]][,2],fill="error"))+
  geom_boxplot(data=errtd[[8]],aes(x="0.7 - 0.8",y=errtd[[8]][,2],fill="error"))+
  geom_boxplot(data=errtd[[9]],aes(x="0.8 - 1",y=errtd[[9]][,2],fill="error"))+
  geom_text(aes(x = "0 - 0.1", y = (median(errtd[[1]]$error)-0.005),label = paste("n =",length(errt[[1]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.1 - 0.2", y = (median(errtd[[2]]$error)-0.005),label = paste("n =",length(errt[[2]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.2 - 0.3", y = (median(errtd[[3]]$error)-0.005),label = paste("n =",length(errt[[3]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.3 - 0.4", y = (median(errtd[[4]]$error)-0.005),label = paste("n =",length(errt[[4]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.4 - 0.5", y = (median(errtd[[5]]$error)-0.005),label = paste("n =",length(errt[[5]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.5 - 0.6", y = (median(errtd[[6]]$error)-0.005),label = paste("n =",length(errt[[6]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.6 - 0.7", y = (median(errtd[[7]]$error)-0.005),label = paste("n =",length(errt[[7]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.7 - 0.8", y = (median(errtd[[8]]$error)-0.005),label = paste("n =",length(errt[[8]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.8 - 1", y = (median(errtd[[9]]$error)-0.005),label = paste("n =",length(errt[[9]]$error),sep=" ")),size = 3)+
  theme(legend.position="none")+
  scale_fill_manual(values=c("error"="#FF6633"))+
  xlab(paste(unit,"Range")) +
  ylab("Deviations")
p28
ggsave(paste("",dir,"capdevtot.png",sep=""))
print("saved 11.image")

###### absolute deviations

error2<<-abs(mod$effekt-obs$effekt)

err2<<-data.frame(obs$effekt,error2)
#bre<-seq(0.1,0.9,0.1)
#err.cut = cut(err, bre, right=TRUE) 
#errt<-split(err,err[,1])

errtd2<<-vector("list", 9)

errt2<<-split(err2,cut(err2[,1], breaks = pseq,include.lowest = TRUE, right = TRUE))

errtd2<<-lapply(1:length(errt2),function(i){
  if(length(errt2[[i]][,1])==0){
  hh<-data.frame(0,0)
  names(hh)<-c(names(err2))
  errtd2[[i]]<-hh
  }else{errtd2[[i]]<-errt2[[i]]
  }
  })

erb<-lapply(1:length(errt),function(i,errt){
  if(i<9){
  erb<-rep(paste("0.",i-1,"-","0.",i, sep=""),length(errt[[i]]$error))}else{rep(">0.8",length(errt[[i]]$error))}
   
  },errt=errt)

errdab<<-as_tibble(data.frame(bind_rows(errt2),unlist(erb)))
#effekt$errt

p29 <- ggplot() +
  geom_boxplot(data=errtd2[[1]],aes(x="0 - 0.1",y=errtd2[[1]][,2],fill="error"))+
  geom_boxplot(data=errtd2[[2]],aes(x="0.1 - 0.2",y=errtd2[[2]][,2],fill="error"))+
  geom_boxplot(data=errtd2[[3]],aes(x="0.2 - 0.3",y=errtd2[[3]][,2],fill="error"))+
  geom_boxplot(data=errtd2[[4]],aes(x="0.3 - 0.4",y=errtd2[[4]][,2],fill="error"))+
  geom_boxplot(data=errtd2[[5]],aes(x="0.4 - 0.5",y=errtd2[[5]][,2],fill="error"))+
  geom_boxplot(data=errtd2[[6]],aes(x="0.5 - 0.6",y=errtd2[[6]][,2],fill="error"))+
  geom_boxplot(data=errtd2[[7]],aes(x="0.6 - 0.7",y=errtd2[[7]][,2],fill="error"))+
  geom_boxplot(data=errtd2[[8]],aes(x="0.7 - 0.8",y=errtd2[[8]][,2],fill="error"))+
  geom_boxplot(data=errtd2[[9]],aes(x="0.8 - 1",y=errtd2[[9]][,2],fill="error"))+
  geom_text(aes(x = "0 - 0.1", y = (mean(errtd2[[1]]$error)-0.005),label = paste("n =",length(errt2[[1]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.1 - 0.2", y = (mean(errtd2[[2]]$error)-0.005),label = paste("n =",length(errt2[[2]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.2 - 0.3", y = (mean(errtd2[[3]]$error)-0.005),label = paste("n =",length(errt2[[3]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.3 - 0.4", y = (mean(errtd2[[4]]$error)-0.005),label = paste("n =",length(errt2[[4]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.4 - 0.5", y = (mean(errtd2[[5]]$error)-0.005),label = paste("n =",length(errt2[[5]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.5 - 0.6", y = (mean(errtd2[[6]]$error)-0.005),label = paste("n =",length(errt2[[6]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.6 - 0.7", y = (mean(errtd2[[7]]$error)-0.005),label = paste("n =",length(errt2[[7]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.7 - 0.8", y = (mean(errtd2[[8]]$error)-0.005),label = paste("n =",length(errt2[[8]]$error),sep=" ")),size = 3)+
  geom_text(aes(x = "0.8 - 1", y = (mean(errtd2[[9]]$error)-0.005),label = paste("n =",length(errt2[[9]]$error),sep=" ")),size = 3)+
  theme(legend.position="none")+
  scale_fill_manual(values=c("error"="#FF6633"))+
  theme(legend.position="none")+
  xlab(paste(unit,"Range")) +
  ylab("Absolute Deviations")

p29

ggsave(paste("",dir,"capabsdevtot.png",sep=""))
print("saved 12.image")

}
#################### capacity factor error seasonal

give.n <- function(x){
  return(c(y = median(x)-0.005, label = length(x))) 
  }

if(type==1||type==3){
#summer
error<-mods$effekt-obss$effekt

err<-data.frame(obss$effekt,error)
#bre<-seq(0.1,0.9,0.1)
#err.cut = cut(err, bre, right=TRUE) 
#errt<-split(err,err[,1])

#cut(err[,1], breaks = seq(from = 0, to = 0.9, by = 0.1), right = TRUE)
errt<-split(err,cut(err[,1], breaks = pseq,include.lowest = TRUE, right = TRUE))

erb<-lapply(1:length(errt),function(i,errt){
  if(i<9){
  erb<-rep(paste("0.",i-1,"-","0.",i, sep=""),length(errt[[i]]$error))}else{rep(">0.8",length(errt[[i]]$error))}
   
  },errt=errt)

#errd<-as_tibble(data.frame(bind_rows(errt),erb))
errd<-as_tibble(data.frame(bind_rows(errt),unlist(erb)))
names(errd)<-c("effekt", "error", "class")

errds<<-errd

p47 <- ggplot(data=errd, aes(x=class, y=error)) +
  geom_boxplot(aes(fill="error"))+
  stat_summary(fun.data = give.n, geom = "text", fun.y = median) +
  theme(legend.title=element_blank())+
  theme(legend.position="none")+
  scale_fill_manual(values=c("error"="#FF6633"))+
  xlab(paste(unit,"Range")) +
  ylab("Deviations")
p47  


# p47 <- ggplot() +
#   if(length(errt[[1]]$error)>0){geom_boxplot(data=errt[[1]],aes(x="0 - 0.1",y=errt[[1]][,2],fill="error"))}+
#   if(length(errt[[2]]$error)>0){geom_boxplot(data=errt[[2]],aes(x="0.1 - 0.2",y=errt[[2]][,2],fill="error"))}+
#   if(length(errt[[3]]$error)>0){geom_boxplot(data=errt[[3]],aes(x="0.2 - 0.3",y=errt[[3]][,2],fill="error"))}+
#   if(length(errt[[4]]$error)>0){geom_boxplot(data=errt[[4]],aes(x="0.3 - 0.4",y=errt[[4]][,2],fill="error"))}+
#   if(length(errt[[5]]$error)>0){geom_boxplot(data=errt[[5]],aes(x="0.4 - 0.5",y=errt[[5]][,2],fill="error"))}+
#   if(length(errt[[6]]$error)>0){geom_boxplot(data=errt[[6]],aes(x="0.5 - 0.6",y=errt[[6]][,2],fill="error"))}+
#   if(length(errt[[7]]$error)>0){geom_boxplot(data=errt[[7]],aes(x="0.6 - 0.7",y=errt[[7]][,2],fill="error"))}+
#   if(length(errt[[8]]$error)>0){geom_boxplot(data=errt[[8]],aes(x="0.7 - 0.8",y=errt[[8]][,2],fill="error"))}+
#   if(length(errt[[9]]$error)>0){geom_boxplot(data=errt[[9]],aes(x="0.8 - 1",y=errt[[9]][,2],fill="error"))}+
#   if(length(errt[[1]]$error)>0){geom_text(aes(x = "0 - 0.1", y = (median(errt[[1]]$error)-0.005),label = paste("n =",length(errt[[1]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[2]]$error)>0){geom_text(aes(x = "0.1 - 0.2", y = (median(errt[[2]]$error)-0.005),label = paste("n =",length(errt[[2]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[3]]$error)>0){geom_text(aes(x = "0.2 - 0.3", y = (median(errt[[3]]$error)-0.005),label = paste("n =",length(errt[[3]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[4]]$error)>0){geom_text(aes(x = "0.3 - 0.4", y = (median(errt[[4]]$error)-0.005),label = paste("n =",length(errt[[4]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[5]]$error)>0){geom_text(aes(x = "0.4 - 0.5", y = (median(errt[[5]]$error)-0.005),label = paste("n =",length(errt[[5]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[6]]$error)>0){geom_text(aes(x = "0.5 - 0.6", y = (median(errt[[6]]$error)-0.005),label = paste("n =",length(errt[[6]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[7]]$error)>0){geom_text(aes(x = "0.6 - 0.7", y = (median(errt[[7]]$error)-0.005),label = paste("n =",length(errt[[7]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[8]]$error)>0){geom_text(aes(x = "0.7 - 0.8", y = (median(errt[[8]]$error)-0.005),label = paste("n =",length(errt[[8]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[9]]$error)>0){geom_text(aes(x = "0.8 - 1", y = (median(errt[[9]]$error)-0.005),label = paste("n =",length(errt[[9]]$error),sep=" ")),size = 3)}+
#   theme(legend.position="none")+
#   scale_fill_manual(values=c("error"="#FF6633"))+
#   xlab("Capacity Factor Range") +
#   ylab("Deviations")
# 
# p47


ggsave(paste("",dir,"capdevsum.png",sep=""))
print("saved 13.image")

#winter
error<-modw$effekt-obsw$effekt

err<-data.frame(obsw$effekt,error)
#bre<-seq(0.1,0.9,0.1)
#err.cut = cut(err, bre, right=TRUE) 
#errt<-split(err,err[,1])

#cut(err[,1], breaks = seq(from = 0, to = 0.9, by = 0.1), right = TRUE)
errt<-split(err,cut(err[,1], breaks = pseq,include.lowest = TRUE, right = TRUE))

erb<-lapply(1:length(errt),function(i,errt){
  if(i<9){erb<-rep(paste("0.",i-1,"-","0.",i, sep=""),length(errt[[i]]$error))}else{rep(">0.8",length(errt[[i]]$error))}
     },errt=errt)

#errd<-as_tibble(data.frame(bind_rows(errt),erb))
errd<-as_tibble(data.frame(bind_rows(errt),unlist(erb)))
names(errd)<-c("effekt", "error", "class")

errdw<<-errd

p48 <- ggplot(data=errd, aes(x=class, y=error)) +
  geom_boxplot(aes(fill="error"))+
  stat_summary(fun.data = give.n, geom = "text", fun.y = median) +
  theme(legend.title=element_blank())+
  theme(legend.position="none")+
  scale_fill_manual(values=c("error"="#FF6633"))+
  xlab(paste(unit,"Range")) +
  ylab("Deviations")
p48  


# p48 <- ggplot() +
#   if(length(errt[[1]]$error)>0){geom_boxplot(data=errt[[1]],aes(x="0 - 0.1",y=errt[[1]][,2],fill="error"))}+
#   if(length(errt[[2]]$error)>0){geom_boxplot(data=errt[[2]],aes(x="0.1 - 0.2",y=errt[[2]][,2],fill="error"))}+
#   if(length(errt[[3]]$error)>0){geom_boxplot(data=errt[[3]],aes(x="0.2 - 0.3",y=errt[[3]][,2],fill="error"))}+
#   if(length(errt[[4]]$error)>0){geom_boxplot(data=errt[[4]],aes(x="0.3 - 0.4",y=errt[[4]][,2],fill="error"))}+
#   if(length(errt[[5]]$error)>0){geom_boxplot(data=errt[[5]],aes(x="0.4 - 0.5",y=errt[[5]][,2],fill="error"))}+
#   if(length(errt[[6]]$error)>0){geom_boxplot(data=errt[[6]],aes(x="0.5 - 0.6",y=errt[[6]][,2],fill="error"))}+
#   if(length(errt[[7]]$error)>0){geom_boxplot(data=errt[[7]],aes(x="0.6 - 0.7",y=errt[[7]][,2],fill="error"))}+
#   if(length(errt[[8]]$error)>0){geom_boxplot(data=errt[[8]],aes(x="0.7 - 0.8",y=errt[[8]][,2],fill="error"))}+
#   if(length(errt[[9]]$error)>0){geom_boxplot(data=errt[[9]],aes(x="0.8 - 1",y=errt[[9]][,2],fill="error"))}+
#   if(length(errt[[1]]$error)>0){geom_text(aes(x = "0 - 0.1", y = (median(errt[[1]]$error)-0.005),label = paste("n =",length(errt[[1]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[2]]$error)>0){geom_text(aes(x = "0.1 - 0.2", y = (median(errt[[2]]$error)-0.005),label = paste("n =",length(errt[[2]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[3]]$error)>0){geom_text(aes(x = "0.2 - 0.3", y = (median(errt[[3]]$error)-0.005),label = paste("n =",length(errt[[3]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[4]]$error)>0){geom_text(aes(x = "0.3 - 0.4", y = (median(errt[[4]]$error)-0.005),label = paste("n =",length(errt[[4]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[5]]$error)>0){geom_text(aes(x = "0.4 - 0.5", y = (median(errt[[5]]$error)-0.005),label = paste("n =",length(errt[[5]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[6]]$error)>0){geom_text(aes(x = "0.5 - 0.6", y = (median(errt[[6]]$error)-0.005),label = paste("n =",length(errt[[6]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[7]]$error)>0){geom_text(aes(x = "0.6 - 0.7", y = (median(errt[[7]]$error)-0.005),label = paste("n =",length(errt[[7]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[8]]$error)>0){geom_text(aes(x = "0.7 - 0.8", y = (median(errt[[8]]$error)-0.005),label = paste("n =",length(errt[[8]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[9]]$error)>0){geom_text(aes(x = "0.8 - 1", y = (median(errt[[9]]$error)-0.005),label = paste("n =",length(errt[[9]]$error),sep=" ")),size = 3)}+
#   theme(legend.position="none")+
#   scale_fill_manual(values=c("error"="#FF6633"))+
#   xlab("Capacity Factor Range") +
#   ylab("Deviations")
# p48  

ggsave(paste("",dir,"capdevwin.png",sep=""))
print("saved 14.image")

#spring

error<-modsp$effekt-obssp$effekt

err<-data.frame(obssp$effekt,error)
#bre<-seq(0.1,0.9,0.1)
#err.cut = cut(err, bre, right=TRUE) 
#errt<-split(err,err[,1])

#cut(err[,1], breaks = seq(from = 0, to = 0.9, by = 0.1), right = TRUE)
errt<-split(err,cut(err[,1], breaks = pseq,include.lowest = TRUE, right = TRUE))

erb<-lapply(1:length(errt),function(i,errt){
  if(i<9){
  erb<-rep(paste("0.",i-1,"-","0.",i, sep=""),length(errt[[i]]$error))}else{rep(">0.8",length(errt[[i]]$error))}
   
  },errt=errt)

#errd<-as_tibble(data.frame(bind_rows(errt),erb))
errd<-as_tibble(data.frame(bind_rows(errt),unlist(erb)))
names(errd)<-c("effekt", "error", "class")

errdsp<<-errd

p49 <- ggplot(data=errd, aes(x=class, y=error)) +
  geom_boxplot(aes(fill="error"))+
  stat_summary(fun.data = give.n, geom = "text", fun.y = median) +
  #geom_text(aes(x = class, y = (median(error)-0.005),label = paste("n =",length(error),sep=" ")),size = 3) +
  theme(legend.title=element_blank())+
  theme(legend.position="none")+
  scale_fill_manual(values=c("error"="#FF6633"))+
  xlab(paste(unit,"Range")) +
  ylab("Deviations")
p49  

  


# p49 <- ggplot() +
#   if(length(errt[[1]]$error)>0){geom_boxplot(data=errt[[1]],aes(x="0 - 0.1",y=errt[[1]][,2],fill="error"))}+
#   if(length(errt[[2]]$error)>0){geom_boxplot(data=errt[[2]],aes(x="0.1 - 0.2",y=errt[[2]][,2],fill="error"))}+
#   if(length(errt[[3]]$error)>0){geom_boxplot(data=errt[[3]],aes(x="0.2 - 0.3",y=errt[[3]][,2],fill="error"))}+
#   if(length(errt[[4]]$error)>0){geom_boxplot(data=errt[[4]],aes(x="0.3 - 0.4",y=errt[[4]][,2],fill="error"))}+
#   if(length(errt[[5]]$error)>0){geom_boxplot(data=errt[[5]],aes(x="0.4 - 0.5",y=errt[[5]][,2],fill="error"))}+
#   if(length(errt[[6]]$error)>0){geom_boxplot(data=errt[[6]],aes(x="0.5 - 0.6",y=errt[[6]][,2],fill="error"))}+
#   if(length(errt[[7]]$error)>0){geom_boxplot(data=errt[[7]],aes(x="0.6 - 0.7",y=errt[[7]][,2],fill="error"))}+
#   if(length(errt[[8]]$error)>0){geom_boxplot(data=errt[[8]],aes(x="0.7 - 0.8",y=errt[[8]][,2],fill="error"))}+
#   if(length(errt[[9]]$error)>0){geom_boxplot(data=errt[[9]],aes(x="0.8 - 1",y=errt[[9]][,2],fill="error"))}+
#   if(length(errt[[1]]$error)>0){geom_text(aes(x = "0 - 0.1", y = (median(errt[[1]]$error)-0.005),label = paste("n =",length(errt[[1]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[2]]$error)>0){geom_text(aes(x = "0.1 - 0.2", y = (median(errt[[2]]$error)-0.005),label = paste("n =",length(errt[[2]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[3]]$error)>0){geom_text(aes(x = "0.2 - 0.3", y = (median(errt[[3]]$error)-0.005),label = paste("n =",length(errt[[3]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[4]]$error)>0){geom_text(aes(x = "0.3 - 0.4", y = (median(errt[[4]]$error)-0.005),label = paste("n =",length(errt[[4]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[5]]$error)>0){geom_text(aes(x = "0.4 - 0.5", y = (median(errt[[5]]$error)-0.005),label = paste("n =",length(errt[[5]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[6]]$error)>0){geom_text(aes(x = "0.5 - 0.6", y = (median(errt[[6]]$error)-0.005),label = paste("n =",length(errt[[6]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[7]]$error)>0){geom_text(aes(x = "0.6 - 0.7", y = (median(errt[[7]]$error)-0.005),label = paste("n =",length(errt[[7]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[8]]$error)>0){geom_text(aes(x = "0.7 - 0.8", y = (median(errt[[8]]$error)-0.005),label = paste("n =",length(errt[[8]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[9]]$error)>0){geom_text(aes(x = "0.8 - 1", y = (median(errt[[9]]$error)-0.005),label = paste("n =",length(errt[[9]]$error),sep=" ")),size = 3)}+
#   theme(legend.position="none")+
#   scale_fill_manual(values=c("error"="#FF6633"))+
#   xlab("Capacity Factor Range") +
#   ylab("Deviations")
# p49

ggsave(paste("",dir,"capdevspr.png",sep=""))
print("saved 15.image")

#autumn

error<-moda$effekt-obsa$effekt

err<-data.frame(obsa$effekt,error)
#bre<-seq(0.1,0.9,0.1)
#err.cut = cut(err, bre, right=TRUE) 
#errt<-split(err,err[,1])

#cut(err[,1], breaks = seq(from = 0, to = 0.9, by = 0.1), right = TRUE)
errt<-split(err,cut(err[,1], breaks = pseq,include.lowest = TRUE, right = TRUE))

erb<-lapply(1:length(errt),function(i,errt){
  if(i<9){
  erb<-rep(paste("0.",i-1,"-","0.",i, sep=""),length(errt[[i]]$error))}else{rep(">0.8",length(errt[[i]]$error))}
   
  },errt=errt)

#errd<-as_tibble(data.frame(bind_rows(errt),erb))
errd<-as_tibble(data.frame(bind_rows(errt),unlist(erb)))
names(errd)<-c("effekt", "error", "class")

errda<<-errd

p50 <- ggplot(data=errd, aes(x=class, y=error)) +
  geom_boxplot(aes(fill="error"))+
  stat_summary(fun.data = give.n, geom = "text", fun.y = median) +
  #geom_text(aes(x = class, y = (median(error)-0.005),label = paste("n =",length(error),sep=" ")),size = 3) +
  theme(legend.title=element_blank())+
  theme(legend.position="none")+
  scale_fill_manual(values=c("error"="#FF6633"))+
  xlab(paste(unit,"Range")) +
  ylab("Deviations")
p50  

# 
# p50 <- ggplot() +
#   i(length(errt[[1]]$error)>0){geom_boxplot(data=errt[[1]],aes(x="0 - 0.1",y=errt[[1]][,2],fill="error"))}+
#   if(length(errt[[2]]$error)>0){geom_boxplot(data=errt[[2]],aes(x="0.1 - 0.2",y=errt[[2]][,2],fill="error"))}+
#   if(length(errt[[3]]$error)>0){geom_boxplot(data=errt[[3]],aes(x="0.2 - 0.3",y=errt[[3]][,2],fill="error"))}+
#   if(length(errt[[4]]$error)>0){geom_boxplot(data=errt[[4]],aes(x="0.3 - 0.4",y=errt[[4]][,2],fill="error"))}+
#   if(length(errt[[5]]$error)>0){geom_boxplot(data=errt[[5]],aes(x="0.4 - 0.5",y=errt[[5]][,2],fill="error"))}+
#   if(length(errt[[6]]$error)>0){geom_boxplot(data=errt[[6]],aes(x="0.5 - 0.6",y=errt[[6]][,2],fill="error"))}+
#   if(length(errt[[7]]$error)>0){geom_boxplot(data=errt[[7]],aes(x="0.6 - 0.7",y=errt[[7]][,2],fill="error"))}+
#   if(length(errt[[8]]$error)>0){geom_boxplot(data=errt[[8]],aes(x="0.7 - 0.8",y=errt[[8]][,2],fill="error"))}+
#   if(length(errt[[9]]$error)>0){geom_boxplot(data=errt[[9]],aes(x="0.8 - 1",y=errt[[9]][,2],fill="error"))}+
#   if(length(errt[[1]]$error)>0){geom_text(aes(x = "0 - 0.1", y = (median(errt[[1]]$error)-0.005),label = paste("n =",length(errt[[1]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[2]]$error)>0){geom_text(aes(x = "0.1 - 0.2", y = (median(errt[[2]]$error)-0.005),label = paste("n =",length(errt[[2]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[3]]$error)>0){geom_text(aes(x = "0.2 - 0.3", y = (median(errt[[3]]$error)-0.005),label = paste("n =",length(errt[[3]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[4]]$error)>0){geom_text(aes(x = "0.3 - 0.4", y = (median(errt[[4]]$error)-0.005),label = paste("n =",length(errt[[4]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[5]]$error)>0){geom_text(aes(x = "0.4 - 0.5", y = (median(errt[[5]]$error)-0.005),label = paste("n =",length(errt[[5]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[6]]$error)>0){geom_text(aes(x = "0.5 - 0.6", y = (median(errt[[6]]$error)-0.005),label = paste("n =",length(errt[[6]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[7]]$error)>0){geom_text(aes(x = "0.6 - 0.7", y = (median(errt[[7]]$error)-0.005),label = paste("n =",length(errt[[7]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[8]]$error)>0){geom_text(aes(x = "0.7 - 0.8", y = (median(errt[[8]]$error)-0.005),label = paste("n =",length(errt[[8]]$error),sep=" ")),size = 3)}+
#   if(length(errt[[9]]$error)>0){geom_text(aes(x = "0.8 - 1", y = (median(errt[[9]]$error)-0.005),label = paste("n =",length(errt[[9]]$error),sep=" ")),size = 3)}+
#   theme(legend.position="none")+
#   scale_fill_manual(values=c("error"="#FF6633"))+
#   xlab("Capacity Factor Range") +
#   ylab("Deviations")
# p50

ggsave(paste("",dir,"capdevaut.png",sep=""))
print("saved 16.image")

}

########################### Duration of Events - Capacity Factor Spectrum #################

if(type==1 || type==2){

zlo2<-lengthEvents(filtersx(mod$effekt,0.0000000000000000000001,-1))
zlo2y<-data.frame(zlo2,rep("0",length(zlo2)))
names(zlo2y)<-c("duration","cfactor")
mlo2<-lengthEvents(filtersx(mod$effekt,pseq[2],0.0000000000000000000001))
mlo2y<-data.frame(mlo2,rep("0 - 0.1",length(mlo2)))
names(mlo2y)<-c("duration","cfactor")
m1lo2<-lengthEvents(filtersx(mod$effekt,pseq[3],pseq[2]))
m1lo2y<-data.frame(m1lo2,rep("0.1 - 0.2",length(m1lo2)))
names(m1lo2y)<-c("duration","cfactor")
m2lo2<-lengthEvents(filtersx(mod$effekt,pseq[4],pseq[3]))
m2lo2y<-data.frame(m2lo2,rep("0.2 - 0.3",length(m2lo2)))
names(m2lo2y)<-c("duration","cfactor")
m3lo2<-lengthEvents(filtersx(mod$effekt,pseq[5],pseq[4]))
m3lo2y<-data.frame(m3lo2,rep("0.3 - 0.4",length(m3lo2)))
names(m3lo2y)<-c("duration","cfactor")
m4lo2<-lengthEvents(filtersx(mod$effekt,pseq[6],pseq[5]))
m4lo2y<-data.frame(m4lo2,rep("0.4 - 0.5",length(m4lo2)))
names(m4lo2y)<-c("duration","cfactor")
m5lo2<-lengthEvents(filtersx(mod$effekt,pseq[7],pseq[6]))
m5lo2y<-data.frame(m5lo2,rep("0.5 - 0.6",length(m5lo2)))
names(m5lo2y)<-c("duration","cfactor")
m6lo2<-lengthEvents(filtersx(mod$effekt,pseq[8],pseq[7]))
m6lo2y<-data.frame(m6lo2,rep("0.6 - 0.7",length(m6lo2)))
names(m6lo2y)<-c("duration","cfactor")
m7lo2<-lengthEvents(filtersx(mod$effekt,pseq[9],pseq[8]))
m7lo2y<-data.frame(m7lo2,rep("0.7 - 0.8",length(m7lo2)))
names(m7lo2y)<-c("duration","cfactor")
olo2<-lengthEvents(filtersx(mod$effekt,pseq[10],pseq[9]))
olo2y<-data.frame(olo2,rep("0.8 - 1",length(olo2)))
names(olo2y)<-c("duration","cfactor")

Modl<-rbind(zlo2y,mlo2y,m1lo2y,m2lo2y,m3lo2y,m4lo2y,m5lo2y,m6lo2y,m7lo2y,olo2y)

zl<-lengthEvents(filtersx(obs$effekt,0.0000000000000000000001,-1))
zly<-data.frame(zl,rep("0",length(zl)))
names(zly)<-c("duration","cfactor")
ml<-lengthEvents(filtersx(obs$effekt,pseq[2],0.0000000000000000000001))
mly<-data.frame(ml,rep("0 - 0.1",length(ml)))
names(mly)<-c("duration","cfactor")
m1l<-lengthEvents(filtersx(obs$effekt,pseq[3],pseq[2]))
m1ly<-data.frame(m1l,rep("0.1 - 0.2",length(m1l)))
names(m1ly)<-c("duration","cfactor")
m2l<-lengthEvents(filtersx(obs$effekt,pseq[4],pseq[3]))
m2ly<-data.frame(m2l,rep("0.2 - 0.3",length(m2l)))
names(m2ly)<-c("duration","cfactor")
m3l<-lengthEvents(filtersx(obs$effekt,pseq[5],pseq[4]))
m3ly<-data.frame(m3l,rep("0.3 - 0.4",length(m3l)))
names(m3ly)<-c("duration","cfactor")
m4l<-lengthEvents(filtersx(obs$effekt,pseq[6],pseq[5]))
m4ly<-data.frame(m4l,rep("0.4 - 0.5",length(m4l)))
names(m4ly)<-c("duration","cfactor")
m5l<-lengthEvents(filtersx(obs$effekt,pseq[7],pseq[6]))
m5ly<-data.frame(m5l,rep("0.5 - 0.6",length(m5l)))
names(m5ly)<-c("duration","cfactor")
m6l<-lengthEvents(filtersx(obs$effekt,pseq[8],pseq[7]))
m6ly<-data.frame(m6l,rep("0.6 - 0.7",length(m6l)))
names(m6ly)<-c("duration","cfactor")
m7l<-lengthEvents(filtersx(obs$effekt,pseq[9],pseq[8]))
m7ly<-data.frame(m7l,rep("0.7 - 0.8",length(m7l)))
names(m7ly)<-c("duration","cfactor")
ol<-lengthEvents(filtersx(obs$effekt,pseq[10],pseq[9]))
oly<-data.frame(ol,rep("0.8 - 1",length(ol)))
names(oly)<-c("duration","cfactor")

Observations<-rbind(zly,mly,m1ly,m2ly,m3ly,m4ly,m5ly,m6ly,m7ly,oly)

Obs<-data.frame(Observations,rep("Observations",length(Observations$duration)))
names(Obs)<-c("duration","cfactor","type")
OL<-data.frame(Modl,rep("Model",length(Modl$duration)))
names(OL)<-c("duration","cfactor","type")
OLobs<-rbind(OL,Obs)

p4 <- ggplot(data=OLobs, aes(x=factor(cfactor,levels = c("0","0 - 0.1","0.1 - 0.2","0.2 - 0.3","0.3 - 0.4","0.4 - 0.5","0.5 - 0.6","0.6 - 0.7","0.7 - 0.8","0.8 - 1")), y=duration)) +
  theme(legend.title=element_blank())+
  geom_boxplot( aes(fill=type))+
  geom_boxplot( aes(fill=type))+
  scale_fill_manual(values=c("Observations"="green", "Model"="orange"))+
  xlab(paste(unit, "Range")) +
  ylab("Duration(h)")
p4  

ggsave(paste("",dir,"capdurtot.png",sep=""))
print("saved 17.image")
}

###################### summer

if(type==1||type==3){

zlo2<-lengthEvents(filtersx(mods$effekt,0.0000000000000000000001,-1))
zlo2y<-data.frame(zlo2,rep("0",length(zlo2)))
names(zlo2y)<-c("duration","cfactor")
mlo2<-lengthEvents(filtersx(mods$effekt,pseq[2],0.0000000000000000000001))
mlo2y<-data.frame(mlo2,rep("0 - 0.1",length(mlo2)))
names(mlo2y)<-c("duration","cfactor")
m1lo2<-lengthEvents(filtersx(mods$effekt,pseq[3],pseq[2]))
m1lo2y<-data.frame(m1lo2,rep("0.1 - 0.2",length(m1lo2)))
names(m1lo2y)<-c("duration","cfactor")
m2lo2<-lengthEvents(filtersx(mods$effekt,pseq[4],pseq[3]))
m2lo2y<-data.frame(m2lo2,rep("0.2 - 0.3",length(m2lo2)))
names(m2lo2y)<-c("duration","cfactor")
m3lo2<-lengthEvents(filtersx(mods$effekt,pseq[5],pseq[4]))
m3lo2y<-data.frame(m3lo2,rep("0.3 - 0.4",length(m3lo2)))
names(m3lo2y)<-c("duration","cfactor")
m4lo2<-lengthEvents(filtersx(mods$effekt,pseq[6],pseq[5]))
m4lo2y<-data.frame(m4lo2,rep("0.4 - 0.5",length(m4lo2)))
names(m4lo2y)<-c("duration","cfactor")
m5lo2<-lengthEvents(filtersx(mods$effekt,pseq[7],pseq[6]))
m5lo2y<-data.frame(m5lo2,rep("0.5 - 0.6",length(m5lo2)))
names(m5lo2y)<-c("duration","cfactor")
m6lo2<-lengthEvents(filtersx(mods$effekt,pseq[8],pseq[7]))
m6lo2y<-data.frame(m6lo2,rep("0.6 - 0.7",length(m6lo2)))
names(m6lo2y)<-c("duration","cfactor")
m7lo2<-lengthEvents(filtersx(mods$effekt,pseq[9],pseq[8]))
m7lo2y<-data.frame(m7lo2,rep("0.7 - 0.8",length(m7lo2)))
names(m7lo2y)<-c("duration","cfactor")
olo2<-lengthEvents(filtersx(mods$effekt,pseq[10],pseq[9]))
olo2y<-data.frame(olo2,rep("0.8 - 1",length(olo2)))
names(olo2y)<-c("duration","cfactor")

Modl<-rbind(zlo2y,mlo2y,m1lo2y,m2lo2y,m3lo2y,m4lo2y,m5lo2y,m6lo2y,m7lo2y,olo2y)


zl<-lengthEvents(filtersx(obss$effekt,0.0000000000000000000001,-1))
zly<-data.frame(zl,rep("0",length(zl)))
names(zly)<-c("duration","cfactor")
ml<-lengthEvents(filtersx(obss$effekt,pseq[2],0.0000000000000000000001))
mly<-data.frame(ml,rep("0 - 0.1",length(ml)))
names(mly)<-c("duration","cfactor")
m1l<-lengthEvents(filtersx(obss$effekt,pseq[3],pseq[2]))
m1ly<-data.frame(m1l,rep("0.1 - 0.2",length(m1l)))
names(m1ly)<-c("duration","cfactor")
m2l<-lengthEvents(filtersx(obss$effekt,pseq[4],pseq[3]))
m2ly<-data.frame(m2l,rep("0.2 - 0.3",length(m2l)))
names(m2ly)<-c("duration","cfactor")
m3l<-lengthEvents(filtersx(obss$effekt,pseq[5],pseq[4]))
m3ly<-data.frame(m3l,rep("0.3 - 0.4",length(m3l)))
names(m3ly)<-c("duration","cfactor")
m4l<-lengthEvents(filtersx(obss$effekt,pseq[6],pseq[5]))
m4ly<-data.frame(m4l,rep("0.4 - 0.5",length(m4l)))
names(m4ly)<-c("duration","cfactor")
m5l<-lengthEvents(filtersx(obss$effekt,pseq[7],pseq[6]))
m5ly<-data.frame(m5l,rep("0.5 - 0.6",length(m5l)))
names(m5ly)<-c("duration","cfactor")
m6l<-lengthEvents(filtersx(obss$effekt,pseq[8],pseq[7]))
m6ly<-data.frame(m6l,rep("0.6 - 0.7",length(m6l)))
names(m6ly)<-c("duration","cfactor")
m7l<-lengthEvents(filtersx(obss$effekt,pseq[9],pseq[8]))
m7ly<-data.frame(m7l,rep("0.7 - 0.8",length(m7l)))
names(m7ly)<-c("duration","cfactor")
ol<-lengthEvents(filtersx(obss$effekt,pseq[10],pseq[9]))
oly<-data.frame(ol,rep("0.8 - 1",length(ol)))
names(oly)<-c("duration","cfactor")

Observations<-rbind(zly,mly,m1ly,m2ly,m3ly,m4ly,m5ly,m6ly,m7ly,oly)

Obs<-data.frame(Observations,rep("Observations",length(Observations$duration)))
names(Obs)<-c("duration","cfactor","type")
OL<-data.frame(Modl,rep("Model",length(Modl$duration)))
names(OL)<-c("duration","cfactor","type")
OLobs<-rbind(OL,Obs)

p51 <- ggplot(data=OLobs, aes(x=cfactor, y=duration)) +
  geom_boxplot( aes(fill=type))+
  geom_boxplot( aes(fill=type))+
  theme(legend.title=element_blank())+
  scale_fill_manual(values=c("Observations"="green", "Model"="orange"))+
  xlab(paste(unit,"Range")) +
  ylab("Duration(h)")
p51  

ggsave(paste("",dir,"capdursum.png",sep=""))
print("saved 18.image")

###################### winter

zlo2<-lengthEvents(filtersx(modw$effekt,0.0000000000000000000001,-1))
zlo2y<-data.frame(zlo2,rep("0",length(zlo2)))
names(zlo2y)<-c("duration","cfactor")
mlo2<-lengthEvents(filtersx(modw$effekt,pseq[2],0.0000000000000000000001))
mlo2y<-data.frame(mlo2,rep("0 - 0.1",length(mlo2)))
names(mlo2y)<-c("duration","cfactor")
m1lo2<-lengthEvents(filtersx(modw$effekt,pseq[3],pseq[2]))
m1lo2y<-data.frame(m1lo2,rep("0.1 - 0.2",length(m1lo2)))
names(m1lo2y)<-c("duration","cfactor")
m2lo2<-lengthEvents(filtersx(modw$effekt,pseq[4],pseq[3]))
m2lo2y<-data.frame(m2lo2,rep("0.2 - 0.3",length(m2lo2)))
names(m2lo2y)<-c("duration","cfactor")
m3lo2<-lengthEvents(filtersx(modw$effekt,pseq[5],pseq[4]))
m3lo2y<-data.frame(m3lo2,rep("0.3 - 0.4",length(m3lo2)))
names(m3lo2y)<-c("duration","cfactor")
m4lo2<-lengthEvents(filtersx(modw$effekt,pseq[6],pseq[5]))
m4lo2y<-data.frame(m4lo2,rep("0.4 - 0.5",length(m4lo2)))
names(m4lo2y)<-c("duration","cfactor")
m5lo2<-lengthEvents(filtersx(modw$effekt,pseq[7],pseq[6]))
m5lo2y<-data.frame(m5lo2,rep("0.5 - 0.6",length(m5lo2)))
names(m5lo2y)<-c("duration","cfactor")
m6lo2<-lengthEvents(filtersx(modw$effekt,pseq[8],pseq[7]))
m6lo2y<-data.frame(m6lo2,rep("0.6 - 0.7",length(m6lo2)))
names(m6lo2y)<-c("duration","cfactor")
m7lo2<-lengthEvents(filtersx(modw$effekt,pseq[9],pseq[8]))
m7lo2y<-data.frame(m7lo2,rep("0.7 - 0.8",length(m7lo2)))
names(m7lo2y)<-c("duration","cfactor")
olo2<-lengthEvents(filtersx(modw$effekt,pseq[10],pseq[9]))
olo2y<-data.frame(olo2,rep("0.8 - 1",length(olo2)))
names(olo2y)<-c("duration","cfactor")

Modl<-rbind(zlo2y,mlo2y,m1lo2y,m2lo2y,m3lo2y,m4lo2y,m5lo2y,m6lo2y,m7lo2y,olo2y)

zl<-lengthEvents(filtersx(obsw$effekt,0.0000000000000000000001,-1))
zly<-data.frame(zl,rep("0",length(zl)))
names(zly)<-c("duration","cfactor")
ml<-lengthEvents(filtersx(obsw$effekt,pseq[2],0.0000000000000000000001))
mly<-data.frame(ml,rep("0 - 0.1",length(ml)))
names(mly)<-c("duration","cfactor")
m1l<-lengthEvents(filtersx(obsw$effekt,pseq[3],pseq[2]))
m1ly<-data.frame(m1l,rep("0.1 - 0.2",length(m1l)))
names(m1ly)<-c("duration","cfactor")
m2l<-lengthEvents(filtersx(obsw$effekt,pseq[4],pseq[3]))
m2ly<-data.frame(m2l,rep("0.2 - 0.3",length(m2l)))
names(m2ly)<-c("duration","cfactor")
m3l<-lengthEvents(filtersx(obsw$effekt,pseq[5],pseq[4]))
m3ly<-data.frame(m3l,rep("0.3 - 0.4",length(m3l)))
names(m3ly)<-c("duration","cfactor")
m4l<-lengthEvents(filtersx(obsw$effekt,pseq[6],pseq[5]))
m4ly<-data.frame(m4l,rep("0.4 - 0.5",length(m4l)))
names(m4ly)<-c("duration","cfactor")
m5l<-lengthEvents(filtersx(obsw$effekt,pseq[7],pseq[6]))
m5ly<-data.frame(m5l,rep("0.5 - 0.6",length(m5l)))
names(m5ly)<-c("duration","cfactor")
m6l<-lengthEvents(filtersx(obsw$effekt,pseq[8],pseq[7]))
m6ly<-data.frame(m6l,rep("0.6 - 0.7",length(m6l)))
names(m6ly)<-c("duration","cfactor")
m7l<-lengthEvents(filtersx(obsw$effekt,pseq[9],pseq[8]))
m7ly<-data.frame(m7l,rep("0.7 - 0.8",length(m7l)))
names(m7ly)<-c("duration","cfactor")
ol<-lengthEvents(filtersx(obsw$effekt,pseq[10],pseq[9]))
oly<-data.frame(ol,rep("0.8 - 1",length(ol)))
names(oly)<-c("duration","cfactor")

Observations<-rbind(zly,mly,m1ly,m2ly,m3ly,m4ly,m5ly,m6ly,m7ly,oly)

Obs<-data.frame(Observations,rep("Observations",length(Observations$duration)))
names(Obs)<-c("duration","cfactor","type")
OL<-data.frame(Modl,rep("Model",length(Modl$duration)))
names(OL)<-c("duration","cfactor","type")
OLobs<-rbind(OL,Obs)

p52 <- ggplot(data=OLobs, aes(x=cfactor, y=duration)) +
  geom_boxplot( aes(fill=type))+
  geom_boxplot( aes(fill=type))+
  theme(legend.title=element_blank())+
  scale_fill_manual(values=c("Observations"="green", "Model"="orange"))+
  xlab(paste(unit,"Range")) +
  ylab("Duration(h)")
p52

ggsave(paste("",dir,"capdurwin.png",sep=""))
print("saved 19.image")

###################### spring

zlo2<-lengthEvents(filtersx(modsp$effekt,0.0000000000000000000001,-1))
zlo2y<-data.frame(zlo2,rep("0",length(zlo2)))
names(zlo2y)<-c("duration","cfactor")
mlo2<-lengthEvents(filtersx(modsp$effekt,pseq[2],0.0000000000000000000001))
mlo2y<-data.frame(mlo2,rep("0 - 0.1",length(mlo2)))
names(mlo2y)<-c("duration","cfactor")
m1lo2<-lengthEvents(filtersx(modsp$effekt,pseq[3],pseq[2]))
m1lo2y<-data.frame(m1lo2,rep("0.1 - 0.2",length(m1lo2)))
names(m1lo2y)<-c("duration","cfactor")
m2lo2<-lengthEvents(filtersx(modsp$effekt,pseq[4],pseq[3]))
m2lo2y<-data.frame(m2lo2,rep("0.2 - 0.3",length(m2lo2)))
names(m2lo2y)<-c("duration","cfactor")
m3lo2<-lengthEvents(filtersx(modsp$effekt,pseq[5],pseq[4]))
m3lo2y<-data.frame(m3lo2,rep("0.3 - 0.4",length(m3lo2)))
names(m3lo2y)<-c("duration","cfactor")
m4lo2<-lengthEvents(filtersx(modsp$effekt,pseq[6],pseq[5]))
m4lo2y<-data.frame(m4lo2,rep("0.4 - 0.5",length(m4lo2)))
names(m4lo2y)<-c("duration","cfactor")
m5lo2<-lengthEvents(filtersx(modsp$effekt,pseq[7],pseq[6]))
m5lo2y<-data.frame(m5lo2,rep("0.5 - 0.6",length(m5lo2)))
names(m5lo2y)<-c("duration","cfactor")
m6lo2<-lengthEvents(filtersx(modsp$effekt,pseq[8],pseq[7]))
m6lo2y<-data.frame(m6lo2,rep("0.6 - 0.7",length(m6lo2)))
names(m6lo2y)<-c("duration","cfactor")
m7lo2<-lengthEvents(filtersx(modsp$effekt,pseq[9],pseq[8]))
m7lo2y<-data.frame(m7lo2,rep("0.7 - 0.8",length(m7lo2)))
names(m7lo2y)<-c("duration","cfactor")
olo2<-lengthEvents(filtersx(modsp$effekt,pseq[10],pseq[9]))
olo2y<-data.frame(olo2,rep("0.8 - 1",length(olo2)))
names(olo2y)<-c("duration","cfactor")

Modl<-rbind(zlo2y,mlo2y,m1lo2y,m2lo2y,m3lo2y,m4lo2y,m5lo2y,m6lo2y,m7lo2y,olo2y)

zl<-lengthEvents(filtersx(obssp$effekt,0.0000000000000000000001,-1))
zly<-data.frame(zl,rep("0",length(zl)))
names(zly)<-c("duration","cfactor")
ml<-lengthEvents(filtersx(obssp$effekt,pseq[2],0.0000000000000000000001))
mly<-data.frame(ml,rep("0 - 0.1",length(ml)))
names(mly)<-c("duration","cfactor")
m1l<-lengthEvents(filtersx(obssp$effekt,pseq[3],pseq[2]))
m1ly<-data.frame(m1l,rep("0.1 - 0.2",length(m1l)))
names(m1ly)<-c("duration","cfactor")
m2l<-lengthEvents(filtersx(obssp$effekt,pseq[4],pseq[3]))
m2ly<-data.frame(m2l,rep("0.2 - 0.3",length(m2l)))
names(m2ly)<-c("duration","cfactor")
m3l<-lengthEvents(filtersx(obssp$effekt,pseq[5],pseq[4]))
m3ly<-data.frame(m3l,rep("0.3 - 0.4",length(m3l)))
names(m3ly)<-c("duration","cfactor")
m4l<-lengthEvents(filtersx(obssp$effekt,pseq[6],pseq[5]))
m4ly<-data.frame(m4l,rep("0.4 - 0.5",length(m4l)))
names(m4ly)<-c("duration","cfactor")
m5l<-lengthEvents(filtersx(obssp$effekt,pseq[7],pseq[6]))
m5ly<-data.frame(m5l,rep("0.5 - 0.6",length(m5l)))
names(m5ly)<-c("duration","cfactor")
m6l<-lengthEvents(filtersx(obssp$effekt,pseq[8],pseq[7]))
m6ly<-data.frame(m6l,rep("0.6 - 0.7",length(m6l)))
names(m6ly)<-c("duration","cfactor")
m7l<-lengthEvents(filtersx(obssp$effekt,pseq[9],pseq[8]))
m7ly<-data.frame(m7l,rep("0.7 - 0.8",length(m7l)))
names(m7ly)<-c("duration","cfactor")
ol<-lengthEvents(filtersx(obssp$effekt,pseq[10],pseq[9]))
oly<-data.frame(ol,rep("0.8 - 1",length(ol)))
names(oly)<-c("duration","cfactor")

Observations<-rbind(zly,mly,m1ly,m2ly,m3ly,m4ly,m5ly,m6ly,m7ly,oly)

Obs<-data.frame(Observations,rep("Observations",length(Observations$duration)))
names(Obs)<-c("duration","cfactor","type")
OL<-data.frame(Modl,rep("Model",length(Modl$duration)))
names(OL)<-c("duration","cfactor","type")
OLobs<-rbind(OL,Obs)

p53 <- ggplot(data=OLobs, aes(x=cfactor, y=duration)) +
  geom_boxplot( aes(fill=type))+
  geom_boxplot( aes(fill=type))+
  theme(legend.title=element_blank())+
  scale_fill_manual(values=c("Observations"="green", "Model"="orange"))+
  xlab(paste(unit,"Range")) +
  ylab("Duration(h)")
p53

ggsave(paste("",dir,"capdurspr.png",sep=""))
print("saved 20.image")

###################### autumn

zlo2<-lengthEvents(filtersx(moda$effekt,0.0000000000000000000001,-1))
zlo2y<-data.frame(zlo2,rep("0",length(zlo2)))
names(zlo2y)<-c("duration","cfactor")
mlo2<-lengthEvents(filtersx(moda$effekt,pseq[2],0.0000000000000000000001))
mlo2y<-data.frame(mlo2,rep("0 - 0.1",length(mlo2)))
names(mlo2y)<-c("duration","cfactor")
m1lo2<-lengthEvents(filtersx(moda$effekt,pseq[3],pseq[2]))
m1lo2y<-data.frame(m1lo2,rep("0.1 - 0.2",length(m1lo2)))
names(m1lo2y)<-c("duration","cfactor")
m2lo2<-lengthEvents(filtersx(moda$effekt,pseq[4],pseq[3]))
m2lo2y<-data.frame(m2lo2,rep("0.2 - 0.3",length(m2lo2)))
names(m2lo2y)<-c("duration","cfactor")
m3lo2<-lengthEvents(filtersx(moda$effekt,pseq[5],pseq[4]))
m3lo2y<-data.frame(m3lo2,rep("0.3 - 0.4",length(m3lo2)))
names(m3lo2y)<-c("duration","cfactor")
m4lo2<-lengthEvents(filtersx(moda$effekt,pseq[6],pseq[5]))
m4lo2y<-data.frame(m4lo2,rep("0.4 - 0.5",length(m4lo2)))
names(m4lo2y)<-c("duration","cfactor")
m5lo2<-lengthEvents(filtersx(moda$effekt,pseq[7],pseq[6]))
m5lo2y<-data.frame(m5lo2,rep("0.5 - 0.6",length(m5lo2)))
names(m5lo2y)<-c("duration","cfactor")
m6lo2<-lengthEvents(filtersx(moda$effekt,pseq[8],pseq[7]))
m6lo2y<-data.frame(m6lo2,rep("0.6 - 0.7",length(m6lo2)))
names(m6lo2y)<-c("duration","cfactor")
m7lo2<-lengthEvents(filtersx(moda$effekt,pseq[9],pseq[8]))
m7lo2y<-data.frame(m7lo2,rep("0.7 - 0.8",length(m7lo2)))
names(m7lo2y)<-c("duration","cfactor")
olo2<-lengthEvents(filtersx(moda$effekt,pseq[10],pseq[9]))
olo2y<-data.frame(olo2,rep("0.8 - 1",length(olo2)))
names(olo2y)<-c("duration","cfactor")

Modl<-rbind(zlo2y,mlo2y,m1lo2y,m2lo2y,m3lo2y,m4lo2y,m5lo2y,m6lo2y,m7lo2y,olo2y)

zl<-lengthEvents(filtersx(obsa$effekt,0.0000000000000000000001,-1))
zly<-data.frame(zl,rep("0",length(zl)))
names(zly)<-c("duration","cfactor")
ml<-lengthEvents(filtersx(obsa$effekt,pseq[2],0.0000000000000000000001))
mly<-data.frame(ml,rep("0 - 0.1",length(ml)))
names(mly)<-c("duration","cfactor")
m1l<-lengthEvents(filtersx(obsa$effekt,pseq[3],pseq[2]))
m1ly<-data.frame(m1l,rep("0.1 - 0.2",length(m1l)))
names(m1ly)<-c("duration","cfactor")
m2l<-lengthEvents(filtersx(obsa$effekt,pseq[4],pseq[3]))
m2ly<-data.frame(m2l,rep("0.2 - 0.3",length(m2l)))
names(m2ly)<-c("duration","cfactor")
m3l<-lengthEvents(filtersx(obsa$effekt,pseq[5],pseq[4]))
m3ly<-data.frame(m3l,rep("0.3 - 0.4",length(m3l)))
names(m3ly)<-c("duration","cfactor")
m4l<-lengthEvents(filtersx(obsa$effekt,pseq[6],pseq[5]))
m4ly<-data.frame(m4l,rep("0.4 - 0.5",length(m4l)))
names(m4ly)<-c("duration","cfactor")
m5l<-lengthEvents(filtersx(obsa$effekt,pseq[7],pseq[6]))
m5ly<-data.frame(m5l,rep("0.5 - 0.6",length(m5l)))
names(m5ly)<-c("duration","cfactor")
m6l<-lengthEvents(filtersx(obsa$effekt,pseq[8],pseq[7]))
m6ly<-data.frame(m6l,rep("0.6 - 0.7",length(m6l)))
names(m6ly)<-c("duration","cfactor")
m7l<-lengthEvents(filtersx(obsa$effekt,pseq[9],pseq[8]))
m7ly<-data.frame(m7l,rep("0.7 - 0.8",length(m7l)))
names(m7ly)<-c("duration","cfactor")
ol<-lengthEvents(filtersx(obsa$effekt,pseq[10],pseq[9]))
oly<-data.frame(ol,rep("0.8 - 1",length(ol)))
names(oly)<-c("duration","cfactor")

Observations<-rbind(zly,mly,m1ly,m2ly,m3ly,m4ly,m5ly,m6ly,m7ly,oly)

Obs<-data.frame(Observations,rep("Observations",length(Observations$duration)))
names(Obs)<-c("duration","cfactor","type")
OL<-data.frame(Modl,rep("Model",length(Modl$duration)))
names(OL)<-c("duration","cfactor","type")
OLobs<-rbind(OL,Obs)

p54 <- ggplot(data=OLobs, aes(x=cfactor, y=duration)) +
  geom_boxplot( aes(fill=type))+
  geom_boxplot( aes(fill=type))+
  theme(legend.title=element_blank())+
  scale_fill_manual(values=c("Observations"="green", "Model"="orange"))+
  xlab(paste(unit,"Range")) +
  ylab("Duration(h)")
p54

ggsave(paste("",dir,"capduraut.png",sep=""))
print("saved 21.image")
}

################ capacity factor Frequency #######################

if(type==1||type==2){
breaks = seq(0, pseq[10], by=binwidths) 
duration.cut = cut(mod$effekt, breaks, right=FALSE) 
duration.freq = c(0,table(duration.cut))
duration.cut.obs = cut(obs$effekt,breaks, right=FALSE) 
duration.freq.obs = c(0,table(duration.cut.obs))

cff<-as_tibble(as.data.frame(data.frame(duration.freq, duration.freq.obs)))

p3 <- ggplot() +
  geom_line(data=cff, aes(x =seq(0, pseq[10], by=binwidths), y = duration.freq.obs, color="Observations"), size=1)+
  geom_line(data=cff, aes(x = seq(0, pseq[10], by=binwidths), y = duration.freq, color="Model"), size=1)+
  theme(legend.title=element_blank())+
  xlab(paste(unit2)) +
  ylab("Frequency") +
  #coord_cartesian(xlim = c(0, 0.82))+
  scale_color_manual(values=c("Observations"="green",
                              "Model"="orange"))

p3  

ggsave(paste("",dir,"capfreqtot.png",sep=""))
print("saved 22.image")

################################

tmc<-data.frame(mod$effekt,obs$effekt)

p5 <- ggplot(data=tmc,aes(x=obs.effekt,y=mod.effekt)) +
  geom_point(shape=1)+
  geom_smooth(method=lm,colour="orange")+
  geom_abline(colour="green")+
  xlab("Observations (MW)") +
  ylab("Model (MW)") +
  scale_color_manual(values=c("Observations"="green",
                              "Model"="orange"))

p5

ggsave(paste("",dir,"scattertot.png",sep=""))
print("saved 23.image")

}

#winter

if(type==1||type==3){
  
tmcw<-data.frame(modw$effekt,obsw$effekt)

p55 <- ggplot(data=tmcw,aes(x=obsw.effekt,y=modw.effekt)) +
  geom_point(shape=1)+
  geom_smooth(method=lm,colour="orange")+
  geom_abline(colour="green")+
  theme(legend.title=element_blank())+
  xlab("Observations") +
  ylab("Model") +
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p55  

ggsave(paste("",dir,"scatwin.png",sep=""))
print("saved 24.image")

#spring
tmcsp<-data.frame(modsp$effekt,obssp$effekt)

p56 <- ggplot(data=tmcsp,aes(x=obssp.effekt,y=modsp.effekt)) +
  geom_point(shape=1)+
  geom_smooth(method=lm,colour="orange")+
  geom_abline(colour="green")+
  theme(legend.title=element_blank())+
  xlab("Observations") +
  ylab("Model") +
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p56

ggsave(paste("",dir,"scatspr.png",sep=""))
print("saved 25.image")

#summer

tmcs<-data.frame(mods$effekt,obss$effekt)

p57 <- ggplot(data=tmcs,aes(x=obss.effekt,y=mods.effekt)) +
  geom_point(shape=1)+
  geom_smooth(method=lm,colour="orange")+
  geom_abline(colour="green")+
  theme(legend.title=element_blank())+
  xlab("Observations") +
  ylab("Model") +
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p57

ggsave(paste("",dir,"scatsum.png",sep=""))
print("saved 26.image")

#autumn

tmca<-data.frame(moda$effekt,obsa$effekt)

p58 <- ggplot(data=tmca,aes(x=obsa.effekt,y=moda.effekt)) +
  geom_point(shape=1)+
  geom_smooth(method=lm,colour="orange")+
  geom_abline(colour="green")+
  theme(legend.title=element_blank())+
  xlab("Observations") +
  ylab("Model") +
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p58

ggsave(paste("",dir,"scataut.png",sep=""))
print("saved 27.image")

}

################################# rate of change
if(type==1){

rocr1h<-(obs$effekt[2:length(obs$effekt)]-obs$effekt[1:(length(obs$effekt)-1)])
nroc1h<-data.frame(rocr1h,rep("Observation",length(rocr1h)))
names(nroc1h)<-c("rate","class")
roc2r1h<-(mod$effekt[2:length(mod$effekt)]-mod$effekt[1:(length(mod$effekt)-1)])
nroc2r1h<-data.frame(roc2r1h,rep("Model",length(roc2r1h)))
names(nroc2r1h)<-c("rate","class")

roc1h<-as_tibble(data.frame(rocr1h,roc2r1h))

p6 <- ggplot() +
  stat_ecdf(data=roc1h,aes(x=rocr1h, color="Observations"),geom="step")+
  stat_ecdf(data=roc1h,aes(x=roc2r1h, color="Model"),geom="step")+
  theme(legend.title=element_blank())+
  xlab(paste("1h",paste(unit2),"Change"))+
  ylab("Cumulative Density")+
  #coord_cartesian(xlim = c(-0.2, 0.2))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p6  

ggsave(paste("",dir,"1hcapchangedenstot.png",sep=""))
print("saved 28.image")

se<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+12,1)}))
tsx<-mod$effekt[se]-rep(mod$effekt,each=12)

breaksx = seq(-1, 1, by=0.01) 
tsx.cut = cut(tsx, breaksx, right=FALSE) 
tsx.freq = table(tsx.cut)
tsx12h<-data.frame(breaksx[2:length(breaksx)], tsx.freq)
names(tsx12h)<-c("CFchange","bins","Frequency")
rc12h<-as_tibble(tsx12h)

seo<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+12,1)}))
tsxo<-obs$effekt[seo]-rep(obs$effekt,each=12)
breaksxo = seq(-1, 1, by=0.01) 
tsxo.cut = cut(tsxo, breaksxo, right=FALSE) 
tsxo.freq = table(tsxo.cut)
tsxo12h<-data.frame(breaksxo[2:length(breaksxo)], tsxo.freq)
names(tsxo12h)<-c("CFchange","bins","Frequency")
rco12h<-as_tibble(tsxo12h)


se1<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+1,1)}))
tsx1<-mod$effekt[se1]-rep(mod$effekt,each=1)

breaksx1 = seq(-1, 1, by=0.01) 
tsx1.cut = cut(tsx1, breaksx1, right=FALSE) 
tsx1.freq = table(tsx1.cut)
tsx1h<-data.frame(breaksx1[2:length(breaksx1)], tsx1.freq)
names(tsx1h)<-c("CFchange","bins","Frequency")
rc1h<-as_tibble(tsx1h)

se1o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+1,1)}))
tsx1o<-obs$effekt[se1o]-rep(obs$effekt,each=1)
breaksx1o = seq(-1, 1, by=0.01) 
tsx1o.cut = cut(tsx1o, breaksx1o, right=FALSE) 
tsx1o.freq = table(tsx1o.cut)
tsxo1h<-data.frame(breaksx1o[2:length(breaksx1o)], tsx1o.freq)
names(tsxo1h)<-c("CFchange","bins","Frequency")
rco1h<-as_tibble(tsxo1h)


se2<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+3,1)}))
tsx2<-mod$effekt[se2]-rep(mod$effekt,each=3)

breaksx2 = seq(-1, 1, by=0.01) 
tsx2.cut = cut(tsx2, breaksx2, right=FALSE) 
tsx2.freq = table(tsx2.cut)
tsx3h<-data.frame(breaksx2[2:length(breaksx2)], tsx2.freq)
names(tsx3h)<-c("CFchange","bins","Frequency")
rc3h<-as_tibble(tsx3h)

se2o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+3,1)}))
tsx2o<-obs$effekt[se2o]-rep(obs$effekt,each=3)
breaksx2o = seq(-1, 1, by=0.01) 
tsx2o.cut = cut(tsx2o, breaksx2o, right=FALSE) 
tsx2o.freq = table(tsx2o.cut)
tsxo3h<-data.frame(breaksx2o[2:length(breaksx2o)], tsx2o.freq)
names(tsxo3h)<-c("CFchange","bins","Frequency")
rco3h<-as_tibble(tsxo3h)


se3<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+6,1)}))
tsx3<-mod$effekt[se3]-rep(mod$effekt,each=6)

breaksx3 = seq(-1, 1, by=0.01) 
tsx3.cut = cut(tsx3, breaksx3, right=FALSE) 
tsx3.freq = table(tsx3.cut)
tsx6h<-data.frame(breaksx3[2:length(breaksx3)], tsx3.freq)
names(tsx6h)<-c("CFchange","bins","Frequency")
rc6h<-as_tibble(tsx6h)

se3o<<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+6,1)}))
tsx3o<<-obs$effekt[se3o]-rep(obs$effekt,each=6)
breaksx3o = seq(-1, 1, by=0.01) 
tsx3o.cut = cut(tsx3o, breaksx3o, right=FALSE) 
tsx3o.freq = table(tsx3o.cut)
tsxo6h<-data.frame(breaksx3o[2:length(breaksx3o)], tsx3o.freq)
names(tsxo6h)<-c("CFchange","bins","Frequency")
rco6h<-as_tibble(tsxo6h)

se4<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+24,1)}))
tsx4<-mod$effekt[se4]-rep(mod$effekt,each=24)
breaksx4 = seq(-1, 1, by=0.01) 
tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
tsx4.freq = table(tsx4.cut)
tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
names(tsx24h)<-c("CFchange","bins","Frequency")
rc24h<-as_tibble(tsx24h)


se4o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+24,1)}))
tsx4o<-obs$effekt[se4o]-rep(obs$effekt,each=24)
breaksx4o = seq(-1, 1, by=0.01) 
tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
tsx4o.freq = table(tsx4o.cut)
tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
names(tsxo24h)<-c("CFchange","bins","Frequency")
rco24h<-as_tibble(tsxo24h)

ts24o<-data.frame(tsx4o,rep("24h",length(tsx4o)),rep("o",length(tsx4o)))
names(ts24o)<-c("roc","tf","type")

ts24m<-data.frame(tsx4,rep("24h",length(tsx4)),rep("m",length(tsx4o)))
names(ts24m)<-c("roc","tf","type")

ts6o<-data.frame(tsx3o,rep("6h",length(tsx3o)),rep("o",length(tsx4o)))
names(ts6o)<-c("roc","tf","type")

ts6m<-data.frame(tsx3,rep("6h",length(tsx3)),rep("m",length(tsx4o)))
names(ts6m)<-c("roc","tf","type")

ts3o<-data.frame(tsx2o,rep("3h",length(tsx2o)),rep("o",length(tsx4o)))
names(ts3o)<-c("roc","tf","type")

ts3m<-data.frame(tsx2,rep("3h",length(tsx2)),rep("m",length(tsx4o)))
names(ts3m)<-c("roc","tf","type")

ts1o<-data.frame(tsx1o,rep("1h",length(tsx1o)),rep("o",length(tsx4o)))
names(ts1o)<-c("roc","tf","type")

ts1m<-data.frame(tsx1,rep("1h",length(tsx1)),rep("m",length(tsx4o)))
names(ts1m)<-c("roc","tf","type")

ts12o<-data.frame(tsxo,rep("12h",length(tsxo)),rep("o",length(tsx4o)))
names(ts12o)<-c("roc","tf","type")

ts12m<-data.frame(tsx,rep("12h",length(tsx)),rep("m",length(tsx4o)))
names(ts12m)<-c("roc","tf","type")


tst<<-as_tibble(rbind(ts1o,ts3o,ts6o,ts12o,ts24o,ts1m,ts3m,ts6m,ts12m,ts24m))

proc<-ggplot(data = tst, aes(x=tf, y=roc)) + geom_boxplot(aes(fill=type))

# proc <- ggplot()+
# geom_boxplot(data=tso, aes(y=roc,x=tf),fill="brown")+
# geom_boxplot(data=tsm, aes(y=roc,x=tf),fill="orange")
  

proc

ggsave(paste("",dir,"roctot.png",sep=""))
print("saved 73.image")

roc24h<-as_tibble(data.frame(tsx4,tsx4o))

maxh12mod<-max(tsx,na.rm=TRUE)
maxh1mod<-max(tsx1,na.rm=TRUE)
maxh3mod<-max(tsx2,na.rm=TRUE)
maxh6mod<-max(tsx3,na.rm=TRUE)
maxh24mod<-max(tsx4,na.rm=TRUE)

maxh12obs<-max(tsxo,na.rm=TRUE)
maxh1obs<-max(tsx1o,na.rm=TRUE)
maxh3obs<-max(tsx2o,na.rm=TRUE)
maxh6obs<-max(tsx3o,na.rm=TRUE)
maxh24obs<-max(tsx4o,na.rm=TRUE)

freh12mod<-length(tsx[which(tsx>=0.2)])
freh1mod<-length(tsx1[which(tsx1>=0.2)])
freh3mod<-length(tsx2[which(tsx2>=0.2)])
freh6mod<-length(tsx3[which(tsx3>=0.2)])
freh24mod<-length(tsx4[which(tsx4>=0.2)])

frel12mod<-length(tsx[which(tsx<=-0.2)])
frel1mod<-length(tsx1[which(tsx1<=-0.2)])
frel3mod<-length(tsx2[which(tsx2<=-0.2)])
frel6mod<-length(tsx3[which(tsx3<=-0.2)])
frel24mod<-length(tsx4[which(tsx4<=-0.2)])

freh12obs<-length(tsxo[which(tsxo>=0.2)])
freh1obs<-length(tsx1o[which(tsx1o>=0.2)])
freh3obs<-length(tsx2o[which(tsx2o>=0.2)])
freh6obs<-length(tsx3o[which(tsx3o>=0.2)])
freh24obs<-length(tsx4o[which(tsx4o>=0.2)])

frel12obs<-length(tsxo[which(tsxo<=-0.2)])
frel1obs<-length(tsx1o[which(tsx1o<=-0.2)])
frel3obs<-length(tsx2o[which(tsx2o<=-0.2)])
frel6obs<-length(tsx3o[which(tsx3o<=-0.2)])
frel24obs<-length(tsx4o[which(tsx4o<=-0.2)])

minh12mod<-min(tsx,na.rm=TRUE)
minh1mod<-min(tsx1,na.rm=TRUE)
minh3mod<-min(tsx2,na.rm=TRUE)
minh6mod<-min(tsx3,na.rm=TRUE)
minh24mod<-min(tsx4,na.rm=TRUE)

minh12obs<-min(tsxo,na.rm=TRUE)
minh1obs<-min(tsx1o,na.rm=TRUE)
minh3obs<-min(tsx2o,na.rm=TRUE)
minh6obs<-min(tsx3o,na.rm=TRUE)
minh24obs<-min(tsx4o,na.rm=TRUE)

meanh12mod<-format(mean(tsx,na.rm=TRUE),scientific=FALSE)
meanh1mod<-format(mean(tsx1,na.rm=TRUE),scientific=FALSE)
meanh3mod<-format(mean(tsx2,na.rm=TRUE),scientific=FALSE)
meanh6mod<-format(mean(tsx3,na.rm=TRUE),scientific=FALSE)
meanh24mod<-format(mean(tsx4,na.rm=TRUE),scientific=FALSE)
                 
meanh12obs<-format(mean(tsxo,na.rm=TRUE),scientific=FALSE)
meanh1obs<-format(mean(tsx1o,na.rm=TRUE),scientific=FALSE)
meanh3obs<-format(mean(tsx2o,na.rm=TRUE),scientific=FALSE)
meanh6obs<-format(mean(tsx3o,na.rm=TRUE),scientific=FALSE)
meanh24obs<-format(mean(tsx4o,na.rm=TRUE),scientific=FALSE)

dr<<-data.frame(rbind(minh1mod,minh3mod,minh6mod,minh12mod,minh24mod,minh1obs,minh3obs,minh6obs,minh12obs,minh24obs),rbind(meanh1mod,meanh3mod,meanh6mod,meanh12mod,meanh24mod,meanh1obs,meanh3obs,meanh6obs,meanh12obs,meanh24obs),rbind(maxh1mod,maxh3mod,maxh6mod,maxh12mod,maxh24mod,maxh1obs,maxh3obs,maxh6obs,maxh12obs,maxh24obs),rbind(freh1mod,freh3mod,freh6mod,freh12mod,freh24mod,freh1obs,freh3obs,freh6obs,freh12obs,freh24obs),rbind(frel1mod,frel3mod,frel6mod,frel12mod,frel24mod,frel1obs,frel3obs,frel6obs,frel12obs,frel24obs))
names(dr)<-c("Min","Mean","Max", "Frequency (> 0.2 ?? CF)", "Frequency (< -0.2 ?? CF)")
rownames(dr)<-c("1h-m", "3h-m", "6h-m", "12h-m", "24h-m","1h-o","3h-o","6h-o","12h-o","24h-o")


png(paste("",dir,"dr.png",sep=""), height = 50*nrow(dr), width = 200*ncol(dr))
grid.table(dr)
dev.off()

# drt<-kable(dr,digits=2)
# drt
# write(drt,file='drt.html')

p59 <- ggplot() +
  stat_ecdf(data=roc24h,aes(x=tsx4o, color="Observations"),geom="step")+
  stat_ecdf(data=roc24h,aes(x=tsx4, color="Model"),geom="step")+
  theme(legend.title=element_blank())+
  xlab(paste("24h",paste(unit2),"Change"))+
  ylab("Cumulative Density")+
  #coord_cartesian(xlim = c(-1, 1))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p59  

ggsave(paste("",dir,"24hcapchangedenstot.png",sep=""))
print("saved 29.image")

roc12h<-as_tibble(data.frame(tsx,tsxo))

p60 <- ggplot() +
  stat_ecdf(data=roc12h,aes(x=tsxo, color="Observations"),geom="step")+
  stat_ecdf(data=roc12h,aes(x=tsx, color="Model"),geom="step")+
  theme(legend.title=element_blank())+
  xlab(paste("12h",paste(unit2),"Change"))+
  ylab("Cumulative Density")+
  #coord_cartesian(xlim = c(-1, 1))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p60  

ggsave(paste("",dir,"12hcapchangedenstot.png",sep=""))
print("saved 30.image")

roc6h<-as_tibble(data.frame(tsx3,tsx3o))

p61 <- ggplot() +
  stat_ecdf(data=roc6h,aes(x=tsx3o, color="Observations"),geom="step")+
  stat_ecdf(data=roc6h,aes(x=tsx3, color="Model"),geom="step")+
  theme(legend.title=element_blank())+
  xlab(paste("6h",paste(unit2),"Change"))+
  ylab("Cumulative Density")+
  #coord_cartesian(xlim = c(-1, 1))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p61

ggsave(paste("",dir,"6hcapchangedenstot.png",sep=""))
print("saved 31.image")

roc3h<-as_tibble(data.frame(tsx2,tsx2o))

p62 <- ggplot() +
  stat_ecdf(data=roc3h,aes(x=tsx2o, color="Observations"),geom="step")+
  stat_ecdf(data=roc3h,aes(x=tsx2, color="Model"),geom="step")+
  theme(legend.title=element_blank())+
  xlab(paste("3h",paste(unit2),"Change"))+
  ylab("Cumulative Density")+
  #coord_cartesian(xlim = c(-1, 1))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p62  

ggsave(paste("",dir,"3hcapchangedenstot.png",sep=""))
print("saved 32.image")

roc1h<-as_tibble(data.frame(tsx1,tsx1o))

p63 <- ggplot() +
  stat_ecdf(data=roc1h,aes(x=tsx1o, color="Observations"),geom="step")+
  stat_ecdf(data=roc1h,aes(x=tsx1, color="Model"),geom="step")+
  theme(legend.title=element_blank())+
  xlab(paste("1h",paste(unit2),"Change"))+
  ylab("Cumulative Density")+
  #coord_cartesian(xlim = c(-1, 1))+
  scale_color_manual(values=c("Observations"="green", 
                              "Model"="orange"))

p63  

ggsave(paste("",dir,"1hcapchangedenstot.png",sep=""))
print("saved 33.image")

########################## rapid change


se<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+12,1)}))
tsx<-mod$effekt[se]-rep(mod$effekt,each=12)

breaksx = seq(-pseq[10], pseq[10], by=binwidths) 
tsx.cut = cut(tsx, breaksx, right=FALSE) 
tsx.freq = table(tsx.cut)
tsx12h<-data.frame(breaksx[2:length(breaksx)], tsx.freq)
names(tsx12h)<-c("CFchange","bins","Frequency")
rc12h<-as_tibble(tsx12h)

seo<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+12,1)}))
tsxo<-obs$effekt[seo]-rep(obs$effekt,each=12)
breaksxo = seq(-pseq[10], pseq[10], by=binwidths) 
tsxo.cut = cut(tsxo, breaksxo, right=FALSE) 
tsxo.freq = table(tsxo.cut)
tsxo12h<-data.frame(breaksxo[2:length(breaksxo)], tsxo.freq)
names(tsxo12h)<-c("CFchange","bins","Frequency")
rco12h<-as_tibble(tsxo12h)


se1<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+1,1)}))
tsx1<-mod$effekt[se1]-rep(mod$effekt,each=1)

breaksx1 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx1.cut = cut(tsx1, breaksx1, right=FALSE) 
tsx1.freq = table(tsx1.cut)
tsx1h<-data.frame(breaksx1[2:length(breaksx1)], tsx1.freq)
names(tsx1h)<-c("CFchange","bins","Frequency")
rc1h<-as_tibble(tsx1h)

se1o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+1,1)}))
tsx1o<-obs$effekt[se1o]-rep(obs$effekt,each=1)
breaksx1o = seq(-pseq[10], pseq[10], by=binwidths) 
tsx1o.cut = cut(tsx1o, breaksx1o, right=FALSE) 
tsx1o.freq = table(tsx1o.cut)
tsxo1h<-data.frame(breaksx1o[2:length(breaksx1o)], tsx1o.freq)
names(tsxo1h)<-c("CFchange","bins","Frequency")
rco1h<-as_tibble(tsxo1h)


se2<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+3,1)}))
tsx2<-mod$effekt[se2]-rep(mod$effekt,each=3)

breaksx2 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx2.cut = cut(tsx2, breaksx2, right=FALSE) 
tsx2.freq = table(tsx2.cut)
tsx3h<-data.frame(breaksx2[2:length(breaksx2)], tsx2.freq)
names(tsx3h)<-c("CFchange","bins","Frequency")
rc3h<-as_tibble(tsx3h)

se2o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+3,1)}))
tsx2o<-obs$effekt[se2o]-rep(obs$effekt,each=3)
breaksx2o = seq(-pseq[10], pseq[10], by=binwidths)
tsx2o.cut = cut(tsx2o, breaksx2o, right=FALSE) 
tsx2o.freq = table(tsx2o.cut)
tsxo3h<-data.frame(breaksx2o[2:length(breaksx2o)], tsx2o.freq)
names(tsxo3h)<-c("CFchange","bins","Frequency")
rco3h<-as_tibble(tsxo3h)


se3<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+6,1)}))
tsx3<-mod$effekt[se3]-rep(mod$effekt,each=6)

breaksx3 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx3.cut = cut(tsx3, breaksx3, right=FALSE) 
tsx3.freq = table(tsx3.cut)
tsx6h<-data.frame(breaksx3[2:length(breaksx3)], tsx3.freq)
names(tsx6h)<-c("CFchange","bins","Frequency")
rc6h<-as_tibble(tsx6h)

se3o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+6,1)}))
tsx3o<-obs$effekt[se3o]-rep(obs$effekt,each=6)
breaksx3o = seq(-pseq[10], pseq[10], by=binwidths) 
tsx3o.cut = cut(tsx3o, breaksx3o, right=FALSE) 
tsx3o.freq = table(tsx3o.cut)
tsxo6h<-data.frame(breaksx3o[2:length(breaksx3o)], tsx3o.freq)
names(tsxo6h)<-c("CFchange","bins","Frequency")
rco6h<-as_tibble(tsxo6h)

se4<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+24,1)}))
tsx4<-mod$effekt[se4]-rep(mod$effekt,each=24)
breaksx4 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
tsx4.freq = table(tsx4.cut)
tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
names(tsx24h)<-c("CFchange","bins","Frequency")
rc24h<-as_tibble(tsx24h)


se4o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+24,1)}))
tsx4o<-obs$effekt[se4o]-rep(obs$effekt,each=24)
breaksx4o = seq(-pseq[10], pseq[10], by=binwidths) 
tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
tsx4o.freq = table(tsx4o.cut)
tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
names(tsxo24h)<-c("CFchange","bins","Frequency")
rco24h<-as_tibble(tsxo24h)

summary(tsx)
summary(tsx1)
summary(tsx2)
summary(tsx3)
summary(tsx4)

summary(tsxo)
summary(tsx1o)
summary(tsx2o)
summary(tsx3o)
summary(tsx4o)

length(tsx[which(tsx>=0.2)])
length(tsx1[which(tsx1>=0.2)])
length(tsx2[which(tsx2>=0.2)])
length(tsx3[which(tsx3>=0.2)])
length(tsx4[which(tsx4>=0.2)])

length(tsx[which(tsx<=-0.2)])
length(tsx1[which(tsx1<=-0.2)])
length(tsx2[which(tsx2<=-0.2)])
length(tsx3[which(tsx3<=-0.2)])
length(tsx4[which(tsx4<=-0.2)])

length(tsxo[which(tsxo>=0.2)])
length(tsx1o[which(tsx1o>=0.2)])
length(tsx2o[which(tsx2o>=0.2)])
length(tsx3o[which(tsx3o>=0.2)])
length(tsx4o[which(tsx4o>=0.2)])

length(tsxo[which(tsxo<=-0.2)])
length(tsx1o[which(tsx1o<=-0.2)])
length(tsx2o[which(tsx2o<=-0.2)])
length(tsx3o[which(tsx3o<=-0.2)])
length(tsx4o[which(tsx4o<=-0.2)])

p7 <- ggplot() +
  geom_line(data=rc24h,aes(x=CFchange, y=Frequency, colour="Model", linetype="24h"),size=1)+
  geom_line(data=rco24h,aes(x=CFchange, y=Frequency, colour="Observations", linetype="24h"),size=1)+
  theme(legend.title=element_blank())+
  geom_line(data=rc12h,aes(x=CFchange, y=Frequency, colour="Model", linetype="12h"),size=1)+
  geom_line(data=rco12h,aes(x=CFchange, y=Frequency, colour="Observations", linetype="12h"),size=1)+
  geom_line(data=rc1h,aes(x=CFchange, y=Frequency, colour="Model", linetype="1h"),size=1)+
  geom_line(data=rco1h,aes(x=CFchange, y=Frequency, colour="Observations", linetype="1h"),size=1)+
  geom_line(data=rc3h,aes(x=CFchange, y=Frequency, colour="Model", linetype="3h"),size=1)+
  geom_line(data=rco3h,aes(x=CFchange, y=Frequency, colour="Observations", linetype="3h"),size=1)+
  geom_line(data=rc6h,aes(x=CFchange, y=Frequency, colour="Model", linetype="6h"),size=1)+
  geom_line(data=rco6h,aes(x=CFchange, y=Frequency, colour="Observations", linetype="6h"),size=1)+
  ylab("Frequency") +
  scale_x_continuous(name=paste(paste(unit2),"Change"),breaks=seq(-pseq[10], pseq[10], by=binwidths2*2))+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  scale_linetype_manual(values=c("24h"="solid", "12h"="longdash","6h"="dotted","3h"="dotdash","1h"="twodash"))

p7+
  theme(legend.title=element_blank())

ggsave(paste("",dir,"capchangefreqtot.png",sep=""))
print("saved 34.image")

}

#################### seasonal
#################### merging may influence results negatively

#winter(d,j,f), spring(m,a,m), summer(j,j,a), autumn(s,o,n)


#length(modw$date[which(as.numeric(format(modw$date,"%Y"))==2010)])
#length(mods$date[which(as.numeric(format(mods$date,"%Y"))==2010)])
#length(modw$date[which(as.numeric(format(modw$date,"%Y"))==2010)])

if(type==1||type==3||type==4){

#w

###########Durations

perslowobs<-lengthEvents(filtersx(obsw$effekt,lbreaks[1],-1))
perslow1obs<-lengthEvents(filtersx(obsw$effekt,lbreaks[2],-1))
perslow2obs<-lengthEvents(filtersx(obsw$effekt,lbreaks[3],-1))
perslowmod<<-lengthEvents(filtersx(modw$effekt,lbreaks[1],-1))
perslow1mod<-lengthEvents(filtersx(modw$effekt,lbreaks[2],-1))
perslow2mod<-lengthEvents(filtersx(modw$effekt,lbreaks[3],-1))

if(length(perslowmod)>0){breaks = seq(1, max(perslowmod), by=1) 
if(length(breaks) > 1) {persduration.cut = cut(perslowmod, breaks, right=FALSE) 
persduration.freq = c(table(persduration.cut),0)
low1modw<-as_tibble(data.frame(breaks,persduration.freq))}else{low1modw<-data.frame(breaks,perslowmod)}}else {
  breaks<-0
  persduration.freq<-0
  low1modw<-as_tibble(data.frame(breaks,persduration.freq))}

#breaks = seq(1, max(perslowmod), by=1) 
#persduration.cut = cut(perslowmod, breaks, right=FALSE) 
#persduration.freq = c(table(persduration.cut),0)
#low1modw<-as_tibble(data.frame(breaks,persduration.freq))
#names(low1)

#plot(perslow1mod,type="n",xlim=c(0,30),ylim=c(0,75),xlab="Duration of Events(h)",ylab="Frequency")
#lines(breaks2[1:length(breaks2)] , persduration.freq2,col="orange",lwd=1)
breaks2 = seq(1, max(perslow1mod), by=1) 
persduration.cut2 = cut(perslow1mod, breaks2, right=FALSE) 
persduration.freq2 = c(table(persduration.cut2),0)
low2modw<-as_tibble(data.frame(breaks2,persduration.freq2))
#lines(breaks2[1:length(breaks2)], persduration.freq2,col="green",lwd=1)
breaks3 = seq(1, max(perslow2mod), by=1) 
persduration.cut3 = cut(perslow2mod, breaks3, right=FALSE) 
persduration.freq3 = c(table(persduration.cut3),0)
low3modw<-as_tibble(data.frame(breaks3,persduration.freq3))

if(length(perslowobs)>0){breaks4 = seq(1, max(perslowobs), by=1) 
if(length(breaks4) > 1) {persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
persduration.freq4 = c(table(persduration.cut4),0)
low1obsw<-as_tibble(data.frame(breaks4,persduration.freq4))}else{low1obsw<-data.frame(breaks4,perslowobs)}}else {
  breaks4<-0
  persduration.freq4<-0
  low1obsw<-as_tibble(data.frame(breaks4,persduration.freq4))}
  
# breaks4 = seq(1, max(perslowobs), by=1) 
# persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
# persduration.freq4 = c(table(persduration.cut4),0)
# low1obsw<-as_tibble(data.frame(breaks4,persduration.freq4))

#plot(perslow1obs,type="n",xlim=c(0,30),ylim=c(0,75))
#lines(breaks2[1:length(breaks2)], persduration.freq2,col="orange",lwd=2,lty="dashed")
breaks5 = seq(1, max(perslow1obs), by=1) 
persduration.cut5 = cut(perslow1obs, breaks5, right=FALSE) 
persduration.freq5 = c(table(persduration.cut5),0)
low2obsw<-as_tibble(data.frame(breaks5,persduration.freq5))

#lines(breaks2[1:length(breaks2)], persduration.freq2,col="green",lwd=2,lty="dashed")
breaks6 = seq(1, max(perslow2obs), by=1) 
persduration.cut6 = cut(perslow2obs, breaks6, right=FALSE) 
persduration.freq6 = c(table(persduration.cut6),0)
low3obsw<-as_tibble(data.frame(breaks6,persduration.freq6))

l1m<-data.frame(low1modw, rep(l1,length(low1modw$breaks)), rep("Model",length(low1modw$breaks)))
names(l1m)<-c("breaks","Frequency","CF","type")
l2m<-data.frame(low2modw, rep(l2,length(low2modw$breaks2)), rep("Model",length(low2modw$breaks2)))
names(l2m)<-c("breaks","Frequency","CF","type")
l3m<-data.frame(low3modw, rep(l3,length(low3modw$breaks3)), rep("Model",length(low3modw$breaks3)))
names(l3m)<-c("breaks","Frequency","CF","type")
l1o<-data.frame(low1obsw, rep(l1,length(low1obsw$breaks4)), rep("Observations",length(low1obsw$breaks4)))
names(l1o)<-c("breaks","Frequency","CF","type")
l2o<-data.frame(low2obsw, rep(l2,length(low2obsw$breaks5)), rep("Observations",length(low2obsw$breaks5))) 
names(l2o)<-c("breaks","Frequency","CF","type")
l3o<-data.frame(low3obsw, rep(l3,length(low3obsw$breaks6)), rep("Observations",length(low3obsw$breaks6)))
names(l3o)<-c("breaks","Frequency","CF","type")
lowwinter<-rbind(l1m,l2m,l3m,l1o,l2o,l3o)
#lines(breaks2[1:length(breaks2)], persduration.freq2,col="grey",lwd=2,lty="dashed")

p12 <- ggplot(data=lowwinter[which(lowwinter$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab(paste(paste(unit2),"Threshold")) +
  ylab("Duration of Events(h)")
  
p12

ggsave(paste("",dir,"lowcapdurfreqwin.png",sep=""))
print("saved 35.image")

#hbreaks[1]<-(floor(max(obsw$effekt)*10)/10)-0.3
#hbreaks[2]<-(floor(max(obsw$effekt)*10)/10)-0.2
#hbreaks[3]<-(floor(max(obsw$effekt)*10)/10)-0.1

h1<-paste(">",hbreaks[1] ,paste(unit),sep="")
h2<-paste(">",hbreaks[2] ,paste(unit),sep="")
h3<-paste(">",hbreaks[3] ,paste(unit),sep="")

pershighobs<-lengthEvents(filtersx(obsw$effekt,hthres,hbreaks[1]))
pershigh1obs<-lengthEvents(filtersx(obsw$effekt,hthres,hbreaks[2]))
pershigh2obs<-lengthEvents(filtersx(obsw$effekt,hthres,hbreaks[3]))
pershighmod<-lengthEvents(filtersx(modw$effekt,hthres,hbreaks[1]))
pershigh1mod<-lengthEvents(filtersx(modw$effekt,hthres,hbreaks[2]))
pershigh2mod<-lengthEvents(filtersx(modw$effekt,hthres,hbreaks[3]))

#breaks7 = seq(1, max(pershighmod), by=1) 
#persduration.cut7 = cut(pershighmod, breaks7, right=FALSE) 
#persduration.freq7 = c(table(persduration.cut7),0)
#high1modw<-as_tibble(data.frame(breaks7,persduration.freq7))

if(length(pershighmod)>0){breaks7 = seq(1, max(pershighmod), by=1) 
if(length(breaks7) > 1) {persduration.cut7 = cut(pershighmod, breaks7, right=FALSE) 
persduration.freq7 = c(table(persduration.cut7),0)
high1modw<-as_tibble(data.frame(breaks7,persduration.freq7))}else{high1modw<-data.frame(breaks7,pershighmod)}}else {
  breaks7<-0
  persduration.freq7<-0
  high1modw<-as_tibble(data.frame(breaks7,persduration.freq7))}

if(length(pershigh1mod)>0){breaks8 = seq(1, max(pershigh1mod), by=1) 
if(length(breaks8) > 1) {persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
persduration.freq8 = c(table(persduration.cut8),0)
high2modw<-as_tibble(data.frame(breaks8,persduration.freq8))}else{high2modw<-data.frame(breaks8,pershigh1mod)}}else {
  breaks8<-0
  persduration.freq8<-0
  high2modw<-as_tibble(data.frame(breaks8,persduration.freq8))}

# breaks8 = seq(1, max(pershigh1mod), by=1) 
# persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
# persduration.freq8 = c(table(persduration.cut8),0)
# high2modw<-as_tibble(data.frame(breaks8,persduration.freq8))

if(length(pershigh2mod)>0){breaks9 = seq(1, max(pershigh2mod), by=1) 
if(length(breaks9) > 1) {persduration.cut9 = cut(pershigh2mod, breaks9, right=FALSE) 
persduration.freq9 = c(table(persduration.cut9),0)
high3modw<-as_tibble(data.frame(breaks9,persduration.freq9))}else{high3modw<-data.frame(breaks9,pershigh2mod)}}else {
  breaks9<-0
  persduration.freq9<-0
  high3modw<-as_tibble(data.frame(breaks9,persduration.freq9))}

# breaks9 = seq(1, max(pershigh2mod), by=1) 
# persduration.cut9 = cut(pershigh2mod, breaks9, right=FALSE) 
# persduration.freq9 = c(table(persduration.cut9),0)
# high3modw<-as_tibble(data.frame(breaks9,persduration.freq9))

breaks10 = seq(1, max(pershighobs), by=1) 
persduration.cut10 = cut(pershighobs, breaks10, right=FALSE) 
persduration.freq10 = c(table(persduration.cut10),0)
high1obsw<-as_tibble(data.frame(breaks10,persduration.freq10))

if(length(pershigh1obs)>0){breaks11 = seq(1, max(pershigh1obs), by=1) 
if(length(breaks11) > 1) {persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
persduration.freq11 = c(table(persduration.cut11),0)
high2obsw<-as_tibble(data.frame(breaks11,persduration.freq11))}else{high2obsw<-data.frame(breaks11,pershigh1obs)}}else {
  breaks11<-0
  persduration.freq11<-0
  high2obsw<-as_tibble(data.frame(breaks11,persduration.freq11))}

# breaks11 = seq(1, max(pershigh1obs), by=1) 
# persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
# persduration.freq11 = c(table(persduration.cut11),0)
# high2obsw<-as_tibble(data.frame(breaks11,persduration.freq11))

if(length(pershigh2obs)>0){breaks12 = seq(1, max(pershigh2obs), by=1) 
if(length(breaks12) > 1) {persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
persduration.freq12 = c(table(persduration.cut12),0)
high3obsw<-as_tibble(data.frame(breaks12,persduration.freq12))}else{high3obsw<-data.frame(breaks12,pershigh2obs)}}else {
  breaks12<-0
  persduration.freq12<-0
  high3obsw<-as_tibble(data.frame(breaks12,persduration.freq12))}

# breaks12 = seq(1, max(pershigh2obs), by=1) 
# persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
# persduration.freq12 = c(table(persduration.cut12),0)
# high3obsw<-as_tibble(data.frame(breaks12,persduration.freq12))

h1mw<-data.frame(high1modw, rep(h1,length(high1modw$breaks7)), rep("Model",length(high1modw$breaks7)))
names(h1mw)<-c("breaks","Frequency","CF","type")
h2mw<-data.frame(high2modw, rep(h2,length(high2modw$breaks8)), rep("Model",length(high2modw$breaks8)))
names(h2mw)<-c("breaks","Frequency","CF","type")
h3mw<-data.frame(high3modw, rep(h3,length(high3modw$breaks9)), rep("Model",length(high3modw$breaks9)))
names(h3mw)<-c("breaks","Frequency","CF","type")
h1ow<-data.frame(high1obsw, rep(h1,length(high1obsw$breaks10)), rep("Observations",length(high1obsw$breaks10)))
names(h1ow)<-c("breaks","Frequency","CF","type")
h2ow<-data.frame(high2obsw, rep(h2,length(high2obsw$breaks11)), rep("Observations",length(high2obsw$breaks11))) 
names(h2ow)<-c("breaks","Frequency","CF","type")
h3ow<-data.frame(high3obsw, rep(h3,length(high3obsw$breaks12)), rep("Observations",length(high3obsw$breaks12)))
names(h3ow)<-c("breaks","Frequency","CF","type")
highwinter<-rbind(h1mw,h2mw,h3mw,h1ow,h2ow,h3ow)

p13 <- ggplot(data=highwinter[which(highwinter$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab(paste(paste(unit2),"Threshold")) +
  ylab("Duration of Events(h)")
  
p13

ggsave(paste("",dir,"highcapdurfreqwin.png",sep=""))
print("saved 36.image")


#sp

###########Durations

perslowobs<-lengthEvents(filtersx(obssp$effekt,lbreaks[1],-1))
perslow1obs<-lengthEvents(filtersx(obssp$effekt,lbreaks[2],-1))
perslow2obs<-lengthEvents(filtersx(obssp$effekt,lbreaks[3],-1))
perslowmod<-lengthEvents(filtersx(modsp$effekt,lbreaks[1],-1))
perslow1mod<-lengthEvents(filtersx(modsp$effekt,lbreaks[2],-1))
perslow2mod<-lengthEvents(filtersx(modsp$effekt,lbreaks[3],-1))

if(length(perslowmod)>0){breaks = seq(1, max(perslowmod), by=1) 
if(length(breaks) > 1) {persduration.cut = cut(perslowmod, breaks, right=FALSE) 
persduration.freq = c(table(persduration.cut),0)
low1modsp<-as_tibble(data.frame(breaks,persduration.freq))}else{low1modsp<-data.frame(breaks,perslowmod)}}else {
  breaks<-0
  persduration.freq<-0
  low1modsp<-as_tibble(data.frame(breaks,persduration.freq))}

breaks = seq(1, max(perslowmod), by=1) 
persduration.cut = cut(perslowmod, breaks, right=FALSE) 
persduration.freq = c(table(persduration.cut),0)
low1modsp<-as_tibble(data.frame(breaks,persduration.freq))

breaks2 = seq(1, max(perslow1mod), by=1) 
persduration.cut2 = cut(perslow1mod, breaks2, right=FALSE) 
persduration.freq2 = c(table(persduration.cut2),0)
low2modsp<-as_tibble(data.frame(breaks2,persduration.freq2))

breaks3 = seq(1, max(perslow2mod), by=1) 
persduration.cut3 = cut(perslow2mod, breaks3, right=FALSE) 
persduration.freq3 = c(table(persduration.cut3),0)
low3modsp<-as_tibble(data.frame(breaks3,persduration.freq3))

if(length(perslowobs)>0){breaks4 = seq(1, max(perslowobs), by=1) 
if(length(breaks4) > 1) {persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
persduration.freq4 = c(table(persduration.cut4),0)
low1obssp<-as_tibble(data.frame(breaks4,persduration.freq4))}else{low1obssp<-data.frame(breaks4,perslowobs)}}else {
  breaks4<-0
  persduration.freq4<-0
  low1obssp<-as_tibble(data.frame(breaks4,persduration.freq4))}

# breaks4 = seq(1, max(perslowobs), by=1) 
# persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
# persduration.freq4 = c(table(persduration.cut4),0)
# low1obssp<-as_tibble(data.frame(breaks4,persduration.freq4))

breaks5 = seq(1, max(perslow1obs), by=1) 
persduration.cut5 = cut(perslow1obs, breaks5, right=FALSE) 
persduration.freq5 = c(table(persduration.cut5),0)
low2obssp<-as_tibble(data.frame(breaks5,persduration.freq5))

breaks6 = seq(1, max(perslow2obs), by=1) 
persduration.cut6 = cut(perslow2obs, breaks6, right=FALSE) 
persduration.freq6 = c(table(persduration.cut6),0)
low3obssp<-as_tibble(data.frame(breaks6,persduration.freq6))

l1msp<-data.frame(low1modsp, rep(l1,length(low1modsp$breaks)), rep("Model",length(low1modsp$breaks)))
names(l1msp)<-c("breaks","Frequency","CF","type")
l2msp<-data.frame(low2modsp, rep(l2,length(low2modsp$breaks2)), rep("Model",length(low2modsp$breaks2)))
names(l2msp)<-c("breaks","Frequency","CF","type")
l3msp<-data.frame(low3modsp, rep(l3,length(low3modsp$breaks3)), rep("Model",length(low3modsp$breaks3)))
names(l3msp)<-c("breaks","Frequency","CF","type")
l1osp<-data.frame(low1obssp, rep(l1,length(low1obssp$breaks4)), rep("Observations",length(low1obssp$breaks4)))
names(l1osp)<-c("breaks","Frequency","CF","type")
l2osp<-data.frame(low2obssp, rep(l2,length(low2obssp$breaks5)), rep("Observations",length(low2obssp$breaks5))) 
names(l2osp)<-c("breaks","Frequency","CF","type")
l3osp<-data.frame(low3obssp, rep(l3,length(low3obssp$breaks6)), rep("Observations",length(low3obssp$breaks6)))
names(l3osp)<-c("breaks","Frequency","CF","type")
lowspring<-rbind(l1msp,l2msp,l3msp,l1osp,l2osp,l3osp)

p14 <- ggplot(data=lowspring[which(lowspring$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab(paste(paste(unit2),"Threshold")) +
  ylab("Duration of Events(h)")
  
p14

ggsave(paste("",dir,"lowcapdurfreqspr.png",sep=""))
print("saved 37.image")

# hbreaks[1]<-(floor(max(obssp$effekt)*10)/10)-0.3
# hbreaks[2]<-(floor(max(obssp$effekt)*10)/10)-0.2
# hbreaks[3]<-(floor(max(obssp$effekt)*10)/10)-0.1
# 
# h1<-paste(">",hbreaks[1] ,"CF",sep="")
# h2<-paste(">",hbreaks[2] ,"CF",sep="")
# h3<-paste(">",hbreaks[3] ,"CF",sep="")

pershighobs<-lengthEvents(filtersx(obssp$effekt,hthres,hbreaks[1]))
pershigh1obs<-lengthEvents(filtersx(obssp$effekt,hthres,hbreaks[2]))
pershigh2obs<-lengthEvents(filtersx(obssp$effekt,hthres,hbreaks[3]))
pershighmod<-lengthEvents(filtersx(modsp$effekt,hthres,hbreaks[1]))
pershigh1mod<-lengthEvents(filtersx(modsp$effekt,hthres,hbreaks[2]))
pershigh2mod<-lengthEvents(filtersx(modsp$effekt,hthres,hbreaks[3]))

breaks7 = seq(1, max(pershighmod), by=1) 
persduration.cut7 = cut(pershighmod, breaks7, right=FALSE) 
persduration.freq7 = c(table(persduration.cut7),0)
high1modsp<-as_tibble(data.frame(breaks7,persduration.freq7))

if(length(pershigh1mod)>0){breaks8 = seq(1, max(pershigh1mod), by=1) 
if(length(breaks8) > 1) {persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
persduration.freq8 = c(table(persduration.cut8),0)
high2modsp<-as_tibble(data.frame(breaks8,persduration.freq8))}else{high2modsp<-data.frame(breaks8,pershigh1mod)}}else {
  breaks8<-0
  persduration.freq8<-0
  high2modsp<-as_tibble(data.frame(breaks8,persduration.freq8))}

# breaks8 = seq(1, max(pershigh1mod), by=1) 
# persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
# persduration.freq8 = c(table(persduration.cut8),0)
# high2modsp<-as_tibble(data.frame(breaks8,persduration.freq8))


if(length(pershigh2mod)>0){breaks9 = seq(1, max(pershigh2mod), by=1) 
if(length(breaks9) > 1) {persduration.cut9 = cut(pershigh2mod, breaks9, right=FALSE) 
persduration.freq9 = c(table(persduration.cut9),0)
high3modsp<-as_tibble(data.frame(breaks9,persduration.freq9))}else{high3modsp<-data.frame(breaks9,pershigh2mod)}}else {
  breaks9<-0
  persduration.freq9<-0
  high3modsp<-as_tibble(data.frame(breaks9,persduration.freq9))}

# breaks9 <- seq(1, max(pershigh2mod), by=1) 
# 
# if(length(breaks9)>1){persduration.cut9 = cut(pershigh2mod, breaks9, right=FALSE) 
# persduration.freq9 <- c(table(persduration.cut9),0)
# high3modsp<-as_tibble(data.frame(breaks9,persduration.freq9))
# }#else{high3modsp<-data.frame(breaks9,pershigh2mod)}

breaks10 = seq(1, max(pershighobs), by=1) 
persduration.cut10 = cut(pershighobs, breaks10, right=FALSE) 
persduration.freq10 = c(table(persduration.cut10),0)
high1obssp<-as_tibble(data.frame(breaks10,persduration.freq10))

if(length(pershigh1obs)>0){breaks11 = seq(1, max(pershigh1obs), by=1) 
if(length(breaks11) > 1) {persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
persduration.freq11 = c(table(persduration.cut11),0)
high2obssp<-as_tibble(data.frame(breaks11,persduration.freq11))}else{high2obssp<-data.frame(breaks11,pershigh1obs)}}else {
  breaks11<-0
  persduration.freq11<-0
  high2obssp<-as_tibble(data.frame(breaks11,persduration.freq11))}

# breaks11 = seq(1, max(pershigh1obs), by=1) 
# persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
# persduration.freq11 = c(table(persduration.cut11),0)
# high2obssp<-as_tibble(data.frame(breaks11,persduration.freq11))

if(length(pershigh2obs)>0){breaks12 = seq(1, max(pershigh2obs), by=1) 
if(length(breaks12) > 1) {persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
persduration.freq12 = c(table(persduration.cut12),0)
high3obssp<-as_tibble(data.frame(breaks12,persduration.freq12))}else{high3obssp<-data.frame(breaks12,pershigh2obs)}}else {
  breaks12<-0
  persduration.freq12<-0
  high3obssp<-as_tibble(data.frame(breaks12,persduration.freq12))}

# breaks12 = seq(1, max(pershigh2obs), by=1) 
# if(length(breaks12)>1){persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
# persduration.freq12 = c(table(persduration.cut12),0)
# high3obssp<-as_tibble(data.frame(breaks12,persduration.freq12))}#else{high3obssp<-data.frame(breaks12,pershigh2obs)}

h1msp<-data.frame(high1modsp, rep(h1,length(high1modsp$breaks7)), rep("Model",length(high1modsp$breaks7)))
names(h1msp)<-c("breaks","Frequency","CF","type")
h2msp<-data.frame(high2modsp, rep(h2,length(high2modsp$breaks8)), rep("Model",length(high2modsp$breaks8)))
names(h2msp)<-c("breaks","Frequency","CF","type")
h3msp<-data.frame(high3modsp, rep(h3,length(high3modsp$breaks9)), rep("Model",length(high3modsp$breaks9)))
names(h3msp)<-c("breaks","Frequency","CF","type")
h1osp<-data.frame(high1obssp, rep(h1,length(high1obssp$breaks10)), rep("Observations",length(high1obssp$breaks10)))
names(h1osp)<-c("breaks","Frequency","CF","type")
h2osp<-data.frame(high2obssp, rep(h2,length(high2obssp$breaks11)), rep("Observations",length(high2obssp$breaks11))) 
names(h2osp)<-c("breaks","Frequency","CF","type")
h3osp<-data.frame(high3obssp, rep(h3,length(high3obssp$breaks12)), rep("Observations",length(high3obssp$breaks12)))
names(h3osp)<-c("breaks","Frequency","CF","type")
highspring<-rbind(h1msp,h2msp,h3msp,h1osp,h2osp,h3osp)

p15 <- ggplot(data=highspring[which(highspring$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab(paste(paste(unit2),"Threshold")) +
  ylab("Duration of Events(h)")
  
p15

ggsave(paste("",dir,"highcapdurfreqspr.png",sep=""))
print("saved 38.image")

#s

###########Durations

perslowobs<-lengthEvents(filtersx(obss$effekt,lbreaks[1],-1))
perslow1obs<-lengthEvents(filtersx(obss$effekt,lbreaks[2],-1))
perslow2obs<-lengthEvents(filtersx(obss$effekt,lbreaks[3],-1))
perslowmod<-lengthEvents(filtersx(mods$effekt,lbreaks[1],-1))
perslow1mod<-lengthEvents(filtersx(mods$effekt,lbreaks[2],-1))
perslow2mod<-lengthEvents(filtersx(mods$effekt,lbreaks[3],-1))

if(length(perslowmod)>0){breaks = seq(1, max(perslowmod), by=1) 
if(length(breaks) > 1) {persduration.cut = cut(perslowmod, breaks, right=FALSE) 
persduration.freq = c(table(persduration.cut),0)
low1mods<-as_tibble(data.frame(breaks,persduration.freq))}else{low1mods<-data.frame(breaks,perslowmod)}}else {
  breaks<-0
  persduration.freq<-0
  low1mods<-as_tibble(data.frame(breaks,persduration.freq))}

# breaks = seq(1, max(perslowmod), by=1) 
# persduration.cut = cut(perslowmod, breaks, right=FALSE) 
# persduration.freq = c(table(persduration.cut),0)
# low1mods<-as_tibble(data.frame(breaks,persduration.freq))

breaks2 = seq(1, max(perslow1mod), by=1) 
persduration.cut2 = cut(perslow1mod, breaks2, right=FALSE) 
persduration.freq2 = c(table(persduration.cut2),0)
low2mods<-as_tibble(data.frame(breaks2,persduration.freq2))

breaks3 = seq(1, max(perslow2mod), by=1) 
persduration.cut3 = cut(perslow2mod, breaks3, right=FALSE) 
persduration.freq3 = c(table(persduration.cut3),0)
low3mods<-as_tibble(data.frame(breaks3,persduration.freq3))

if(length(perslowobs)>0){breaks4 = seq(1, max(perslowobs), by=1) 
if(length(breaks4) > 1) {persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
persduration.freq4 = c(table(persduration.cut4),0)
low1obss<-as_tibble(data.frame(breaks4,persduration.freq4))}else{low1obss<-data.frame(breaks4,perslowobs)}}else {
  breaks4<-0
  persduration.freq4<-0
  low1obss<-as_tibble(data.frame(breaks4,persduration.freq4))}

# breaks4 = seq(1, max(perslowobs), by=1) 
# persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
# persduration.freq4 = c(table(persduration.cut4),0)
# low1obss<-as_tibble(data.frame(breaks4,persduration.freq4))

breaks5 = seq(1, max(perslow1obs), by=1) 
persduration.cut5 = cut(perslow1obs, breaks5, right=FALSE) 
persduration.freq5 = c(table(persduration.cut5),0)
low2obss<-as_tibble(data.frame(breaks5,persduration.freq5))

breaks6 = seq(1, max(perslow2obs), by=1) 
persduration.cut6 = cut(perslow2obs, breaks6, right=FALSE) 
persduration.freq6 = c(table(persduration.cut6),0)
low3obss<-as_tibble(data.frame(breaks6,persduration.freq6))

l1ms<-data.frame(low1mods, rep(l1,length(low1mods$breaks)), rep("Model",length(low1mods$breaks)))
names(l1ms)<-c("breaks","Frequency","CF","type")
l2ms<-data.frame(low2mods, rep(l2,length(low2mods$breaks2)), rep("Model",length(low2mods$breaks2)))
names(l2ms)<-c("breaks","Frequency","CF","type")
l3ms<-data.frame(low3mods, rep(l3,length(low3mods$breaks3)), rep("Model",length(low3mods$breaks3)))
names(l3ms)<-c("breaks","Frequency","CF","type")
l1os<-data.frame(low1obss, rep(l1,length(low1obss$breaks4)), rep("Observations",length(low1obss$breaks4)))
names(l1os)<-c("breaks","Frequency","CF","type")
l2os<-data.frame(low2obss, rep(l2,length(low2obss$breaks5)), rep("Observations",length(low2obss$breaks5))) 
names(l2os)<-c("breaks","Frequency","CF","type")
l3os<-data.frame(low3obss, rep(l3,length(low3obss$breaks6)), rep("Observations",length(low3obss$breaks6)))
names(l3os)<-c("breaks","Frequency","CF","type")
lowsummer<-rbind(l1ms,l2ms,l3ms,l1os,l2os,l3os)

p16 <- ggplot(data=lowsummer[which(lowsummer$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab(paste(paste(unit2),"Threshold")) +
  ylab("Duration of Events(h)")
  
p16

ggsave(paste("",dir,"lowcapdurfreqsum.png",sep=""))
print("saved 39.image")

# hbreaks[1]<-(floor(max(obss$effekt)*10)/10)-0.3
# hbreaks[2]<-(floor(max(obss$effekt)*10)/10)-0.2
# hbreaks[3]<-(floor(max(obss$effekt)*10)/10)-0.1
# 
# h1<-paste(">",hbreaks[1] ,paste(unit),sep="")
# h2<-paste(">",hbreaks[2] ,paste(unit),sep="")
# h3<-paste(">",hbreaks[3] ,paste(unit),sep="")

pershighobs<-lengthEvents(filtersx(obss$effekt,hthres,hbreaks[1]))
pershigh1obs<-lengthEvents(filtersx(obss$effekt,hthres,hbreaks[2]))
pershigh2obs<-lengthEvents(filtersx(obss$effekt,hthres,hbreaks[3]))
pershighmod<-lengthEvents(filtersx(mods$effekt,hthres,hbreaks[1]))
pershigh1mod<-lengthEvents(filtersx(mods$effekt,hthres,hbreaks[2]))
pershigh2mod<-lengthEvents(filtersx(mods$effekt,hthres,hbreaks[3]))

breaks7 = seq(1, max(pershighmod), by=1) 
persduration.cut7 = cut(pershighmod, breaks7, right=FALSE) 
persduration.freq7 = c(table(persduration.cut7),0)
high1mods<-as_tibble(data.frame(breaks7,persduration.freq7))

if(length(pershigh1mod)>0){breaks8 = seq(1, max(pershigh1mod), by=1) 
if(length(breaks8) > 1) {persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
persduration.freq8 = c(table(persduration.cut8),0)
high2mods<-as_tibble(data.frame(breaks8,persduration.freq8))}else{high2mods<-data.frame(breaks8,pershigh1mod)}}else {
  breaks8<-0
  persduration.freq8<-0
  high2mods<-as_tibble(data.frame(breaks8,persduration.freq8))}

# breaks8 = seq(1, max(pershigh1mod), by=1) 
# persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
# persduration.freq8 = c(table(persduration.cut8),0)
# high2mods<-as_tibble(data.frame(breaks8,persduration.freq8))

if(length(pershigh2mod)>0){breaks9 = seq(1, max(pershigh2mod), by=1) 
persduration.cut9 = cut(pershigh2mod, breaks9, right=FALSE) 
persduration.freq9 = c(table(persduration.cut9),0)
high3mods<-as_tibble(data.frame(breaks9,persduration.freq9))}else {
  breaks9<-0
  persduration.freq9<-0
  high3mods<-as_tibble(data.frame(breaks9,persduration.freq9))}

breaks10 = seq(1, max(pershighobs), by=1) 
persduration.cut10 = cut(pershighobs, breaks10, right=FALSE) 
persduration.freq10 = c(table(persduration.cut10),0)
high1obss<-as_tibble(data.frame(breaks10,persduration.freq10))

if(length(pershigh1obs)>0){breaks11 = seq(1, max(pershigh1obs), by=1) 
if(length(breaks11) > 1) {persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
persduration.freq11 = c(table(persduration.cut11),0)
high2obss<-as_tibble(data.frame(breaks11,persduration.freq11))}else{high2obss<-data.frame(breaks11,pershigh1obs)}}else {
  breaks11<-0
  persduration.freq11<-0
  high2obss<-as_tibble(data.frame(breaks11,persduration.freq11))}

# breaks11 = seq(1, max(pershigh1obs), by=1) 
# persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
# persduration.freq11 = c(table(persduration.cut11),0)
# high2obss<-as_tibble(data.frame(breaks11,persduration.freq11))

if(length(pershigh2obs)>0){breaks12 = seq(1, max(pershigh2obs), by=1) 
if(length(breaks12) > 1) {persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
persduration.freq12 = c(table(persduration.cut12),0)
high3obss<-as_tibble(data.frame(breaks12,persduration.freq12))}else{high3obss<-data.frame(breaks12,pershigh2obs)}}else {
  breaks12<-0
  persduration.freq12<-0
  high3obss<-as_tibble(data.frame(breaks12,persduration.freq12))}

# breaks12 = seq(1, max(pershigh2obs), by=1) 
# if(pershigh2obs > 1) {persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
# persduration.freq12 = c(table(persduration.cut12),0)
# high3obss<-as_tibble(data.frame(breaks12,persduration.freq12))}else{high3obss<-data.frame(breaks12,pershigh2obs)}

h1ms<-data.frame(high1mods, rep(h1,length(high1mods$breaks7)), rep("Model",length(high1mods$breaks7)))
names(h1ms)<-c("breaks","Frequency","CF","type")
h2ms<-data.frame(high2mods, rep(h2,length(high2mods$breaks8)), rep("Model",length(high2mods$breaks8)))
names(h2ms)<-c("breaks","Frequency","CF","type")
h3ms<-data.frame(high3mods, rep(h3,length(high3mods$breaks9)), rep("Model",length(high3mods$breaks9)))
names(h3ms)<-c("breaks","Frequency","CF","type")
h1os<-data.frame(high1obss, rep(h1,length(high1obss$breaks10)), rep("Observations",length(high1obss$breaks10)))
names(h1os)<-c("breaks","Frequency","CF","type")
h2os<-data.frame(high2obss, rep(h2,length(high2obss$breaks11)), rep("Observations",length(high2obss$breaks11))) 
names(h2os)<-c("breaks","Frequency","CF","type")
h3os<-data.frame(high3obss, rep(h3,length(high3obss$breaks12)), rep("Observations",length(high3obss$breaks12)))
names(h3os)<-c("breaks","Frequency","CF","type")
highsummer<-rbind(h1ms,h2ms,h3ms,h1os,h2os,h3os)

p17 <- ggplot(data=highsummer[which(highsummer$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab(paste(paste(unit2),"Threshold")) +
  ylab("Duration of Events(h)")
  
p17

ggsave(paste("",dir,"highcapdurfreqsum.png",sep=""))
print("saved 40.image")

#a

###########Durations

perslowobs<-lengthEvents(filtersx(obsa$effekt,lbreaks[1],-1))
perslow1obs<-lengthEvents(filtersx(obsa$effekt,lbreaks[2],-1))
perslow2obs<-lengthEvents(filtersx(obsa$effekt,lbreaks[3],-1))
perslowmod<-lengthEvents(filtersx(moda$effekt,lbreaks[1],-1))
perslow1mod<-lengthEvents(filtersx(moda$effekt,lbreaks[2],-1))
perslow2mod<-lengthEvents(filtersx(moda$effekt,lbreaks[3],-1))

if(length(perslowmod)>0){breaks = seq(1, max(perslowmod), by=1) 
if(length(breaks) > 1) {persduration.cut = cut(perslowmod, breaks, right=FALSE) 
persduration.freq = c(table(persduration.cut),0)
low1moda<-as_tibble(data.frame(breaks,persduration.freq))}else{low1moda<-data.frame(breaks,perslowmod)}}else {
  breaks<-0
  persduration.freq<-0
  low1moda<-as_tibble(data.frame(breaks,persduration.freq))}

# breaks = seq(1, max(perslowmod), by=1) 
# persduration.cut = cut(perslowmod, breaks, right=FALSE) 
# persduration.freq = c(table(persduration.cut),0)
# low1moda<-as_tibble(data.frame(breaks,persduration.freq))

breaks2 = seq(1, max(perslow1mod), by=1) 
persduration.cut2 = cut(perslow1mod, breaks2, right=FALSE) 
persduration.freq2 = c(table(persduration.cut2),0)
low2moda<-as_tibble(data.frame(breaks2,persduration.freq2))
breaks3 = seq(1, max(perslow2mod), by=1) 
persduration.cut3 = cut(perslow2mod, breaks3, right=FALSE) 
persduration.freq3 = c(table(persduration.cut3),0)
low3moda<-as_tibble(data.frame(breaks3,persduration.freq3))

if(length(perslowobs)>0){breaks4 = seq(1, max(perslowobs), by=1) 
if(length(breaks4) > 1) {persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
persduration.freq4 = c(table(persduration.cut4),0)
low1obsa<-as_tibble(data.frame(breaks4,persduration.freq4))}else{low1obsa<-data.frame(breaks4,perslowobs)}}else {
  breaks4<-0
  persduration.freq4<-0
  low1obsa<-as_tibble(data.frame(breaks4,persduration.freq4))}

# breaks4 = seq(1, max(perslowobs), by=1) 
# persduration.cut4 = cut(perslowobs, breaks4, right=FALSE) 
# persduration.freq4 = c(table(persduration.cut4),0)
# low1obsa<-as_tibble(data.frame(breaks4,persduration.freq4))

breaks5 = seq(1, max(perslow1obs), by=1) 
persduration.cut5 = cut(perslow1obs, breaks5, right=FALSE) 
persduration.freq5 = c(table(persduration.cut5),0)
low2obsa<-as_tibble(data.frame(breaks5,persduration.freq5))

breaks6 = seq(1, max(perslow2obs), by=1) 
persduration.cut6 = cut(perslow2obs, breaks6, right=FALSE) 
persduration.freq6 = c(table(persduration.cut6),0)
low3obsa<-as_tibble(data.frame(breaks6,persduration.freq6))

l1ma<-data.frame(low1moda, rep(l1,length(low1moda$breaks)), rep("Model",length(low1moda$breaks)))
names(l1ma)<-c("breaks","Frequency","CF","type")
l2ma<-data.frame(low2moda, rep(l2,length(low2moda$breaks2)), rep("Model",length(low2moda$breaks2)))
names(l2ma)<-c("breaks","Frequency","CF","type")
l3ma<-data.frame(low3moda, rep(l3,length(low3moda$breaks3)), rep("Model",length(low3moda$breaks3)))
names(l3ma)<-c("breaks","Frequency","CF","type")
l1oa<-data.frame(low1obsa, rep(l1,length(low1obsa$breaks4)), rep("Observations",length(low1obsa$breaks4)))
names(l1oa)<-c("breaks","Frequency","CF","type")
l2oa<-data.frame(low2obsa, rep(l2,length(low2obsa$breaks5)), rep("Observations",length(low2obsa$breaks5))) 
names(l2oa)<-c("breaks","Frequency","CF","type")
l3oa<-data.frame(low3obsa, rep(l3,length(low3obsa$breaks6)), rep("Observations",length(low3obsa$breaks6)))
names(l3oa)<-c("breaks","Frequency","CF","type")
lowautumn<-rbind(l1ma,l2ma,l3ma,l1oa,l2oa,l3oa)

p18 <- ggplot(data=lowautumn[which(lowautumn$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab(paste(paste(unit2),"Threshold")) +
  ylab("Duration of Events(h)")
  
p18

ggsave(paste("",dir,"lowcapdurfreqaut.png",sep=""))
print("saved 41.image")

# hbreaks[1]<-(floor(max(obsa$effekt)*10)/10)-0.3
# hbreaks[2]<-(floor(max(obsa$effekt)*10)/10)-0.2
# hbreaks[3]<-(floor(max(obsa$effekt)*10)/10)-0.1
# 
# h1<-paste(">",hbreaks[1] ,"CF",sep="")
# h2<-paste(">",hbreaks[2] ,"CF",sep="")
# h3<-paste(">",hbreaks[3] ,"CF",sep="")

pershighobs<-lengthEvents(filtersx(obsa$effekt,hthres,hbreaks[1]))
pershigh1obs<-lengthEvents(filtersx(obsa$effekt,hthres,hbreaks[2]))
pershigh2obs<-lengthEvents(filtersx(obsa$effekt,hthres,hbreaks[3]))
pershighmod<-lengthEvents(filtersx(moda$effekt,hthres,hbreaks[1]))
pershigh1mod<-lengthEvents(filtersx(moda$effekt,hthres,hbreaks[2]))
pershigh2mod<-lengthEvents(filtersx(moda$effekt,hthres,hbreaks[3]))

breaks7 = seq(1, max(pershighmod), by=1) 
persduration.cut7 = cut(pershighmod, breaks7, right=FALSE) 
persduration.freq7 = c(table(persduration.cut7),0)
high1moda<-as_tibble(data.frame(breaks7,persduration.freq7))

if(length(pershigh1mod)>0){breaks8 = seq(1, max(pershigh1mod), by=1) 
if(length(breaks8) > 1) {persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
persduration.freq8 = c(table(persduration.cut8),0)
high2moda<-as_tibble(data.frame(breaks8,persduration.freq8))}else{high2moda<-data.frame(breaks8,pershigh1mod)}}else {
  breaks8<-0
  persduration.freq8<-0
  high2moda<-as_tibble(data.frame(breaks8,persduration.freq8))}

# breaks8 = seq(1, max(pershigh1mod), by=1) 
# persduration.cut8 = cut(pershigh1mod, breaks8, right=FALSE) 
# persduration.freq8 = c(table(persduration.cut8),0)
# high2moda<-as_tibble(data.frame(breaks8,persduration.freq8))

#lines(breaks2[1:length(breaks2)], persduration.freq2,col="green",lwd=1)
if(length(pershigh2mod)>0){breaks9 = seq(1, max(pershigh2mod), by=1) 
persduration.cut9 = cut(pershigh2mod, breaks9, right=FALSE) 
persduration.freq9 = c(table(persduration.cut9),0)
high3moda<-as_tibble(data.frame(breaks9,persduration.freq9))}else{breaks9<-0
persduration.freq9<-0
high3moda<-as_tibble(data.frame(breaks9,persduration.freq9))}

breaks10 = seq(1, max(pershighobs), by=1) 
persduration.cut10 = cut(pershighobs, breaks10, right=FALSE) 
persduration.freq10 = c(table(persduration.cut10),0)
high1obsa<-as_tibble(data.frame(breaks10,persduration.freq10))

if(length(pershigh1obs)>0){breaks11 = seq(1, max(pershigh1obs), by=1) 
if(length(breaks11) > 1) {persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
persduration.freq11 = c(table(persduration.cut11),0)
high2obsa<-as_tibble(data.frame(breaks11,persduration.freq11))}else{high2obsa<-data.frame(breaks11,pershigh1obs)}}else {
  breaks11<-0
  persduration.freq11<-0
  high2obsa<-as_tibble(data.frame(breaks11,persduration.freq11))}

# breaks11 = seq(1, max(pershigh1obs), by=1) 
# persduration.cut11 = cut(pershigh1obs, breaks11, right=FALSE) 
# persduration.freq11 = c(table(persduration.cut11),0)
# high2obsa<-as_tibble(data.frame(breaks11,persduration.freq11))

if(length(pershigh2obs)>0){breaks12 = seq(1, max(pershigh2obs), by=1) 
if(length(breaks12) > 1) {persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
persduration.freq12 = c(table(persduration.cut12),0)
high3obsa<-as_tibble(data.frame(breaks12,persduration.freq12))}else{high3obsa<-data.frame(breaks12,pershigh2obs)}}else {
  breaks12<-0
  persduration.freq12<-0
  high3obsa<-as_tibble(data.frame(breaks12,persduration.freq12))}

# if(length(pershigh2obs)>0){breaks12 = seq(1, max(pershigh2obs), by=1) 
# persduration.cut12 = cut(pershigh2obs, breaks12, right=FALSE) 
# persduration.freq12 = c(table(persduration.cut12),0)
# high3obsa<-as_tibble(data.frame(breaks12,persduration.freq12))}else{breaks12<-0
# persduration.freq12<-0
# high3obsa<-as_tibble(data.frame(breaks12,persduration.freq12))}

h1ma<-data.frame(high1moda, rep(h1,length(high1moda$breaks7)), rep("Model",length(high1moda$breaks7)))
names(h1ma)<-c("breaks","Frequency","CF","type")
h2ma<-data.frame(high2moda, rep(h2,length(high2moda$breaks8)), rep("Model",length(high2moda$breaks8)))
names(h2ma)<-c("breaks","Frequency","CF","type")
h3ma<-data.frame(high3moda, rep(h3,length(high3moda$breaks9)), rep("Model",length(high3moda$breaks9)))
names(h3ma)<-c("breaks","Frequency","CF","type")
h1oa<-data.frame(high1obsa, rep(h1,length(high1obsa$breaks10)), rep("Observations",length(high1obsa$breaks10)))
names(h1oa)<-c("breaks","Frequency","CF","type")
h2oa<-data.frame(high2obsa, rep(h2,length(high2obsa$breaks11)), rep("Observations",length(high2obsa$breaks11))) 
names(h2oa)<-c("breaks","Frequency","CF","type")
h3oa<-data.frame(high3obsa, rep(h3,length(high3obsa$breaks12)), rep("Observations",length(high3obsa$breaks12)))
names(h3oa)<-c("breaks","Frequency","CF","type")
highautumn<-rbind(h1ma,h2ma,h3ma,h1oa,h2oa,h3oa)

p19 <- ggplot(data=highautumn[which(highautumn$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab(paste(paste(unit2),"Threshold")) +
  ylab("Duration of Events(h)")
  
p19

ggsave(paste("",dir,"highcapdurfreqsum.png",sep=""))
print("saved 42.image")


#####################rate of change

#sp

# se<-unlist(lapply(1:length(modsp$effekt),function(i){res<-seq(i+1,i+12,1)}))
# tsx<-modsp$effekt[se]-rep(modsp$effekt,each=12)
# #tsx[-cumsum(stpsp*12)]
# tsx<-tsx[-unlist(lapply(1:length(cumsum(stpsp*12)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpsp*12),t=11))]
# 
# 
# breaksx = seq(-1, 1, by=0.01) 
# tsx.cut = cut(tsx, breaksx, right=FALSE) 
# tsx.freq = table(tsx.cut)
# tsx12h<-data.frame(breaksx[2:length(breaksx)], tsx.freq)
# names(tsx12h)<-c("CFchange","bins","Frequency")
# rc12hsp<-as_tibble(tsx12h)
# 
# seo<-unlist(lapply(1:length(obssp$effekt),function(i){res<-seq(i+1,i+12,1)}))
# tsxo<-obssp$effekt[seo]-rep(obssp$effekt,each=12)
# tsxo<-tsxo[-unlist(lapply(1:length(cumsum(stposp*12)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stposp*12),t=11))]
# 
# breaksxo = seq(-1, 1, by=0.01) 
# tsxo.cut = cut(tsxo, breaksxo, right=FALSE) 
# tsxo.freq = table(tsxo.cut)
# tsxo12h<-data.frame(breaksxo[2:length(breaksxo)], tsxo.freq)
# names(tsxo12h)<-c("CFchange","bins","Frequency")
# rco12hsp<-as_tibble(tsxo12h)
# 
# 
# se1<-unlist(lapply(1:length(modsp$effekt),function(i){res<-seq(i+1,i+1,1)}))
# tsx1<-modsp$effekt[se1]-rep(modsp$effekt,each=1)
# tsx1<-tsx1[-cumsum(stpsp)]
# 
# breaksx1 = seq(-1, 1, by=0.01) 
# tsx1.cut = cut(tsx1, breaksx1, right=FALSE) 
# tsx1.freq = table(tsx1.cut)
# tsx1h<-data.frame(breaksx1[2:length(breaksx1)], tsx1.freq)
# names(tsx1h)<-c("CFchange","bins","Frequency")
# rc1hsp<-as_tibble(tsx1h)
# 
# se1o<-unlist(lapply(1:length(obssp$effekt),function(i){res<-seq(i+1,i+1,1)}))
# tsx1o<-obssp$effekt[se1o]-rep(obssp$effekt,each=1)
# tsx1o<-tsx1o[-cumsum(stposp)]
# 
# breaksx1o = seq(-1, 1, by=0.01) 
# tsx1o.cut = cut(tsx1o, breaksx1o, right=FALSE) 
# tsx1o.freq = table(tsx1o.cut)
# tsxo1h<-data.frame(breaksx1o[2:length(breaksx1o)], tsx1o.freq)
# names(tsxo1h)<-c("CFchange","bins","Frequency")
# rco1hsp<-as_tibble(tsxo1h)
# 
# 
# se2<-unlist(lapply(1:length(modsp$effekt),function(i){res<-seq(i+1,i+3,1)}))
# tsx2<-modsp$effekt[se2]-rep(modsp$effekt,each=3)
# tsx2<-tsx2[-unlist(lapply(1:length(cumsum(stpsp*3)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpsp*3),t=2))]
# 
# 
# 
# breaksx2 = seq(-1, 1, by=0.01) 
# tsx2.cut = cut(tsx2, breaksx2, right=FALSE) 
# tsx2.freq = table(tsx2.cut)
# tsx3h<-data.frame(breaksx2[2:length(breaksx2)], tsx2.freq)
# names(tsx3h)<-c("CFchange","bins","Frequency")
# rc3hsp<-as_tibble(tsx3h)
# 
# se2o<-unlist(lapply(1:length(obssp$effekt),function(i){res<-seq(i+1,i+3,1)}))
# tsx2o<-obssp$effekt[se2o]-rep(obssp$effekt,each=3)
# tsx2o<-tsx2o[-unlist(lapply(1:length(cumsum(stposp*3)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stposp*3),t=2))]
# 
# breaksx2o = seq(-1, 1, by=0.01) 
# tsx2o.cut = cut(tsx2o, breaksx2o, right=FALSE) 
# tsx2o.freq = table(tsx2o.cut)
# tsxo3h<-data.frame(breaksx2o[2:length(breaksx2o)], tsx2o.freq)
# names(tsxo3h)<-c("CFchange","bins","Frequency")
# rco3hsp<-as_tibble(tsxo3h)
# 
# 
# se3<-unlist(lapply(1:length(modsp$effekt),function(i){res<-seq(i+1,i+6,1)}))
# tsx3<-modsp$effekt[se3]-rep(modsp$effekt,each=6)
# tsx3<-tsx3[-unlist(lapply(1:length(cumsum(stpsp*6)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpsp*6),t=5))]
# 
# breaksx3 = seq(-1, 1, by=0.01) 
# tsx3.cut = cut(tsx3, breaksx3, right=FALSE) 
# tsx3.freq = table(tsx3.cut)
# tsx6h<-data.frame(breaksx3[2:length(breaksx3)], tsx3.freq)
# names(tsx6h)<-c("CFchange","bins","Frequency")
# rc6hsp<-as_tibble(tsx6h)
# 
# se3o<-unlist(lapply(1:length(obssp$effekt),function(i){res<-seq(i+1,i+6,1)}))
# tsx3o<-obssp$effekt[se3o]-rep(obssp$effekt,each=6)
# tsx3o<-tsx3o[-unlist(lapply(1:length(cumsum(stposp*6)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stposp*6),t=5))]
# 
# breaksx3o = seq(-1, 1, by=0.01) 
# tsx3o.cut = cut(tsx3o, breaksx3o, right=FALSE) 
# tsx3o.freq = table(tsx3o.cut)
# tsxo6h<-data.frame(breaksx3o[2:length(breaksx3o)], tsx3o.freq)
# names(tsxo6h)<-c("CFchange","bins","Frequency")
# rco6hsp<-as_tibble(tsxo6h)
# 
# se4<-unlist(lapply(1:length(modsp$effekt),function(i){res<-seq(i+1,i+24,1)}))
# tsx4<-modsp$effekt[se4]-rep(modsp$effekt,each=24)
# tsx4<-tsx4[-unlist(lapply(1:length(cumsum(stpsp*24)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpsp*24),t=23))]
# breaksx4 = seq(-1, 1, by=0.01) 
# tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
# tsx4.freq = table(tsx4.cut)
# tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
# names(tsx24h)<-c("CFchange","bins","Frequency")
# rc24hsp<-as_tibble(tsx24h)
# 
# 
# se4o<-unlist(lapply(1:length(obssp$effekt),function(i){res<-seq(i+1,i+24,1)}))
# tsx4o<-obssp$effekt[se4o]-rep(obssp$effekt,each=24)
# tsx4o<-tsx4o[-unlist(lapply(1:length(cumsum(stposp*24)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stposp*24),t=23))]
# breaksx4o = seq(-1, 1, by=0.01) 
# tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
# tsx4o.freq = table(tsx4o.cut)
# tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
# names(tsxo24h)<-c("CFchange","bins","Frequency")
# rco24hsp<-as_tibble(tsxo24h)
# 
# 
# 
# p8 <- ggplot() +
#   geom_line(data=rc24hsp,aes(x=CFchange, y=Frequency, colour="Model",linetype="24h"),size=1)+
#   geom_line(data=rco24hsp,aes(x=CFchange, y=Frequency, colour="Observations",linetype="24h"),size=1)+
#   geom_line(data=rc12hsp,aes(x=CFchange, y=Frequency, colour="Model",linetype="12h"),size=1)+
#   geom_line(data=rco12hsp,aes(x=CFchange, y=Frequency, colour="Observations",linetype="12h"),size=1)+
#   geom_line(data=rc1hsp,aes(x=CFchange, y=Frequency, colour="Model",linetype="1h"),size=1)+
#   geom_line(data=rco1hsp,aes(x=CFchange, y=Frequency, colour="Observations",linetype="1h"),size=1)+
#   geom_line(data=rc3hsp,aes(x=CFchange, y=Frequency, colour="Model",linetype="3h"),size=1)+
#   geom_line(data=rco3hsp,aes(x=CFchange, y=Frequency, colour="Observations",linetype="3h"),size=1)+
#   geom_line(data=rc6hsp,aes(x=CFchange, y=Frequency, colour="Model",linetype="6h"),size=1)+
#   geom_line(data=rco6hsp,aes(x=CFchange, y=Frequency, colour="Observations",linetype="6h"),size=1)+
#   theme(legend.title=element_blank())+
#   ylab("Frequency") +
#   scale_x_continuous(name=paste(paste(unit),"Change"),breaks=c(-1,-0.75,-0.5,-0.25,-0.1,0.1,0.25,0.5,0.75,1))+
#   scale_color_manual(values=c("Observations"="green", "Model"="orange"))+
#   scale_linetype_manual(values=c("24h"="solid", "12h"="longdash","6h"="dotted","3h"="dotdash","1h"="twodash"))
# 
# p8  
# 
# ggsave(paste("",dir,"capchangefreqspr.png",sep=""))
# print("saved 43.image")
# 
# #w
# 
# se<-unlist(lapply(1:length(modw$effekt),function(i){res<-seq(i+1,i+12,1)}))
# tsx<-modw$effekt[se]-rep(modw$effekt,each=12)
# tsx<-tsx[-unlist(lapply(1:length(cumsum(stpw*12)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpw*12),t=11))]
# 
# 
# breaksx = seq(-1, 1, by=0.01) 
# tsx.cut = cut(tsx, breaksx, right=FALSE) 
# tsx.freq = table(tsx.cut)
# tsx12h<-data.frame(breaksx[2:length(breaksx)], tsx.freq)
# names(tsx12h)<-c("CFchange","bins","Frequency")
# rc12hw<-as_tibble(tsx12h)
# 
# seo<-unlist(lapply(1:length(obsw$effekt),function(i){res<-seq(i+1,i+12,1)}))
# tsxo<-obsw$effekt[seo]-rep(obsw$effekt,each=12)
# tsxo<-tsxo[-unlist(lapply(1:length(cumsum(stpow*12)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpow*12),t=11))]
# 
# breaksxo = seq(-1, 1, by=0.01) 
# tsxo.cut = cut(tsxo, breaksxo, right=FALSE) 
# tsxo.freq = table(tsxo.cut)
# tsxo12h<-data.frame(breaksxo[2:length(breaksxo)], tsxo.freq)
# names(tsxo12h)<-c("CFchange","bins","Frequency")
# rco12hw<-as_tibble(tsxo12h)
# 
# 
# se1<-unlist(lapply(1:length(modw$effekt),function(i){res<-seq(i+1,i+1,1)}))
# tsx1<-modw$effekt[se1]-rep(modw$effekt,each=1)
# tsx1<-tsx1[-cumsum(stpw)]
# 
# breaksx1 = seq(-1, 1, by=0.01) 
# tsx1.cut = cut(tsx1, breaksx1, right=FALSE) 
# tsx1.freq = table(tsx1.cut)
# tsx1h<-data.frame(breaksx1[2:length(breaksx1)], tsx1.freq)
# names(tsx1h)<-c("CFchange","bins","Frequency")
# rc1hw<-as_tibble(tsx1h)
# 
# se1o<-unlist(lapply(1:length(obsw$effekt),function(i){res<-seq(i+1,i+1,1)}))
# tsx1o<-obsw$effekt[se1o]-rep(obsw$effekt,each=1)
# tsx1o<-tsx1o[-cumsum(stpow)]
# 
# breaksx1o = seq(-1, 1, by=0.01) 
# tsx1o.cut = cut(tsx1o, breaksx1o, right=FALSE) 
# tsx1o.freq = table(tsx1o.cut)
# tsxo1h<-data.frame(breaksx1o[2:length(breaksx1o)], tsx1o.freq)
# names(tsxo1h)<-c("CFchange","bins","Frequency")
# rco1hw<-as_tibble(tsxo1h)
# 
# 
# se2<-unlist(lapply(1:length(modw$effekt),function(i){res<-seq(i+1,i+3,1)}))
# tsx2<-modw$effekt[se2]-rep(modw$effekt,each=3)
# tsx2<-tsx2[-unlist(lapply(1:length(cumsum(stpw*3)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpw*3),t=2))]
# 
# breaksx2 = seq(-1, 1, by=0.01) 
# tsx2.cut = cut(tsx2, breaksx2, right=FALSE) 
# tsx2.freq = table(tsx2.cut)
# tsx3h<-data.frame(breaksx2[2:length(breaksx2)], tsx2.freq)
# names(tsx3h)<-c("CFchange","bins","Frequency")
# rc3hw<-as_tibble(tsx3h)
# 
# se2o<-unlist(lapply(1:length(obsw$effekt),function(i){res<-seq(i+1,i+3,1)}))
# tsx2o<-obsw$effekt[se2o]-rep(obsw$effekt,each=3)
# tsx2o<-tsx2o[-unlist(lapply(1:length(cumsum(stpow*3)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpow*3),t=2))]
# 
# breaksx2o = seq(-1, 1, by=0.01) 
# tsx2o.cut = cut(tsx2o, breaksx2o, right=FALSE) 
# tsx2o.freq = table(tsx2o.cut)
# tsxo3h<-data.frame(breaksx2o[2:length(breaksx2o)], tsx2o.freq)
# names(tsxo3h)<-c("CFchange","bins","Frequency")
# rco3hw<-as_tibble(tsxo3h)
# 
# 
# se3<-unlist(lapply(1:length(modw$effekt),function(i){res<-seq(i+1,i+6,1)}))
# tsx3<-modw$effekt[se3]-rep(modw$effekt,each=6)
# tsx3<-tsx3[-unlist(lapply(1:length(cumsum(stpw*6)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpw*6),t=5))]
# 
# breaksx3 = seq(-1, 1, by=0.01) 
# tsx3.cut = cut(tsx3, breaksx3, right=FALSE) 
# tsx3.freq = table(tsx3.cut)
# tsx6h<-data.frame(breaksx3[2:length(breaksx3)], tsx3.freq)
# names(tsx6h)<-c("CFchange","bins","Frequency")
# rc6hw<-as_tibble(tsx6h)
# 
# se3o<-unlist(lapply(1:length(obsw$effekt),function(i){res<-seq(i+1,i+6,1)}))
# tsx3o<-obsw$effekt[se3o]-rep(obsw$effekt,each=6)
# tsx3o<-tsx3o[-unlist(lapply(1:length(cumsum(stpow*6)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpow*6),t=5))]
# 
# breaksx3o = seq(-1, 1, by=0.01) 
# tsx3o.cut = cut(tsx3o, breaksx3o, right=FALSE) 
# tsx3o.freq = table(tsx3o.cut)
# tsxo6h<-data.frame(breaksx3o[2:length(breaksx3o)], tsx3o.freq)
# names(tsxo6h)<-c("CFchange","bins","Frequency")
# rco6hw<-as_tibble(tsxo6h)
# 
# se4<-unlist(lapply(1:length(modw$effekt),function(i){res<-seq(i+1,i+24,1)}))
# tsx4<-modw$effekt[se4]-rep(modw$effekt,each=24)
# tsx4<-tsx4[-unlist(lapply(1:length(cumsum(stpw*24)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpw*24),t=23))]
# 
# breaksx4 = seq(-1, 1, by=0.01) 
# tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
# tsx4.freq = table(tsx4.cut)
# tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
# names(tsx24h)<-c("CFchange","bins","Frequency")
# rc24hw<-as_tibble(tsx24h)
# 
# 
# se4o<-unlist(lapply(1:length(obsw$effekt),function(i){res<-seq(i+1,i+24,1)}))
# tsx4o<-obsw$effekt[se4o]-rep(obsw$effekt,each=24)
# tsx4o<-tsx4o[-unlist(lapply(1:length(cumsum(stpow*24)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpow*24),t=23))]
# 
# breaksx4o = seq(-1, 1, by=0.01) 
# tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
# tsx4o.freq = table(tsx4o.cut)
# tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
# names(tsxo24h)<-c("CFchange","bins","Frequency")
# rco24hw<-as_tibble(tsxo24h)
# 
# p9 <- ggplot() +
#   geom_line(data=rc24hw,aes(x=CFchange, y=Frequency, colour="Model",linetype="24h"),size=1)+
#   geom_line(data=rco24hw,aes(x=CFchange, y=Frequency, colour="Observations",linetype="24h"),size=1)+
#   geom_line(data=rc12hw,aes(x=CFchange, y=Frequency, colour="Model",linetype="12h"),size=1)+
#   geom_line(data=rco12hw,aes(x=CFchange, y=Frequency, colour="Observations",linetype="12h"),size=1)+
#   geom_line(data=rc1hw,aes(x=CFchange, y=Frequency, colour="Model",linetype="1h"),size=1)+
#   geom_line(data=rco1hw,aes(x=CFchange, y=Frequency, colour="Observations",linetype="1h"),size=1)+
#   geom_line(data=rc3hw,aes(x=CFchange, y=Frequency, colour="Model",linetype="3h"),size=1)+
#   geom_line(data=rco3hw,aes(x=CFchange, y=Frequency, colour="Observations",linetype="3h"),size=1)+
#   geom_line(data=rc6hw,aes(x=CFchange, y=Frequency, colour="Model",linetype="6h"),size=1)+
#   geom_line(data=rco6hw,aes(x=CFchange, y=Frequency, colour="Observations",linetype="6h"),size=1)+
#   theme(legend.title=element_blank())+
#   ylab("Frequency") +
#   scale_x_continuous(name=paste(paste(unit),"Change"),breaks=c(-1,-0.75,-0.5,-0.25,-0.1,0.1,0.25,0.5,0.75,1))+
#   scale_color_manual(values=c("Observations"="green","Model"="orange"))+
#   scale_linetype_manual(values=c("24h"="solid", "12h"="longdash","6h"="dotted","3h"="dotdash","1h"="twodash"))
# 
# p9  
# 
# ggsave(paste("",dir,"capchangefreqwin.png",sep=""))
# print("saved 44.image")
# 
# #s
# 
# se<-unlist(lapply(1:length(mods$effekt),function(i){res<-seq(i+1,i+12,1)}))
# tsx<-mods$effekt[se]-rep(mods$effekt,each=12)
# tsx<-tsx[-unlist(lapply(1:length(cumsum(stps*12)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stps*12),t=11))]
# 
# 
# breaksx = seq(-1, 1, by=0.01) 
# tsx.cut = cut(tsx, breaksx, right=FALSE) 
# tsx.freq = table(tsx.cut)
# tsx12h<-data.frame(breaksx[2:length(breaksx)], tsx.freq)
# names(tsx12h)<-c("CFchange","bins","Frequency")
# rc12hs<-as_tibble(tsx12h)
# 
# seo<-unlist(lapply(1:length(obss$effekt),function(i){res<-seq(i+1,i+12,1)}))
# tsxo<-obss$effekt[seo]-rep(obss$effekt,each=12)
# tsxo<-tsxo[-unlist(lapply(1:length(cumsum(stpos*12)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpos*12),t=11))]
# 
# breaksxo = seq(-1, 1, by=0.01) 
# tsxo.cut = cut(tsxo, breaksxo, right=FALSE) 
# tsxo.freq = table(tsxo.cut)
# tsxo12h<-data.frame(breaksxo[2:length(breaksxo)], tsxo.freq)
# names(tsxo12h)<-c("CFchange","bins","Frequency")
# rco12hs<-as_tibble(tsxo12h)
# 
# 
# se1<-unlist(lapply(1:length(mods$effekt),function(i){res<-seq(i+1,i+1,1)}))
# tsx1<-mods$effekt[se1]-rep(mods$effekt,each=1)
# tsx1<-tsx1[-cumsum(stps)]
# 
# breaksx1 = seq(-1, 1, by=0.01) 
# tsx1.cut = cut(tsx1, breaksx1, right=FALSE) 
# tsx1.freq = table(tsx1.cut)
# tsx1h<-data.frame(breaksx1[2:length(breaksx1)], tsx1.freq)
# names(tsx1h)<-c("CFchange","bins","Frequency")
# rc1hs<-as_tibble(tsx1h)
# 
# se1o<-unlist(lapply(1:length(obss$effekt),function(i){res<-seq(i+1,i+1,1)}))
# tsx1o<-obss$effekt[se1o]-rep(obss$effekt,each=1)
# tsx1o<-tsx1o[-cumsum(stpos)]
# 
# breaksx1o = seq(-1, 1, by=0.01) 
# tsx1o.cut = cut(tsx1o, breaksx1o, right=FALSE) 
# tsx1o.freq = table(tsx1o.cut)
# tsxo1h<-data.frame(breaksx1o[2:length(breaksx1o)], tsx1o.freq)
# names(tsxo1h)<-c("CFchange","bins","Frequency")
# rco1hs<-as_tibble(tsxo1h)
# 
# 
# se2<-unlist(lapply(1:length(mods$effekt),function(i){res<-seq(i+1,i+3,1)}))
# tsx2<-mods$effekt[se2]-rep(mods$effekt,each=3)
# tsx2<-tsx2[-unlist(lapply(1:length(cumsum(stps*3)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stps*3),t=2))]
# 
# breaksx2 = seq(-1, 1, by=0.01) 
# tsx2.cut = cut(tsx2, breaksx2, right=FALSE) 
# tsx2.freq = table(tsx2.cut)
# tsx3h<-data.frame(breaksx2[2:length(breaksx2)], tsx2.freq)
# names(tsx3h)<-c("CFchange","bins","Frequency")
# rc3hs<-as_tibble(tsx3h)
# 
# se2o<-unlist(lapply(1:length(obss$effekt),function(i){res<-seq(i+1,i+3,1)}))
# tsx2o<-obss$effekt[se2o]-rep(obss$effekt,each=3)
# tsx2o<-tsx2o[-unlist(lapply(1:length(cumsum(stpos*3)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpos*3),t=2))]
# 
# breaksx2o = seq(-1, 1, by=0.01) 
# tsx2o.cut = cut(tsx2o, breaksx2o, right=FALSE) 
# tsx2o.freq = table(tsx2o.cut)
# tsxo3h<-data.frame(breaksx2o[2:length(breaksx2o)], tsx2o.freq)
# names(tsxo3h)<-c("CFchange","bins","Frequency")
# rco3hs<-as_tibble(tsxo3h)
# 
# 
# se3<-unlist(lapply(1:length(mods$effekt),function(i){res<-seq(i+1,i+6,1)}))
# tsx3<-mods$effekt[se3]-rep(mods$effekt,each=6)
# tsx3<-tsx3[-unlist(lapply(1:length(cumsum(stps*6)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stps*6),t=5))]
# 
# breaksx3 = seq(-1, 1, by=0.01) 
# tsx3.cut = cut(tsx3, breaksx3, right=FALSE) 
# tsx3.freq = table(tsx3.cut)
# tsx6h<-data.frame(breaksx3[2:length(breaksx3)], tsx3.freq)
# names(tsx6h)<-c("CFchange","bins","Frequency")
# rc6hs<-as_tibble(tsx6h)
# 
# se3o<-unlist(lapply(1:length(obss$effekt),function(i){res<-seq(i+1,i+6,1)}))
# tsx3o<-obss$effekt[se3o]-rep(obss$effekt,each=6)
# tsx3o<-tsx3o[-unlist(lapply(1:length(cumsum(stpos*6)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpos*6),t=5))]
# 
# breaksx3o = seq(-1, 1, by=0.01) 
# tsx3o.cut = cut(tsx3o, breaksx3o, right=FALSE) 
# tsx3o.freq = table(tsx3o.cut)
# tsxo6h<-data.frame(breaksx3o[2:length(breaksx3o)], tsx3o.freq)
# names(tsxo6h)<-c("CFchange","bins","Frequency")
# rco6hs<-as_tibble(tsxo6h)
# 
# se4<-unlist(lapply(1:length(mods$effekt),function(i){res<-seq(i+1,i+24,1)}))
# tsx4<-mods$effekt[se4]-rep(mods$effekt,each=24)
# tsx4<-tsx4[-unlist(lapply(1:length(cumsum(stps*24)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stps*24),t=23))]
# 
# breaksx4 = seq(-1, 1, by=0.01) 
# tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
# tsx4.freq = table(tsx4.cut)
# tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
# names(tsx24h)<-c("CFchange","bins","Frequency")
# rc24hs<-as_tibble(tsx24h)
# 
# 
# se4o<-unlist(lapply(1:length(obss$effekt),function(i){res<-seq(i+1,i+24,1)}))
# tsx4o<-obss$effekt[se4o]-rep(obss$effekt,each=24)
# tsx4o<-tsx4o[-unlist(lapply(1:length(cumsum(stpos*24)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpos*24),t=23))]
# 
# breaksx4o = seq(-1, 1, by=0.01) 
# tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
# tsx4o.freq = table(tsx4o.cut)
# tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
# names(tsxo24h)<-c("CFchange","bins","Frequency")
# rco24hs<-as_tibble(tsxo24h)
# 
# p10 <- ggplot() +
#   geom_line(data=rc24hs,aes(x=CFchange, y=Frequency, colour="Model",linetype="24h"),size=1)+
#   geom_line(data=rco24hs,aes(x=CFchange, y=Frequency, colour="Observations",linetype="24h"),size=1)+
#   geom_line(data=rc12hs,aes(x=CFchange, y=Frequency, colour="Model",linetype="12h"),size=1)+
#   geom_line(data=rco12hs,aes(x=CFchange, y=Frequency, colour="Observations",linetype="12h"),size=1)+
#   geom_line(data=rc1hs,aes(x=CFchange, y=Frequency, colour="Model",linetype="1h"),size=1)+
#   geom_line(data=rco1hs,aes(x=CFchange, y=Frequency, colour="Observations",linetype="1h"),size=1)+
#   geom_line(data=rc3hs,aes(x=CFchange, y=Frequency, colour="Model",linetype="3h"),size=1)+
#   geom_line(data=rco3hs,aes(x=CFchange, y=Frequency, colour="Observations",linetype="3h"),size=1)+
#   geom_line(data=rc6hs,aes(x=CFchange, y=Frequency, colour="Model",linetype="6h"),size=1)+
#   geom_line(data=rco6hs,aes(x=CFchange, y=Frequency, colour="Observations",linetype="6h"),size=1)+
#   theme(legend.title=element_blank())+
#   ylab("Frequency") +
#   scale_x_continuous(name=paste(paste(unit),"Change"),breaks=c(-1,-0.75,-0.5,-0.25,-0.1,0.1,0.25,0.5,0.75,1))+
#   scale_color_manual(values=c("Observations"="green","Model"="orange"))+
#   scale_linetype_manual(values=c("24h"="solid", "12h"="longdash","6h"="dotted","3h"="dotdash","1h"="twodash"))
# 
# p10  
# 
# ggsave(paste("",dir,"capchangefreqwinsum.png",sep=""))
# print("saved 45.image")
# 
# #a
# 
# se<-unlist(lapply(1:length(moda$effekt),function(i){res<-seq(i+1,i+12,1)}))
# tsx<-moda$effekt[se]-rep(moda$effekt,each=12)
# tsx<-tsx[-unlist(lapply(1:length(cumsum(stpa*12)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpa*12),t=11))]
# 
# 
# breaksx = seq(-1, 1, by=0.01) 
# tsx.cut = cut(tsx, breaksx, right=FALSE) 
# tsx.freq = table(tsx.cut)
# tsx12h<-data.frame(breaksx[2:length(breaksx)], tsx.freq)
# names(tsx12h)<-c("CFchange","bins","Frequency")
# rc12ha<-as_tibble(tsx12h)
# 
# seo<-unlist(lapply(1:length(obsa$effekt),function(i){res<-seq(i+1,i+12,1)}))
# tsxo<-obsa$effekt[seo]-rep(obsa$effekt,each=12)
# tsxo<-tsxo[-unlist(lapply(1:length(cumsum(stpoa*12)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpoa*12),t=11))]
# 
# breaksxo = seq(-1, 1, by=0.01) 
# tsxo.cut = cut(tsxo, breaksxo, right=FALSE) 
# tsxo.freq = table(tsxo.cut)
# tsxo12h<-data.frame(breaksxo[2:length(breaksxo)], tsxo.freq)
# names(tsxo12h)<-c("CFchange","bins","Frequency")
# rco12ha<-as_tibble(tsxo12h)
# 
# 
# se1<-unlist(lapply(1:length(moda$effekt),function(i){res<-seq(i+1,i+1,1)}))
# tsx1<-moda$effekt[se1]-rep(moda$effekt,each=1)
# tsx1<-tsx1[-cumsum(stpa)]
# 
# breaksx1 = seq(-1, 1, by=0.01) 
# tsx1.cut = cut(tsx1, breaksx1, right=FALSE) 
# tsx1.freq = table(tsx1.cut)
# tsx1h<-data.frame(breaksx1[2:length(breaksx1)], tsx1.freq)
# names(tsx1h)<-c("CFchange","bins","Frequency")
# rc1ha<-as_tibble(tsx1h)
# 
# se1o<-unlist(lapply(1:length(obsa$effekt),function(i){res<-seq(i+1,i+1,1)}))
# tsx1o<-obsa$effekt[se1o]-rep(obsa$effekt,each=1)
# tsx1o<-tsx1o[-cumsum(stpoa)]
# 
# breaksx1o = seq(-1, 1, by=0.01) 
# tsx1o.cut = cut(tsx1o, breaksx1o, right=FALSE) 
# tsx1o.freq = table(tsx1o.cut)
# tsxo1h<-data.frame(breaksx1o[2:length(breaksx1o)], tsx1o.freq)
# names(tsxo1h)<-c("CFchange","bins","Frequency")
# rco1ha<-as_tibble(tsxo1h)
# 
# 
# se2<-unlist(lapply(1:length(moda$effekt),function(i){res<-seq(i+1,i+3,1)}))
# tsx2<-moda$effekt[se2]-rep(moda$effekt,each=3)
# tsx2<-tsx2[-unlist(lapply(1:length(cumsum(stpa*3)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpa*3),t=2))]
# 
# breaksx2 = seq(-1, 1, by=0.01) 
# tsx2.cut = cut(tsx2, breaksx2, right=FALSE) 
# tsx2.freq = table(tsx2.cut)
# tsx3h<-data.frame(breaksx2[2:length(breaksx2)], tsx2.freq)
# names(tsx3h)<-c("CFchange","bins","Frequency")
# rc3ha<-as_tibble(tsx3h)
# 
# se2o<-unlist(lapply(1:length(obsa$effekt),function(i){res<-seq(i+1,i+3,1)}))
# tsx2o<-obsa$effekt[se2o]-rep(obsa$effekt,each=3)
# tsx2o<-tsx2o[-unlist(lapply(1:length(cumsum(stpoa*3)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpoa*3),t=2))]
# 
# breaksx2o = seq(-1, 1, by=0.01) 
# tsx2o.cut = cut(tsx2o, breaksx2o, right=FALSE) 
# tsx2o.freq = table(tsx2o.cut)
# tsxo3h<-data.frame(breaksx2o[2:length(breaksx2o)], tsx2o.freq)
# names(tsxo3h)<-c("CFchange","bins","Frequency")
# rco3ha<-as_tibble(tsxo3h)
# 
# 
# se3<-unlist(lapply(1:length(moda$effekt),function(i){res<-seq(i+1,i+6,1)}))
# tsx3<-moda$effekt[se3]-rep(moda$effekt,each=6)
# tsx3<-tsx3[-unlist(lapply(1:length(cumsum(stpa*6)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpa*6),t=5))]
# 
# breaksx3 = seq(-1, 1, by=0.01) 
# tsx3.cut = cut(tsx3, breaksx3, right=FALSE) 
# tsx3.freq = table(tsx3.cut)
# tsx6h<-data.frame(breaksx3[2:length(breaksx3)], tsx3.freq)
# names(tsx6h)<-c("CFchange","bins","Frequency")
# rc6ha<-as_tibble(tsx6h)
# 
# se3o<-unlist(lapply(1:length(obsa$effekt),function(i){res<-seq(i+1,i+6,1)}))
# tsx3o<-obsa$effekt[se3o]-rep(obsa$effekt,each=6)
# tsx3o<-tsx3o[-unlist(lapply(1:length(cumsum(stpoa*6)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpoa*6),t=5))]
# 
# breaksx3o = seq(-1, 1, by=0.01) 
# tsx3o.cut = cut(tsx3o, breaksx3o, right=FALSE) 
# tsx3o.freq = table(tsx3o.cut)
# tsxo6h<-data.frame(breaksx3o[2:length(breaksx3o)], tsx3o.freq)
# names(tsxo6h)<-c("CFchange","bins","Frequency")
# rco6ha<-as_tibble(tsxo6h)
# 
# se4<-unlist(lapply(1:length(moda$effekt),function(i){res<-seq(i+1,i+24,1)}))
# tsx4<-moda$effekt[se4]-rep(moda$effekt,each=24)
# tsx4<-tsx4[-unlist(lapply(1:length(cumsum(stpa*24)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpa*24),t=23))]
# 
# breaksx4 = seq(-1, 1, by=0.01) 
# tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
# tsx4.freq = table(tsx4.cut)
# tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
# names(tsx24h)<-c("CFchange","bins","Frequency")
# rc24ha<-as_tibble(tsx24h)
# 
# 
# se4o<-unlist(lapply(1:length(obsa$effekt),function(i){res<-seq(i+1,i+24,1)}))
# tsx4o<-obsa$effekt[se4o]-rep(obsa$effekt,each=24)
# tsx4o<-tsx4o[-unlist(lapply(1:length(cumsum(stpoa*24)),function(i,x,t){vl<-x[i]-seq(0,t,1)},x=cumsum(stpoa*24),t=23))]
# 
# breaksx4o = seq(-1, 1, by=0.01) 
# tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
# tsx4o.freq = table(tsx4o.cut)
# tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
# names(tsxo24h)<-c("CFchange","bins","Frequency")
# rco24ha<-as_tibble(tsxo24h)
# 
# p11 <- ggplot() +
#   geom_line(data=rc24ha,aes(x=CFchange, y=Frequency, colour="Model",linetype="24h"),size=1)+
#   geom_line(data=rco24ha,aes(x=CFchange, y=Frequency, colour="Observations",linetype="24h"),size=1)+
#   geom_line(data=rc12ha,aes(x=CFchange, y=Frequency, colour="Model",linetype="12h"),size=1)+
#   geom_line(data=rco12ha,aes(x=CFchange, y=Frequency, colour="Observations",linetype="12h"),size=1)+
#   geom_line(data=rc1ha,aes(x=CFchange, y=Frequency, colour="Model",linetype="1h"),size=1)+
#   geom_line(data=rco1ha,aes(x=CFchange, y=Frequency, colour="Observations",linetype="1h"),size=1)+
#   geom_line(data=rc3ha,aes(x=CFchange, y=Frequency, colour="Model",linetype="3h"),size=1)+
#   geom_line(data=rco3ha,aes(x=CFchange, y=Frequency, colour="Observations",linetype="3h"),size=1)+
#   geom_line(data=rc6ha,aes(x=CFchange, y=Frequency, colour="Model",linetype="6h"),size=1)+
#   geom_line(data=rco6ha,aes(x=CFchange, y=Frequency, colour="Observations",linetype="6h"),size=1)+
#   theme(legend.title=element_blank())+
#   ylab("Frequency") +
#   scale_x_continuous(name=paste(paste(unit),"Change"),breaks=c(-1,-0.75,-0.5,-0.25,-0.1,0.1,0.25,0.5,0.75,1))+
#   scale_color_manual(values=c("Observations"="green","Model"="orange"))+
#   scale_linetype_manual(values=c("24h"="solid", "12h"="longdash","6h"="dotted","3h"="dotdash","1h"="twodash"))
# 
# p11  
# 
# ggsave(paste("",dir,"capchangefreqaut.png",sep=""))
# print("saved 46.image")

}

############# roc comparison

if(type==1){

se<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+12,1)}))
tsx<-mod$effekt[se]-rep(mod$effekt,each=12)

breaksx = seq(-pseq[10], pseq[10], by=binwidths) 
tsx.cut = cut(tsx, breaksx, right=FALSE) 
tsx.freq = table(tsx.cut)
tsx12h<-data.frame(breaksx[2:length(breaksx)], tsx.freq)
names(tsx12h)<-c("CFchange","bins","Frequency")
rc12h<-as_tibble(tsx12h)

seo<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+12,1)}))
tsxo<-obs$effekt[seo]-rep(obs$effekt,each=12)
breaksxo = seq(-pseq[10], pseq[10], by=binwidths) 
tsxo.cut = cut(tsxo, breaksxo, right=FALSE) 
tsxo.freq = table(tsxo.cut)
tsxo12h<-data.frame(breaksxo[2:length(breaksxo)], tsxo.freq)
names(tsxo12h)<-c("CFchange","bins","Frequency")
rco12h<-as_tibble(tsxo12h)


se1<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+1,1)}))
tsx1<-mod$effekt[se1]-rep(mod$effekt,each=1)

breaksx1 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx1.cut = cut(tsx1, breaksx1, right=FALSE) 
tsx1.freq = table(tsx1.cut)
tsx1h<-data.frame(breaksx1[2:length(breaksx1)], tsx1.freq)
names(tsx1h)<-c("CFchange","bins","Frequency")
rc1h<-as_tibble(tsx1h)

se1o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+1,1)}))
tsx1o<-obs$effekt[se1o]-rep(obs$effekt,each=1)
breaksx1o = seq(-pseq[10], pseq[10], by=binwidths)
tsx1o.cut = cut(tsx1o, breaksx1o, right=FALSE) 
tsx1o.freq = table(tsx1o.cut)
tsxo1h<-data.frame(breaksx1o[2:length(breaksx1o)], tsx1o.freq)
names(tsxo1h)<-c("CFchange","bins","Frequency")
rco1h<-as_tibble(tsxo1h)


se2<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+3,1)}))
tsx2<-mod$effekt[se2]-rep(mod$effekt,each=3)

breaksx2 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx2.cut = cut(tsx2, breaksx2, right=FALSE) 
tsx2.freq = table(tsx2.cut)
tsx3h<-data.frame(breaksx2[2:length(breaksx2)], tsx2.freq)
names(tsx3h)<-c("CFchange","bins","Frequency")
rc3h<-as_tibble(tsx3h)

se2o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+3,1)}))
tsx2o<-obs$effekt[se2o]-rep(obs$effekt,each=3)
breaksx2o = seq(-pseq[10], pseq[10], by=binwidths)
tsx2o.cut = cut(tsx2o, breaksx2o, right=FALSE) 
tsx2o.freq = table(tsx2o.cut)
tsxo3h<-data.frame(breaksx2o[2:length(breaksx2o)], tsx2o.freq)
names(tsxo3h)<-c("CFchange","bins","Frequency")
rco3h<-as_tibble(tsxo3h)


se3<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+6,1)}))
tsx3<-mod$effekt[se3]-rep(mod$effekt,each=6)

breaksx3 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx3.cut = cut(tsx3, breaksx3, right=FALSE) 
tsx3.freq = table(tsx3.cut)
tsx6h<-data.frame(breaksx3[2:length(breaksx3)], tsx3.freq)
names(tsx6h)<-c("CFchange","bins","Frequency")
rc6h<-as_tibble(tsx6h)

se3o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+6,1)}))
tsx3o<-obs$effekt[se3o]-rep(obs$effekt,each=6)
breaksx3o = seq(-pseq[10], pseq[10], by=binwidths)
tsx3o.cut = cut(tsx3o, breaksx3o, right=FALSE) 
tsx3o.freq = table(tsx3o.cut)
tsxo6h<-data.frame(breaksx3o[2:length(breaksx3o)], tsx3o.freq)
names(tsxo6h)<-c("CFchange","bins","Frequency")
rco6h<-as_tibble(tsxo6h)

se4<-unlist(lapply(1:length(mod$effekt),function(i){res<-seq(i+1,i+24,1)}))
tsx4<-mod$effekt[se4]-rep(mod$effekt,each=24)
breaksx4 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
tsx4.freq = table(tsx4.cut)
tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
names(tsx24h)<-c("CFchange","bins","Frequency")
rc24h<-as_tibble(tsx24h)


se4o<-unlist(lapply(1:length(obs$effekt),function(i){res<-seq(i+1,i+24,1)}))
tsx4o<-obs$effekt[se4o]-rep(obs$effekt,each=24)
breaksx4o = seq(-pseq[10], pseq[10], by=binwidths)
tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
tsx4o.freq = table(tsx4o.cut)
tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
names(tsxo24h)<-c("CFchange","bins","Frequency")
rco24h<-as_tibble(tsxo24h)

roc24<-as_tibble(data.frame(tsx4,tsx4o))
#library(MASS)

### add legend
if(plotlyy==TRUE){p23<-plot_ly(x=roc24$tsx4,y=roc24$tsx4o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=15))
layout(p23,
       xaxis=list(title=paste("24h",paste(unit),"Change_Model"),breaks=c(-0.6,-0.4,-0.2,0,0.2,0.4,0.6)),
       yaxis=list(title=paste("24h",paste(unit),"Change_Observations"),breaks=c(-0.6,-0.4,-0.2,0,0.2,0.4,0.6))
       
)
p23

export(p23, file = paste("",dir,"\\p23.png",sep=""))
print("saved 47.image")

roc3<-as_tibble(data.frame(tsx2,tsx2o))

p24<-plot_ly(x=roc3$tsx2,y=roc3$tsx2o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=15))
  layout(p24,
       xaxis=list(title=paste("3h",paste(unit),"Change_Model"),range=c(-0.25,0.25)),
       yaxis=list(title=paste("3h",paste(unit),"Change_Observations"),range=c(-0.25,0.25))
    
)


p24

export(p24, file = paste("",dir,"\\p24.png",sep=""))
print("saved 48.image")

roc12<-as_tibble(data.frame(tsx,tsxo))

p25<-plot_ly(x=roc12$tsx,y=roc12$tsxo,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=15))
layout(p25,
       xaxis=list(title=paste("12h",paste(unit),"Change_Model"),range=c(-0.55,0.55)),
       yaxis=list(title=paste("12h",paste(unit),"Change_Observations"),range=c(-0.55,0.55))
)
p25

export(p25, file = paste("",dir,"\\p25.png",sep=""))
print("saved 49.image")

roc6<-as_tibble(data.frame(tsx3,tsx3o))

p26<-plot_ly(x=roc6$tsx3,y=roc6$tsx3o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=15))
layout(p26,
       xaxis=list(title=paste("6h",paste(unit),"Change_Model"),range=c(-0.5,0.5), size = 18),
       yaxis=list(title=paste("6h",paste(unit),"Change_Observations"),range=c(-0.5,0.5), size = 18)
)
p26

export(p26, file = paste("",dir,"\\p26.png",sep=""))
print("saved 50.image")

roc1<-as_tibble(data.frame(tsx1,tsx1o))

p27<-plot_ly(x=roc1$tsx1,y=roc1$tsx1o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=15))
layout(p27,
       xaxis=list(title=paste("1h",paste(unit),"Change_Model"),range=c(-0.1,0.1)),
       yaxis=list(title=paste("1h",paste(unit),"Change_Observations"),range=c(-0.1,0.1))
)
p27

export(p27, file = paste("",dir,"\\p27.png",sep=""))}
print("saved 51.image")
# ggplot(data=roc24,aes(x=tsx4, y=tsx4o))+
#   geom_density2d(aes(fill=..level..))+
#   coord_cartesian(xlim = c(-1.5, 1.5), ylim= c(-1.5, 1.5))+
#   scale_fill_gradient(low="green",high="red")+
#   geom_point()

# years

# obs2008<-obs[which(obs$date<"2009-01-02"),]
# #tmw22008<-tmw2[which(tmw2$date<"2009-01-02"),]
# mod2008<-mod[which(obs$date<"2009-01-02"),]
# 
# obs2010<-obs[which(obs$date>"2009-12-31" & obs$date<"2011-01-02"),]
# #tmw22010<-tmw2[which(tmw2$date>"2009-12-31" & tmw2$date<"2011-01-02"),]
# mod2010<-mod[which(obs$date>"2009-12-31" & obs$date<"2011-01-02"),]
# 
# obs2012<-obs[which(obs$date>"2011-12-31" & obs$date<"2013-01-02"),]
# #tmw22012<-tmw2[which(obs$date>"2011-12-31" & obs$date<"2013-01-02"),]
# mod2012<-mod[which(obs$date>"2011-12-31" & obs$date<"2013-01-02"),]


################## aggregated step changes 6h, 12h, 24h


mod3h<-colSums(matrix(mod$effekt, nrow=3))
obs3h<-colSums(matrix(obs$effekt, nrow=3))
cor(mod3h,obs3h)

se4<-unlist(lapply(1:length(mod3h),function(i){res<-seq(i+1,i+24,1)}))
tsx4<-mod3h[se4]-rep(mod3h,each=24)
breaksx4 = seq(0, pseq[10], by=binwidths) 
tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
tsx4.freq = table(tsx4.cut)
tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
names(tsx24h)<-c("CFchange","bins","Frequency")
rc24h<-as_tibble(tsx24h)


se4o<-unlist(lapply(1:length(obs3h),function(i){res<-seq(i+1,i+24,1)}))
tsx4o<-obs3h[se4o]-rep(obs3h,each=24)
breaksx4o = seq(0, pseq[10], by=binwidths)
tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
tsx4o.freq = table(tsx4o.cut)
tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
names(tsxo24h)<-c("CFchange","bins","Frequency")
rco24h<-as_tibble(tsxo24h)

se1<-unlist(lapply(1:length(mod3h),function(i){res<-seq(i+1,i+1,1)}))
tsx1<-mod3h[se1]-rep(mod3h,each=1)


se1o<-unlist(lapply(1:length(obs3h),function(i){res<-seq(i+1,i+1,1)}))
tsx1o<-obs3h[se1o]-rep(obs3h,each=1)


if(plotlyy==TRUE){p34<-plot_ly(x=tsx4,y=tsx4o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=20))
layout(p34,
       xaxis=list(title=paste("3h aggregated 24h",paste(unit),"Change_Model")),
       yaxis=list(title=paste("3h aggregated 24h",paste(unit),"Change_Observations"))
       
)
p34

export(p34, file = paste("",dir,"\\p34.png",sep=""))
print("saved 52.image")

p34<-plot_ly(x=tsx1,y=tsx1o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=20))
layout(p34,
       xaxis=list(title=paste(unit,"Model")),
       yaxis=list(title=paste(unit,"Observations"))
       
)
p34

export(p34, file = paste("",dir,"\\p34.png",sep=""))}
print("saved 53.image")

p34 <- ggplot() +
  geom_line(data=rc24h,aes(x=CFchange, y=Frequency, colour="Model", linetype="24h"),size=1)+
  geom_line(data=rco24h,aes(x=CFchange, y=Frequency, colour="Observations", linetype="24h"),size=1)+
  theme(legend.title=element_blank())+
  xlab(paste(unit2,"Change")) +
  ylab("Frequency") +
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  scale_linetype_manual(values=c("24h"="solid", "12h"="longdash","6h"="dotted","3h"="dotdash","1h"="twodash"))

p34  

ggsave(paste("",dir,"24hcapchangetot.png",sep=""))
print("saved 54.image")

mod6h<-colSums(matrix(mod$effekt, nrow=6))
obs6h<-colSums(matrix(obs$effekt, nrow=6))
cor(mod6h,obs6h)

mod12h<-colSums(matrix(mod$effekt, nrow=12))
obs12h<-colSums(matrix(obs$effekt, nrow=12))
cor(mod12h,obs12h)

mod24h<-colSums(matrix(mod$effekt, nrow=24))
obs24h<-colSums(matrix(obs$effekt, nrow=24))
cor(mod24h,obs24h)

se4<-unlist(lapply(1:length(mod24h),function(i){res<-seq(i+1,i+24,1)}))
tsx4<-mod24h[se4]-rep(mod24h,each=24)
breaksx4 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx4.cut = cut(tsx4, breaksx4, right=FALSE) 
tsx4.freq = table(tsx4.cut)
tsx24h<-data.frame(breaksx4[2:length(breaksx4)], tsx4.freq)
names(tsx24h)<-c("CFchange","bins","Frequency")
rc24h<-as_tibble(tsx24h)

se4o<-unlist(lapply(1:length(obs24h),function(i){res<-seq(i+1,i+24,1)}))
tsx4o<-obs24h[se4o]-rep(obs24h,each=24)
breaksx4o = seq(-pseq[10], pseq[10], by=binwidths)
tsx4o.cut = cut(tsx4o, breaksx4o, right=FALSE) 
tsx4o.freq = table(tsx4o.cut)
tsxo24h<-data.frame(breaksx4o[2:length(breaksx4o)], tsx4o.freq)
names(tsxo24h)<-c("CFchange","bins","Frequency")
rco24h<-as_tibble(tsxo24h)

se1<-unlist(lapply(1:length(mod24h),function(i){res<-seq(i+1,i+1,1)}))
tsx1<-mod24h[se1]-rep(mod24h,each=1)


se1o<-unlist(lapply(1:length(obs24h),function(i){res<-seq(i+1,i+1,1)}))
tsx1o<-obs24h[se1o]-rep(obs24h,each=1)


if(plotlyy==TRUE){p35<-plot_ly(x=tsx4,y=tsx4o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=20))
layout(p35,
       xaxis=list(title=paste(unit,"Model")),
       yaxis=list(title=paste(unit,"Observations"))
       
)
p35

export(p35, file = paste("",dir,"\\p35.png",sep=""))
print("saved 55.image")

p35<-plot_ly(x=tsx1,y=tsx1o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=20))
layout(p35,
       xaxis=list(title=paste(unit,"Model")),
       yaxis=list(title=paste(unit,"Observations"))
       
)
p35

export(p35, file = paste("",dir,"\\p35.png",sep=""))
print("saved 56.image")
}



p35 <- ggplot() +
  geom_line(data=rc24h,aes(x=CFchange, y=Frequency, colour="Model", linetype="24h"),size=1)+
  geom_line(data=rco24h,aes(x=CFchange, y=Frequency, colour="Observations", linetype="24h"),size=1)+
  theme(legend.title=element_blank())+
  xlab(paste(unit2,"Change")) +
  ylab("Frequency") +
  scale_color_manual(values=c("Observations"="green", "Model"="orange"))+
  scale_linetype_manual(values=c("24h"="solid", "12h"="longdash","6h"="dotted","3h"="dotdash","1h"="twodash"))

p35

ggsave(paste("",dir,"24hcapchangefreq.png",sep=""))
print("saved 57.image")

se3<<-unlist(lapply(1:length(mod12h),function(i){res<-seq(i+1,i+12,1)}))
tsx3<<-mod12h[se3]-rep(mod12h,each=12)
breaksx3 = seq(-pseq[10], pseq[10], by=binwidths) 
tsx3.cut = cut(tsx3, breaksx3, right=FALSE) 
tsx3.freq = table(tsx3.cut)
tsx12h<-data.frame(breaksx3[2:length(breaksx3)], tsx3.freq)
names(tsx12h)<-c("CFchange","bins","Frequency")
rc12h<<-as_tibble(tsx12h)

se3o<<-unlist(lapply(1:length(obs12h),function(i){res<-seq(i+1,i+12,1)}))
tsx3o<<-obs12h[se3o]-rep(obs12h,each=12)
breaksx3o = seq(-pseq[10], pseq[10], by=binwidths) 
tsx3o.cut = cut(tsx3o, breaksx3o, right=FALSE) 
tsx3o.freq = table(tsx3o.cut)
tsxo12h<<-data.frame(breaksx3o[2:length(breaksx3o)], tsx3o.freq)
names(tsxo12h)<-c("CFchange","bins","Frequency")
rco12h<<-as_tibble(tsxo12h)

if(plotlyy==TRUE){p64<-plot_ly(x=tsx3,y=tsx3o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=20))
layout(p64,
       xaxis=list(title=paste(unit,"Model")),
       yaxis=list(title=paste(unit,"Observations"))
       
)
p64

export(p64, file = paste("",dir,"\\p64.png",sep=""))
print("saved 58.image")}

se2<-unlist(lapply(1:length(mod6h),function(i){res<-seq(i+1,i+6,1)}))
tsx2<-mod6h[se2]-rep(mod6h,each=6)
breaksx2 = seq(-pseq[10], pseq[10], by=binwidths)
tsx2.cut = cut(tsx2, breaksx2, right=FALSE) 
tsx2.freq = table(tsx2.cut)
tsx6h<-data.frame(breaksx2[2:length(breaksx2)], tsx2.freq)
names(tsx6h)<-c("CFchange","bins","Frequency")
rc6h<-as_tibble(tsx6h)


se2o<-unlist(lapply(1:length(obs6h),function(i){res<-seq(i+1,i+6,1)}))
tsx2o<-obs6h[se2o]-rep(obs6h,each=6)
breaksx2o = seq(-pseq[10], pseq[10], by=binwidths) 
tsx2o.cut = cut(tsx2o, breaksx2o, right=FALSE) 
tsx2o.freq = table(tsx2o.cut)
tsxo6h<-data.frame(breaksx2o[2:length(breaksx2o)], tsx2o.freq)
names(tsxo6h)<-c("CFchange","bins","Frequency")
rco6h<-as_tibble(tsxo6h)

se1<-unlist(lapply(1:length(mod6h),function(i){res<-seq(i+1,i+1,1)}))
tsx1<-mod6h[se1]-rep(mod6h,each=1)

se1o<-unlist(lapply(1:length(obs6h),function(i){res<-seq(i+1,i+1,1)}))
tsx1o<-obs6h[se1o]-rep(obs6h,each=1)

if(plotlyy==TRUE){p65<-plot_ly(x=tsx2,y=tsx2o,type="histogram2dcontour",autocontour=FALSE,
            contours = list(coloring="fill",start=0,end=200,size=20))
layout(p65,
       xaxis=list(title=paste(unit,"Model")),
       yaxis=list(title=paste(unit,"Observations"))
       
)
p65

export(p65, file = paste("",dir,"\\p65.png",sep=""))
print("saved 59.image")}

# p65<-plot_ly(x=tsx1,y=tsx1o,type="histogram2dcontour",autocontour=FALSE,
#             contours = list(coloring="fill",start=0,end=200,size=20))
# layout(p65,
#        xaxis=list(title="CF Model"),
#        yaxis=list(title="CF Observations")
#        
# )
# p65
# 
# ggsave(paste("",dir,"p65.png",sep=""))

################## hourly analysis




obsh24<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==00),])
obsh1<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==01),])
obsh2<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==02),])
obsh3<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==03),])
obsh4<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==04),])
obsh5<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==05),])
obsh6<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==06),])
obsh7<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==07),])
obsh8<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==08),])
obsh9<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==09),])
obsh10<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==10),])
obsh11<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==11),])
obsh12<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==12),])
obsh13<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==13),])
obsh14<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==14),])
obsh15<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==15),])
obsh16<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==16),])
obsh17<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==17),])
obsh18<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==18),])
obsh19<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==19),])
obsh20<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==20),])
obsh21<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==21),])
obsh22<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==22),])
obsh23<-as_tibble(obs[which(as.numeric(format(obs$date,"%H"))==23),])

modho<-data.frame(obs$date,mod$effekt)
names(modho)<-c("date", "effekt")
modho<-as_tibble(modho)

modho24<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==00),])
modho1<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==01),])
modho2<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==02),])
modho3<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==03),])
modho4<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==04),])
modho5<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==05),])
modho6<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==06),])
modho7<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==07),])
modho8<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==08),])
modho9<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==09),])
modho10<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==10),])
modho11<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==11),])
modho12<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==12),])
modho13<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==13),])
modho14<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==14),])
modho15<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==15),])
modho16<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==16),])
modho17<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==17),])
modho18<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==18),])
modho19<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==19),])
modho20<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==20),])
modho21<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==21),])
modho22<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==22),])
modho23<-as_tibble(modho[which(as.numeric(format(modho$date,"%H"))==23),])

#error
herr24<-data.frame(modho24$effekt-obsh24$effekt,rep("24",length(modho24$effekt)))
names(herr24)<-c("deviation","hour")
herr1<-data.frame(modho1$effekt-obsh1$effekt,rep("01",length(modho1$effekt)))
names(herr1)<-c("deviation","hour")
herr2<-data.frame(modho2$effekt-obsh2$effekt,rep("02",length(modho2$effekt)))
names(herr2)<-c("deviation","hour")
herr3<-data.frame(modho3$effekt-obsh3$effekt,rep("03",length(modho3$effekt)))
names(herr3)<-c("deviation","hour")
herr4<-data.frame(modho4$effekt-obsh4$effekt,rep("04",length(modho4$effekt)))
names(herr4)<-c("deviation","hour")
herr5<-data.frame(modho5$effekt-obsh5$effekt,rep("05",length(modho5$effekt)))
names(herr5)<-c("deviation","hour")
herr6<-data.frame(modho6$effekt-obsh6$effekt,rep("06",length(modho6$effekt)))
names(herr6)<-c("deviation","hour")
herr7<-data.frame(modho7$effekt-obsh7$effekt,rep("07",length(modho7$effekt)))
names(herr7)<-c("deviation","hour")
herr8<-data.frame(modho8$effekt-obsh8$effekt,rep("08",length(modho8$effekt)))
names(herr8)<-c("deviation","hour")
herr9<-data.frame(modho9$effekt-obsh9$effekt,rep("09",length(modho9$effekt)))
names(herr9)<-c("deviation","hour")
herr10<-data.frame(modho10$effekt-obsh10$effekt,rep("10",length(modho10$effekt)))
names(herr10)<-c("deviation","hour")
herr11<-data.frame(modho11$effekt-obsh11$effekt,rep("11",length(modho11$effekt)))
names(herr11)<-c("deviation","hour")
herr12<-data.frame(modho12$effekt-obsh12$effekt,rep("12",length(modho12$effekt)))
names(herr12)<-c("deviation","hour")
herr13<-data.frame(modho13$effekt-obsh13$effekt,rep("13",length(modho13$effekt)))
names(herr13)<-c("deviation","hour")
herr14<-data.frame(modho14$effekt-obsh14$effekt,rep("14",length(modho14$effekt)))
names(herr14)<-c("deviation","hour")
herr15<-data.frame(modho15$effekt-obsh15$effekt,rep("15",length(modho15$effekt)))
names(herr15)<-c("deviation","hour")
herr16<-data.frame(modho16$effekt-obsh16$effekt,rep("16",length(modho16$effekt)))
names(herr16)<-c("deviation","hour")
herr17<-data.frame(modho17$effekt-obsh17$effekt,rep("17",length(modho17$effekt)))
names(herr17)<-c("deviation","hour")
herr18<-data.frame(modho18$effekt-obsh18$effekt,rep("18",length(modho18$effekt)))
names(herr18)<-c("deviation","hour")
herr19<-data.frame(modho19$effekt-obsh19$effekt,rep("19",length(modho19$effekt)))
names(herr19)<-c("deviation","hour")
herr20<-data.frame(modho20$effekt-obsh20$effekt,rep("20",length(modho20$effekt)))
names(herr20)<-c("deviation","hour")
herr21<-data.frame(modho21$effekt-obsh21$effekt,rep("21",length(modho21$effekt)))
names(herr21)<-c("deviation","hour")
herr22<-data.frame(modho22$effekt-obsh22$effekt,rep("22",length(modho22$effekt)))
names(herr22)<-c("deviation","hour")
herr23<-data.frame(modho23$effekt-obsh23$effekt,rep("23",length(modho23$effekt)))
names(herr23)<-c("deviation","hour")

errdt<<-as_tibble(rbind(herr1, herr2, herr3,herr4, herr5, herr6,herr7, herr8, herr9,herr10, herr11, herr12,herr13, herr14, herr15,herr16, herr17, herr18,herr19, herr20, herr21,herr22, herr23, herr24))

p66 <- ggplot(errdt, aes(hour,deviation))+
geom_boxplot(fill="brown")

p66

ggsave(paste("",dir,"hcapdevtot.png",sep=""))
print("saved 60.image")

}


# duration and Frequency of extreme events

if(type==1||type==4){

l24ob<-data.frame(table(lengthEvents(filtersx(obsh24$effekt,lbreaks[2],-1))),rep("24",length(table(lengthEvents(filtersx(obsh24$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh24$effekt,lbreaks[2],-1))))))
names(l24ob)<-c("Frequency","duration","hour","type")
l1ob<-data.frame(table(lengthEvents(filtersx(obsh1$effekt,lbreaks[2],-1))),rep("01",length(table(lengthEvents(filtersx(obsh1$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh1$effekt,lbreaks[2],-1))))))
names(l1ob)<-c("Frequency","duration","hour","type")
l2ob<-data.frame(table(lengthEvents(filtersx(obsh2$effekt,lbreaks[2],-1))),rep("02",length(table(lengthEvents(filtersx(obsh2$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh2$effekt,lbreaks[2],-1))))))
names(l2ob)<-c("Frequency","duration","hour","type")
l3ob<-data.frame(table(lengthEvents(filtersx(obsh3$effekt,lbreaks[2],-1))),rep("03",length(table(lengthEvents(filtersx(obsh3$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh3$effekt,lbreaks[2],-1))))))
names(l3ob)<-c("Frequency","duration","hour","type")
l4ob<-data.frame(table(lengthEvents(filtersx(obsh4$effekt,lbreaks[2],-1))),rep("04",length(table(lengthEvents(filtersx(obsh4$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh4$effekt,lbreaks[2],-1))))))
names(l4ob)<-c("Frequency","duration","hour","type")
l5ob<-data.frame(table(lengthEvents(filtersx(obsh5$effekt,lbreaks[2],-1))),rep("05",length(table(lengthEvents(filtersx(obsh5$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh5$effekt,lbreaks[2],-1))))))
names(l5ob)<-c("Frequency","duration","hour","type")
l6ob<-data.frame(table(lengthEvents(filtersx(obsh6$effekt,lbreaks[2],-1))),rep("06",length(table(lengthEvents(filtersx(obsh6$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh6$effekt,lbreaks[2],-1))))))
names(l6ob)<-c("Frequency","duration","hour","type")
l7ob<-data.frame(table(lengthEvents(filtersx(obsh7$effekt,lbreaks[2],-1))),rep("07",length(table(lengthEvents(filtersx(obsh7$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh7$effekt,lbreaks[2],-1))))))
names(l7ob)<-c("Frequency","duration","hour","type")
l8ob<-data.frame(table(lengthEvents(filtersx(obsh8$effekt,lbreaks[2],-1))),rep("08",length(table(lengthEvents(filtersx(obsh8$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh8$effekt,lbreaks[2],-1))))))
names(l8ob)<-c("Frequency","duration","hour","type")
l9ob<-data.frame(table(lengthEvents(filtersx(obsh9$effekt,lbreaks[2],-1))),rep("09",length(table(lengthEvents(filtersx(obsh9$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh9$effekt,lbreaks[2],-1))))))
names(l9ob)<-c("Frequency","duration","hour","type")
l10ob<-data.frame(table(lengthEvents(filtersx(obsh10$effekt,lbreaks[2],-1))),rep("10",length(table(lengthEvents(filtersx(obsh10$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh10$effekt,lbreaks[2],-1))))))
names(l10ob)<-c("Frequency","duration","hour","type")
l11ob<-data.frame(table(lengthEvents(filtersx(obsh11$effekt,lbreaks[2],-1))),rep("11",length(table(lengthEvents(filtersx(obsh11$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh11$effekt,lbreaks[2],-1))))))
names(l11ob)<-c("Frequency","duration","hour","type")
l12ob<-data.frame(table(lengthEvents(filtersx(obsh12$effekt,lbreaks[2],-1))),rep("12",length(table(lengthEvents(filtersx(obsh12$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh12$effekt,lbreaks[2],-1))))))
names(l12ob)<-c("Frequency","duration","hour","type")
l13ob<-data.frame(table(lengthEvents(filtersx(obsh13$effekt,lbreaks[2],-1))),rep("13",length(table(lengthEvents(filtersx(obsh13$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh13$effekt,lbreaks[2],-1))))))
names(l13ob)<-c("Frequency","duration","hour","type")
l14ob<-data.frame(table(lengthEvents(filtersx(obsh14$effekt,lbreaks[2],-1))),rep("14",length(table(lengthEvents(filtersx(obsh14$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh14$effekt,lbreaks[2],-1))))))
names(l14ob)<-c("Frequency","duration","hour","type")
l15ob<-data.frame(table(lengthEvents(filtersx(obsh15$effekt,lbreaks[2],-1))),rep("15",length(table(lengthEvents(filtersx(obsh15$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh15$effekt,lbreaks[2],-1))))))
names(l15ob)<-c("Frequency","duration","hour","type")
l16ob<-data.frame(table(lengthEvents(filtersx(obsh16$effekt,lbreaks[2],-1))),rep("16",length(table(lengthEvents(filtersx(obsh16$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh16$effekt,lbreaks[2],-1))))))
names(l16ob)<-c("Frequency","duration","hour","type")
l17ob<-data.frame(table(lengthEvents(filtersx(obsh17$effekt,lbreaks[2],-1))),rep("17",length(table(lengthEvents(filtersx(obsh17$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh17$effekt,lbreaks[2],-1))))))
names(l17ob)<-c("Frequency","duration","hour","type")
l18ob<-data.frame(table(lengthEvents(filtersx(obsh18$effekt,lbreaks[2],-1))),rep("18",length(table(lengthEvents(filtersx(obsh18$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh18$effekt,lbreaks[2],-1))))))
names(l18ob)<-c("Frequency","duration","hour","type")
l19ob<-data.frame(table(lengthEvents(filtersx(obsh19$effekt,lbreaks[2],-1))),rep("19",length(table(lengthEvents(filtersx(obsh19$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh19$effekt,lbreaks[2],-1))))))
names(l19ob)<-c("Frequency","duration","hour","type")
l20ob<-data.frame(table(lengthEvents(filtersx(obsh20$effekt,lbreaks[2],-1))),rep("20",length(table(lengthEvents(filtersx(obsh20$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh20$effekt,lbreaks[2],-1))))))
names(l20ob)<-c("Frequency","duration","hour","type")
l21ob<-data.frame(table(lengthEvents(filtersx(obsh21$effekt,lbreaks[2],-1))),rep("21",length(table(lengthEvents(filtersx(obsh21$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh21$effekt,lbreaks[2],-1))))))
names(l21ob)<-c("Frequency","duration","hour","type")
l22ob<-data.frame(table(lengthEvents(filtersx(obsh22$effekt,lbreaks[2],-1))),rep("22",length(table(lengthEvents(filtersx(obsh22$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh22$effekt,lbreaks[2],-1))))))
names(l22ob)<-c("Frequency","duration","hour","type")
l23ob<-data.frame(table(lengthEvents(filtersx(obsh23$effekt,lbreaks[2],-1))),rep("23",length(table(lengthEvents(filtersx(obsh23$effekt,lbreaks[2],-1))))),rep("Observations",length(table(lengthEvents(filtersx(obsh23$effekt,lbreaks[2],-1))))))
names(l23ob)<-c("Frequency","duration","hour","type")

l24<-data.frame(table(lengthEvents(filtersx(modho24$effekt,lbreaks[2],-1))),rep("24",length(table(lengthEvents(filtersx(modho24$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho24$effekt,lbreaks[2],-1))))))
names(l24)<-c("Frequency","duration","hour","type")
l1<-data.frame(table(lengthEvents(filtersx(modho1$effekt,lbreaks[2],-1))),rep("01",length(table(lengthEvents(filtersx(modho1$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho1$effekt,lbreaks[2],-1))))))
names(l1)<-c("Frequency","duration","hour","type")
l2<-data.frame(table(lengthEvents(filtersx(modho2$effekt,lbreaks[2],-1))),rep("02",length(table(lengthEvents(filtersx(modho2$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho2$effekt,lbreaks[2],-1))))))
names(l2)<-c("Frequency","duration","hour","type")
l3<-data.frame(table(lengthEvents(filtersx(modho3$effekt,lbreaks[2],-1))),rep("03",length(table(lengthEvents(filtersx(modho3$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho3$effekt,lbreaks[2],-1))))))
names(l3)<-c("Frequency","duration","hour","type")
l4<-data.frame(table(lengthEvents(filtersx(modho4$effekt,lbreaks[2],-1))),rep("04",length(table(lengthEvents(filtersx(modho4$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho4$effekt,lbreaks[2],-1))))))
names(l4)<-c("Frequency","duration","hour","type")
l5<-data.frame(table(lengthEvents(filtersx(modho5$effekt,lbreaks[2],-1))),rep("05",length(table(lengthEvents(filtersx(modho5$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho5$effekt,lbreaks[2],-1))))))
names(l5)<-c("Frequency","duration","hour","type")
l6<-data.frame(table(lengthEvents(filtersx(modho6$effekt,lbreaks[2],-1))),rep("06",length(table(lengthEvents(filtersx(modho6$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho6$effekt,lbreaks[2],-1))))))
names(l6)<-c("Frequency","duration","hour","type")
l7<-data.frame(table(lengthEvents(filtersx(modho7$effekt,lbreaks[2],-1))),rep("07",length(table(lengthEvents(filtersx(modho7$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho7$effekt,lbreaks[2],-1))))))
names(l7)<-c("Frequency","duration","hour","type")
l8<-data.frame(table(lengthEvents(filtersx(modho8$effekt,lbreaks[2],-1))),rep("08",length(table(lengthEvents(filtersx(modho8$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho8$effekt,lbreaks[2],-1))))))
names(l8)<-c("Frequency","duration","hour","type")
l9<-data.frame(table(lengthEvents(filtersx(modho9$effekt,lbreaks[2],-1))),rep("09",length(table(lengthEvents(filtersx(modho9$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho9$effekt,lbreaks[2],-1))))))
names(l9)<-c("Frequency","duration","hour","type")
l10<-data.frame(table(lengthEvents(filtersx(modho10$effekt,lbreaks[2],-1))),rep("10",length(table(lengthEvents(filtersx(modho10$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho10$effekt,lbreaks[2],-1))))))
names(l10)<-c("Frequency","duration","hour","type")
l11<-data.frame(table(lengthEvents(filtersx(modho11$effekt,lbreaks[2],-1))),rep("11",length(table(lengthEvents(filtersx(modho11$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho11$effekt,lbreaks[2],-1))))))
names(l11)<-c("Frequency","duration","hour","type")
l12<-data.frame(table(lengthEvents(filtersx(modho12$effekt,lbreaks[2],-1))),rep("12",length(table(lengthEvents(filtersx(modho12$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho12$effekt,lbreaks[2],-1))))))
names(l12)<-c("Frequency","duration","hour","type")
l13<-data.frame(table(lengthEvents(filtersx(modho13$effekt,lbreaks[2],-1))),rep("13",length(table(lengthEvents(filtersx(modho13$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho13$effekt,lbreaks[2],-1))))))
names(l13)<-c("Frequency","duration","hour","type")
l14<-data.frame(table(lengthEvents(filtersx(modho14$effekt,lbreaks[2],-1))),rep("14",length(table(lengthEvents(filtersx(modho14$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho14$effekt,lbreaks[2],-1))))))
names(l14)<-c("Frequency","duration","hour","type")
l15<-data.frame(table(lengthEvents(filtersx(modho15$effekt,lbreaks[2],-1))),rep("15",length(table(lengthEvents(filtersx(modho15$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho15$effekt,lbreaks[2],-1))))))
names(l15)<-c("Frequency","duration","hour","type")
l16<-data.frame(table(lengthEvents(filtersx(modho16$effekt,lbreaks[2],-1))),rep("16",length(table(lengthEvents(filtersx(modho16$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho16$effekt,lbreaks[2],-1))))))
names(l16)<-c("Frequency","duration","hour","type")
l17<-data.frame(table(lengthEvents(filtersx(modho17$effekt,lbreaks[2],-1))),rep("17",length(table(lengthEvents(filtersx(modho17$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho17$effekt,lbreaks[2],-1))))))
names(l17)<-c("Frequency","duration","hour","type")
l18<-data.frame(table(lengthEvents(filtersx(modho18$effekt,lbreaks[2],-1))),rep("18",length(table(lengthEvents(filtersx(modho18$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho18$effekt,lbreaks[2],-1))))))
names(l18)<-c("Frequency","duration","hour","type")
l19<-data.frame(table(lengthEvents(filtersx(modho19$effekt,lbreaks[2],-1))),rep("19",length(table(lengthEvents(filtersx(modho19$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho19$effekt,lbreaks[2],-1))))))
names(l19)<-c("Frequency","duration","hour","type")
l20<-data.frame(table(lengthEvents(filtersx(modho20$effekt,lbreaks[2],-1))),rep("20",length(table(lengthEvents(filtersx(modho20$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho20$effekt,lbreaks[2],-1))))))
names(l20)<-c("Frequency","duration","hour","type")
l21<-data.frame(table(lengthEvents(filtersx(modho21$effekt,lbreaks[2],-1))),rep("21",length(table(lengthEvents(filtersx(modho21$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho21$effekt,lbreaks[2],-1))))))
names(l21)<-c("Frequency","duration","hour","type")
l22<-data.frame(table(lengthEvents(filtersx(modho22$effekt,lbreaks[2],-1))),rep("22",length(table(lengthEvents(filtersx(modho22$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho22$effekt,lbreaks[2],-1))))))
names(l22)<-c("Frequency","duration","hour","type")
l23<-data.frame(table(lengthEvents(filtersx(modho23$effekt,lbreaks[2],-1))),rep("23",length(table(lengthEvents(filtersx(modho23$effekt,lbreaks[2],-1))))),rep("Model",length(table(lengthEvents(filtersx(modho23$effekt,lbreaks[2],-1))))))
names(l23)<-c("Frequency","duration","hour","type")

ld<-as_tibble(rbind(l1, l2, l3,l4, l5, l6,l7, l8, l9,l10, l11, l12,l13, l14, l15,l16, l17, l18,l19, l20, l21,l22, l23, l24))
ldob<-as_tibble(rbind(l1ob, l2ob, l3ob,l4ob, l5ob, l6ob,l7ob, l8ob, l9ob,l10ob, l11ob, l12ob,l13ob, l14ob, l15ob,l16ob, l17ob, l18ob,l19ob, l20ob, l21ob,l22ob, l23ob, l24ob))
ldcom<-data.frame(rbind(ld,ldob))

p67 <- ggplot(data=ldcom, aes(x = hour, y = duration, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 13)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab("Hour") +
  ylab("Duration of Events(h)")
  
p67+
  theme_grey(base_size = 13)

ggsave(paste("",dir,"hlowfreqdurtot.png",sep=""))
print("saved 61.image")


h24ob<-data.frame(table(lengthEvents(filtersx(obsh24$effekt,hthres,hbreaks[1]))),rep("24",length(table(lengthEvents(filtersx(obsh24$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh24$effekt,hthres,hbreaks[1]))))))
names(h24ob)<-c("Frequency","duration","hour","type")
h1ob<-data.frame(table(lengthEvents(filtersx(obsh1$effekt,hthres,hbreaks[1]))),rep("01",length(table(lengthEvents(filtersx(obsh1$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh1$effekt,hthres,hbreaks[1]))))))
names(h1ob)<-c("Frequency","duration","hour","type")
h2ob<-data.frame(table(lengthEvents(filtersx(obsh2$effekt,hthres,hbreaks[1]))),rep("02",length(table(lengthEvents(filtersx(obsh2$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh2$effekt,hthres,hbreaks[1]))))))
names(h2ob)<-c("Frequency","duration","hour","type")
h3ob<-data.frame(table(lengthEvents(filtersx(obsh3$effekt,hthres,hbreaks[1]))),rep("03",length(table(lengthEvents(filtersx(obsh3$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh3$effekt,hthres,hbreaks[1]))))))
names(h3ob)<-c("Frequency","duration","hour","type")
h4ob<-data.frame(table(lengthEvents(filtersx(obsh4$effekt,hthres,hbreaks[1]))),rep("04",length(table(lengthEvents(filtersx(obsh4$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh4$effekt,hthres,hbreaks[1]))))))
names(h4ob)<-c("Frequency","duration","hour","type")
h5ob<-data.frame(table(lengthEvents(filtersx(obsh5$effekt,hthres,hbreaks[1]))),rep("05",length(table(lengthEvents(filtersx(obsh5$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh5$effekt,hthres,hbreaks[1]))))))
names(h5ob)<-c("Frequency","duration","hour","type")
h6ob<-data.frame(table(lengthEvents(filtersx(obsh6$effekt,hthres,hbreaks[1]))),rep("06",length(table(lengthEvents(filtersx(obsh6$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh6$effekt,hthres,hbreaks[1]))))))
names(h6ob)<-c("Frequency","duration","hour","type")
h7ob<-data.frame(table(lengthEvents(filtersx(obsh7$effekt,hthres,hbreaks[1]))),rep("07",length(table(lengthEvents(filtersx(obsh7$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh7$effekt,hthres,hbreaks[1]))))))
names(h7ob)<-c("Frequency","duration","hour","type")
h8ob<-data.frame(table(lengthEvents(filtersx(obsh8$effekt,hthres,hbreaks[1]))),rep("08",length(table(lengthEvents(filtersx(obsh8$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh8$effekt,hthres,hbreaks[1]))))))
names(h8ob)<-c("Frequency","duration","hour","type")
h9ob<-data.frame(table(lengthEvents(filtersx(obsh9$effekt,hthres,hbreaks[1]))),rep("09",length(table(lengthEvents(filtersx(obsh9$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh9$effekt,hthres,hbreaks[1]))))))
names(h9ob)<-c("Frequency","duration","hour","type")
h10ob<-data.frame(table(lengthEvents(filtersx(obsh10$effekt,hthres,hbreaks[1]))),rep("10",length(table(lengthEvents(filtersx(obsh10$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh10$effekt,hthres,hbreaks[1]))))))
names(h10ob)<-c("Frequency","duration","hour","type")
h11ob<-data.frame(table(lengthEvents(filtersx(obsh11$effekt,hthres,hbreaks[1]))),rep("11",length(table(lengthEvents(filtersx(obsh11$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh11$effekt,hthres,hbreaks[1]))))))
names(h11ob)<-c("Frequency","duration","hour","type")
h12ob<-data.frame(table(lengthEvents(filtersx(obsh12$effekt,hthres,hbreaks[1]))),rep("12",length(table(lengthEvents(filtersx(obsh12$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh12$effekt,hthres,hbreaks[1]))))))
names(h12ob)<-c("Frequency","duration","hour","type")
h13ob<-data.frame(table(lengthEvents(filtersx(obsh13$effekt,hthres,hbreaks[1]))),rep("13",length(table(lengthEvents(filtersx(obsh13$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh13$effekt,hthres,hbreaks[1]))))))
names(h13ob)<-c("Frequency","duration","hour","type")
h14ob<-data.frame(table(lengthEvents(filtersx(obsh14$effekt,hthres,hbreaks[1]))),rep("14",length(table(lengthEvents(filtersx(obsh14$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh14$effekt,hthres,hbreaks[1]))))))
names(h14ob)<-c("Frequency","duration","hour","type")
h15ob<-data.frame(table(lengthEvents(filtersx(obsh15$effekt,hthres,hbreaks[1]))),rep("15",length(table(lengthEvents(filtersx(obsh15$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh15$effekt,hthres,hbreaks[1]))))))
names(h15ob)<-c("Frequency","duration","hour","type")
h16ob<-data.frame(table(lengthEvents(filtersx(obsh16$effekt,hthres,hbreaks[1]))),rep("16",length(table(lengthEvents(filtersx(obsh16$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh16$effekt,hthres,hbreaks[1]))))))
names(h16ob)<-c("Frequency","duration","hour","type")
h17ob<-data.frame(table(lengthEvents(filtersx(obsh17$effekt,hthres,hbreaks[1]))),rep("17",length(table(lengthEvents(filtersx(obsh17$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh17$effekt,hthres,hbreaks[1]))))))
names(h17ob)<-c("Frequency","duration","hour","type")
h18ob<-data.frame(table(lengthEvents(filtersx(obsh18$effekt,hthres,hbreaks[1]))),rep("18",length(table(lengthEvents(filtersx(obsh18$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh18$effekt,hthres,hbreaks[1]))))))
names(h18ob)<-c("Frequency","duration","hour","type")
h19ob<-data.frame(table(lengthEvents(filtersx(obsh19$effekt,hthres,hbreaks[1]))),rep("19",length(table(lengthEvents(filtersx(obsh19$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh19$effekt,hthres,hbreaks[1]))))))
names(h19ob)<-c("Frequency","duration","hour","type")
h20ob<-data.frame(table(lengthEvents(filtersx(obsh20$effekt,hthres,hbreaks[1]))),rep("20",length(table(lengthEvents(filtersx(obsh20$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh20$effekt,hthres,hbreaks[1]))))))
names(h20ob)<-c("Frequency","duration","hour","type")
h21ob<-data.frame(table(lengthEvents(filtersx(obsh21$effekt,hthres,hbreaks[1]))),rep("21",length(table(lengthEvents(filtersx(obsh21$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh21$effekt,hthres,hbreaks[1]))))))
names(h21ob)<-c("Frequency","duration","hour","type")
h22ob<-data.frame(table(lengthEvents(filtersx(obsh22$effekt,hthres,hbreaks[1]))),rep("22",length(table(lengthEvents(filtersx(obsh22$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh22$effekt,hthres,hbreaks[1]))))))
names(h22ob)<-c("Frequency","duration","hour","type")
h23ob<-data.frame(table(lengthEvents(filtersx(obsh23$effekt,hthres,hbreaks[1]))),rep("23",length(table(lengthEvents(filtersx(obsh23$effekt,hthres,hbreaks[1]))))),rep("Observations",length(table(lengthEvents(filtersx(obsh23$effekt,hthres,hbreaks[1]))))))
names(h23ob)<-c("Frequency","duration","hour","type")

h24<-data.frame(table(lengthEvents(filtersx(modho24$effekt,hthres,hbreaks[1]))),rep("24",length(table(lengthEvents(filtersx(modho24$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho24$effekt,hthres,hbreaks[1]))))))
names(h24)<-c("Frequency","duration","hour","type")
h1<-data.frame(table(lengthEvents(filtersx(modho1$effekt,hthres,hbreaks[1]))),rep("01",length(table(lengthEvents(filtersx(modho1$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho1$effekt,hthres,hbreaks[1]))))))
names(h1)<-c("Frequency","duration","hour","type")
h2<-data.frame(table(lengthEvents(filtersx(modho2$effekt,hthres,hbreaks[1]))),rep("02",length(table(lengthEvents(filtersx(modho2$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho2$effekt,hthres,hbreaks[1]))))))
names(h2)<-c("Frequency","duration","hour","type")
h3<-data.frame(table(lengthEvents(filtersx(modho3$effekt,hthres,hbreaks[1]))),rep("03",length(table(lengthEvents(filtersx(modho3$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho3$effekt,hthres,hbreaks[1]))))))
names(h3)<-c("Frequency","duration","hour","type")
h4<-data.frame(table(lengthEvents(filtersx(modho4$effekt,hthres,hbreaks[1]))),rep("04",length(table(lengthEvents(filtersx(modho4$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho4$effekt,hthres,hbreaks[1]))))))
names(h4)<-c("Frequency","duration","hour","type")
h5<-data.frame(table(lengthEvents(filtersx(modho5$effekt,hthres,hbreaks[1]))),rep("05",length(table(lengthEvents(filtersx(modho5$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho5$effekt,hthres,hbreaks[1]))))))
names(h5)<-c("Frequency","duration","hour","type")
h6<-data.frame(table(lengthEvents(filtersx(modho6$effekt,hthres,hbreaks[1]))),rep("06",length(table(lengthEvents(filtersx(modho6$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho6$effekt,hthres,hbreaks[1]))))))
names(h6)<-c("Frequency","duration","hour","type")
h7<-data.frame(table(lengthEvents(filtersx(modho7$effekt,hthres,hbreaks[1]))),rep("07",length(table(lengthEvents(filtersx(modho7$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho7$effekt,hthres,hbreaks[1]))))))
names(h7)<-c("Frequency","duration","hour","type")
h8<-data.frame(table(lengthEvents(filtersx(modho8$effekt,hthres,hbreaks[1]))),rep("08",length(table(lengthEvents(filtersx(modho8$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho8$effekt,hthres,hbreaks[1]))))))
names(h8)<-c("Frequency","duration","hour","type")
h9<-data.frame(table(lengthEvents(filtersx(modho9$effekt,hthres,hbreaks[1]))),rep("09",length(table(lengthEvents(filtersx(modho9$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho9$effekt,hthres,hbreaks[1]))))))
names(h9)<-c("Frequency","duration","hour","type")
h10<-data.frame(table(lengthEvents(filtersx(modho10$effekt,hthres,hbreaks[1]))),rep("10",length(table(lengthEvents(filtersx(modho10$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho10$effekt,hthres,hbreaks[1]))))))
names(h10)<-c("Frequency","duration","hour","type")
h11<-data.frame(table(lengthEvents(filtersx(modho11$effekt,hthres,hbreaks[1]))),rep("11",length(table(lengthEvents(filtersx(modho11$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho11$effekt,hthres,hbreaks[1]))))))
names(h11)<-c("Frequency","duration","hour","type")
h12<-data.frame(table(lengthEvents(filtersx(modho12$effekt,hthres,hbreaks[1]))),rep("12",length(table(lengthEvents(filtersx(modho12$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho12$effekt,hthres,hbreaks[1]))))))
names(h12)<-c("Frequency","duration","hour","type")
h13<-data.frame(table(lengthEvents(filtersx(modho13$effekt,hthres,hbreaks[1]))),rep("13",length(table(lengthEvents(filtersx(modho13$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho13$effekt,hthres,hbreaks[1]))))))
names(h13)<-c("Frequency","duration","hour","type")
h14<-data.frame(table(lengthEvents(filtersx(modho14$effekt,hthres,hbreaks[1]))),rep("14",length(table(lengthEvents(filtersx(modho14$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho14$effekt,hthres,hbreaks[1]))))))
names(h14)<-c("Frequency","duration","hour","type")
h15<-data.frame(table(lengthEvents(filtersx(modho15$effekt,hthres,hbreaks[1]))),rep("15",length(table(lengthEvents(filtersx(modho15$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho15$effekt,hthres,hbreaks[1]))))))
names(h15)<-c("Frequency","duration","hour","type")
h16<-data.frame(table(lengthEvents(filtersx(modho16$effekt,hthres,hbreaks[1]))),rep("16",length(table(lengthEvents(filtersx(modho16$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho16$effekt,hthres,hbreaks[1]))))))
names(h16)<-c("Frequency","duration","hour","type")
h17<-data.frame(table(lengthEvents(filtersx(modho17$effekt,hthres,hbreaks[1]))),rep("17",length(table(lengthEvents(filtersx(modho17$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho17$effekt,hthres,hbreaks[1]))))))
names(h17)<-c("Frequency","duration","hour","type")
h18<-data.frame(table(lengthEvents(filtersx(modho18$effekt,hthres,hbreaks[1]))),rep("18",length(table(lengthEvents(filtersx(modho18$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho18$effekt,hthres,hbreaks[1]))))))
names(h18)<-c("Frequency","duration","hour","type")
h19<-data.frame(table(lengthEvents(filtersx(modho19$effekt,hthres,hbreaks[1]))),rep("19",length(table(lengthEvents(filtersx(modho19$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho19$effekt,hthres,hbreaks[1]))))))
names(h19)<-c("Frequency","duration","hour","type")
h20<-data.frame(table(lengthEvents(filtersx(modho20$effekt,hthres,hbreaks[1]))),rep("20",length(table(lengthEvents(filtersx(modho20$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho20$effekt,hthres,hbreaks[1]))))))
names(h20)<-c("Frequency","duration","hour","type")
h21<-data.frame(table(lengthEvents(filtersx(modho21$effekt,hthres,hbreaks[1]))),rep("21",length(table(lengthEvents(filtersx(modho21$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho21$effekt,hthres,hbreaks[1]))))))
names(h21)<-c("Frequency","duration","hour","type")
h22<-data.frame(table(lengthEvents(filtersx(modho22$effekt,hthres,hbreaks[1]))),rep("22",length(table(lengthEvents(filtersx(modho22$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho22$effekt,hthres,hbreaks[1]))))))
names(h22)<-c("Frequency","duration","hour","type")
h23<-data.frame(table(lengthEvents(filtersx(modho23$effekt,hthres,hbreaks[1]))),rep("23",length(table(lengthEvents(filtersx(modho23$effekt,hthres,hbreaks[1]))))),rep("Model",length(table(lengthEvents(filtersx(modho23$effekt,hthres,hbreaks[1]))))))
names(h23)<-c("Frequency","duration","hour","type")

hd<-as_tibble(rbind(h1, h2, h3,h4, h5, h6,h7, h8, h9,h10, h11, h12,h13, h14, h15,h16, h17, h18,h19, h20, h21,h22, h23, h24))
hdob<-as_tibble(rbind(h1ob, h2ob, h3ob,h4ob, h5ob, h6ob,h7ob, h8ob, h9ob,h10ob, h11ob, h12ob,h13ob, h14ob, h15ob,h16ob, h17ob, h18ob,h19ob, h20ob, h21ob,h22ob, h23ob, h24ob))
hdcom<-data.frame(rbind(hd,hdob))


p68 <- ggplot(data=hdcom, aes(x = hour, y = duration, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 13)+
  scale_color_manual(values=c("Model"="orange", "Observations"="green"))+
  facet_grid(.~type)+
  xlab("Hour") +
  ylab("Duration of Events(h)")
  
p68

ggsave(paste("",dir,"hhighfreqdurtot.png",sep=""))
print("saved 62.image")

########################## rarest events

########################## low generation monthly

monthsx<-c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")

perslowobs<-lengthEvents(filtersx(obs$effekt,lbreaks[1],-1))
lowobst<-obs[filtersx(obs$effekt,lbreaks[1],-1),]
ctc<-lowobst[c(1,(cumsum(perslowobs)+1)[1:(length(cumsum(perslowobs)+1)-1)])[1:length(perslowobs)],]

mn<-monthsx[as.numeric(unique(format(ctc$date,"%m")))]
lne<-aggregate(ctc$date,by=list(format(ctc$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc$date,"%m")))]
mn[as.numeric(unique(format(ctc$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc$date[which(as.numeric(format(ctc$date, "%m"))%in%unique(as.numeric(format(ctc$date,"%m"))))],by=list(format( ctc$date[which(as.numeric(format(ctc$date, "%m"))%in%unique(as.numeric(format(ctc$date,"%m"))))],"%m")),FUN=length)$x
lowgobs<<-as_tibble(data.frame(mn,lne))

#lowgobs<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc$date,"%m")))],aggregate(ctc$date,by=list(format(ctc$date,"%m")),FUN=length)$x))
names(lowgobs)<-c("months","lengths")
lowgobs$months<-factor(as.character(lowgobs$months), levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

perslow1obs<-lengthEvents(filtersx(obs$effekt,lbreaks[2],-1))
low1obst<-obs[filtersx(obs$effekt,lbreaks[2],-1),]
ctc1<-low1obst[c(1,(cumsum(perslow1obs)+1)[1:(length(cumsum(perslow1obs)+1)-1)])[1:length(perslow1obs)],]

mn<-monthsx[as.numeric(unique(format(ctc1$date,"%m")))]
lne<-aggregate(ctc1$date,by=list(format(ctc1$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc1$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc1$date,"%m")))]
mn[as.numeric(unique(format(ctc1$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc1$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc1$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc1$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc1$date[which(as.numeric(format(ctc1$date, "%m"))%in%unique(as.numeric(format(ctc1$date,"%m"))))],by=list(format( ctc1$date[which(as.numeric(format(ctc1$date, "%m"))%in%unique(as.numeric(format(ctc1$date,"%m"))))],"%m")),FUN=length)$x
lowg1obs<-as_tibble(data.frame(mn,lne))

#lowg1obs<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc1$date,"%m")))],aggregate(ctc1$date,by=list(format(ctc1$date,"%m")),FUN=length)$x))
names(lowg1obs)<-c("months","lengths")
lowg1obs$months<-factor(as.character(lowg1obs$months), levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

perslow2obs<-lengthEvents(filtersx(obs$effekt,lbreaks[3],-1))
low2obst<-obs[filtersx(obs$effekt,lbreaks[3],-1),]
ctc2<-low2obst[c(1,(cumsum(perslow2obs)+1)[1:(length(cumsum(perslow2obs)+1)-1)])[1:length(perslow2obs)],]

mn<-monthsx[as.numeric(unique(format(ctc2$date,"%m")))]
lne<-aggregate(ctc2$date,by=list(format(ctc2$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc2$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc2$date,"%m")))]
mn[as.numeric(unique(format(ctc2$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc2$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc2$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc2$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc2$date[which(as.numeric(format(ctc2$date, "%m"))%in%unique(as.numeric(format(ctc2$date,"%m"))))],by=list(format( ctc2$date[which(as.numeric(format(ctc2$date, "%m"))%in%unique(as.numeric(format(ctc2$date,"%m"))))],"%m")),FUN=length)$x
lowg2obs<-as_tibble(data.frame(mn,lne))

#lowg2obs<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc2$date,"%m")))],aggregate(ctc2$date,by=list(format(ctc2$date,"%m")),FUN=length)$x))
names(lowg2obs)<-c("months","lengths")
lowg2obs$months<-factor(as.character(lowg2obs$months), levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

perslowmod<-lengthEvents(filtersx(mod$effekt,lbreaks[1],-1))
lowmodt<-mod[filtersx(mod$effekt,lbreaks[1],-1),]
ctcmod<-lowmodt[c(1,(cumsum(perslowmod)+1)[1:(length(cumsum(perslowmod)+1)-1)])[1:length(perslowmod)],]

mn<-monthsx[as.numeric(unique(format(ctcmod$date,"%m")))]
lne<-aggregate(ctcmod$date,by=list(format(ctcmod$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctcmod$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctcmod$date,"%m")))]
mn[as.numeric(unique(format(ctcmod$date,"%m")))]<-monthsx[as.numeric(unique(format(ctcmod$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctcmod$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctcmod$date,"%m"))), decreasing = FALSE)]<-aggregate( ctcmod$date[which(as.numeric(format(ctcmod$date, "%m"))%in%unique(as.numeric(format(ctcmod$date,"%m"))))],by=list(format( ctcmod$date[which(as.numeric(format(ctcmod$date, "%m"))%in%unique(as.numeric(format(ctcmod$date,"%m"))))],"%m")),FUN=length)$x
lowgmod1<<-as_tibble(data.frame(mn,lne))

#lowgmod1<<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctcmod$date,"%m")))],aggregate(ctcmod$date,by=list(format(ctcmod$date,"%m")),FUN=length)$x))
names(lowgmod1)<-c("months","lengths")
lowgmod1$months<-factor(as.character(lowgmod1$months), levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

perslow1mod<-lengthEvents(filtersx(mod$effekt,lbreaks[2],-1))
low1modt<-mod[filtersx(mod$effekt,lbreaks[2],-1),]
ctc1mod<-low1modt[c(1,(cumsum(perslow1mod)+1)[1:(length(cumsum(perslow1mod)+1)-1)])[1:length(perslow1mod)],]

mn<-monthsx[as.numeric(unique(format(ctc1mod$date,"%m")))]
lne<-aggregate(ctc1mod$date,by=list(format(ctc1mod$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc1mod$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc1mod$date,"%m")))]
mn[as.numeric(unique(format(ctc1mod$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc1mod$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc1mod$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc1mod$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc1mod$date[which(as.numeric(format(ctc1mod$date, "%m"))%in%unique(as.numeric(format(ctc1mod$date,"%m"))))],by=list(format( ctc1mod$date[which(as.numeric(format(ctc1mod$date, "%m"))%in%unique(as.numeric(format(ctc1mod$date,"%m"))))],"%m")),FUN=length)$x
low1gmod<-as_tibble(data.frame(mn,lne))

#aggregate(ctc1mod$date,by=list(format(ctc1mod$date,"%m")),FUN=length)
#low1gmod<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc1mod$date,"%m")))],aggregate(ctc1mod$date,by=list(format(ctc1mod$date,"%m")),FUN=length)$x))
names(low1gmod)<-c("months","lengths")
low1gmod$months<-factor(low1gmod$months, levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

perslow2mod<-lengthEvents(filtersx(mod$effekt,lbreaks[3],-1))
low2modt<-mod[filtersx(mod$effekt,lbreaks[3],-1),]
ctc2mod<-low2modt[c(1,(cumsum(perslow2mod)+1)[1:(length(cumsum(perslow2mod)+1)-1)])[1:length(perslow2mod)],]

mn<-monthsx[as.numeric(unique(format(ctc2mod$date,"%m")))]
lne<-aggregate(ctc2mod$date,by=list(format(ctc2mod$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc2mod$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc2mod$date,"%m")))]
mn[as.numeric(unique(format(ctc2mod$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc2mod$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc2mod$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc2mod$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc2mod$date[which(as.numeric(format(ctc2mod$date, "%m"))%in%unique(as.numeric(format(ctc2mod$date,"%m"))))],by=list(format( ctc2mod$date[which(as.numeric(format(ctc2mod$date, "%m"))%in%unique(as.numeric(format(ctc2mod$date,"%m"))))],"%m")),FUN=length)$x
low2gmod<-as_tibble(data.frame(mn,lne))

#aggregate(ctc2mod$date,by=list(format(ctc2mod$date,"%m")),FUN=length)
#low2gmod<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc2mod$date,"%m")))],aggregate(ctc2mod$date,by=list(format(ctc2mod$date,"%m")),FUN=length)$x))
names(low2gmod)<-c("months","lengths")
low2gmod$months<-factor(low2gmod$months, levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

#aggregate(low2obst$date,by =list(format(low2obst$date,"%m")),FUN = function(x){NROW(x)})

# p37 <- ggplot() +
#   geom_line(data=lowgmod1, aes(x = months, y = lengths,colour = l1, linetype = "Model",group=1),size=1)+
#   geom_line(data=lowgobs, aes(x = months, y = lengths,colour = l1, linetype = "Observations",group=1),size=1)+
#   theme(legend.title=element_blank())+
#   scale_color_manual(values=c(l1="green", l2="grey",l3="orange"))+
#   scale_linetype_manual(values=c("Observations"="dashed", "Model"="solid"))+
#   xlab("Month") +
#   ylab("Frequency")
#   
# p37
# 
# ggsave(paste("",dir,"pp.png",sep=""))

p37 <- ggplot() +
  geom_line(data=lowgmod1, aes(x = months, y = lengths,colour = "Model",group=1),size=1)+
  geom_line(data=lowgobs, aes(x = months, y = lengths,colour = "Observations",group=1),size=1)+
  theme(legend.title=element_blank())+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  xlab("Month") +
  ylab("Frequency")
  
p37

ggsave(paste("",dir,"lowcap1freqmon.png",sep=""))
print("saved 63.image")

p38 <- ggplot() +
  geom_line(data=low2gmod, aes(x = months, y = lengths,colour = "Model" ,group=1),size=1)+
  geom_line(data=lowg2obs, aes(x = months, y = lengths,colour = "Observations",group=1),size=1)+
  theme(legend.title=element_blank())+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  xlab("Month") +
  ylab("Frequency")
  
p38

ggsave(paste("",dir,"lowcap3freqmon.png",sep=""))
print("saved 64.image")

p69<- ggplot() +
  geom_line(data=aggregate(low2modt$date,by =list(format(low2modt$date,"%m")),FUN = function(x){NROW(x)}), aes(x = Group.1, y = x,colour = "Model",group=1),size=1)+
  geom_line(data=aggregate(low2obst$date,by =list(format(low2obst$date,"%m")),FUN = function(x){NROW(x)}), aes(x = Group.1, y = x,colour = "Observations",group=1),size=1)+
  theme(legend.title=element_blank())+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  xlab("Month") +
  ylab("Frequency")

p69

ggsave(paste("",dir,"mlowcapfreqtot.png",sep=""))
print("saved 65.image")

p39 <- ggplot() +
  geom_line(data=low1gmod, aes(x = months, y = lengths,colour = "Model",group=1),size=1)+
  geom_line(data=lowg1obs, aes(x = months, y = lengths,colour = "Observations",group=1),size=1)+
  theme(legend.title=element_blank())+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  xlab("Month") +
  ylab("Frequency")
  
p39

ggsave(paste("",dir,"lowcap2freqmon.png",sep=""))
print("saved 66.image")

############################## high generation monthly

pershighobs<-lengthEvents(filtersx(obs$effekt,hthres,hbreaks[3]))
highobst<-obs[filtersx(obs$effekt,hthres,hbreaks[3]),]
ctc<-highobst[c(1,(cumsum(pershighobs)+1)[1:(length(cumsum(pershighobs)+1)-1)])[1:length(pershighobs)],]

mn<-monthsx[as.numeric(unique(format(ctc$date,"%m")))]
lne<-aggregate(ctc$date,by=list(format(ctc$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc$date,"%m")))]
mn[as.numeric(unique(format(ctc$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc$date[which(as.numeric(format(ctc$date, "%m"))%in%unique(as.numeric(format(ctc$date,"%m"))))],by=list(format( ctc$date[which(as.numeric(format(ctc$date, "%m"))%in%unique(as.numeric(format(ctc$date,"%m"))))],"%m")),FUN=length)$x
highgobs<-as_tibble(data.frame(mn,lne))

#highgobs<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc$date,"%m")))],aggregate(ctc$date,by=list(format(ctc$date,"%m")),FUN=length)$x))
names(highgobs)<-c("months","lengths")
highgobs$months<-factor(highgobs$months, levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

pershigh1obs<-lengthEvents(filtersx(obs$effekt,hthres,hbreaks[2]))
high1obst<-obs[filtersx(obs$effekt,hthres,hbreaks[2]),]
ctc1<-high1obst[c(1,(cumsum(pershigh1obs)+1)[1:(length(cumsum(pershigh1obs)+1)-1)])[1:length(pershigh1obs)],]

mn<-monthsx[as.numeric(unique(format(ctc1$date,"%m")))]
lne<-aggregate(ctc1$date,by=list(format(ctc1$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc1$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc1$date,"%m")))]
mn[as.numeric(unique(format(ctc1$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc1$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc1$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc1$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc1$date[which(as.numeric(format(ctc1$date, "%m"))%in%unique(as.numeric(format(ctc1$date,"%m"))))],by=list(format( ctc1$date[which(as.numeric(format(ctc1$date, "%m"))%in%unique(as.numeric(format(ctc1$date,"%m"))))],"%m")),FUN=length)$x
highg1obs<-as_tibble(data.frame(mn,lne))

#highg1obs<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc1$date,"%m")))],aggregate(ctc1$date,by=list(format(ctc1$date,"%m")),FUN=length)$x))
names(highg1obs)<-c("months","lengths")
highg1obs$months<-factor(highg1obs$months, levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))


pershigh2obs<-lengthEvents(filtersx(obs$effekt,hthres,hbreaks[1]))
high2obst<-obs[filtersx(obs$effekt,hthres,hbreaks[1]),]
ctc2<-high2obst[c(1,(cumsum(pershigh2obs)+1)[1:(length(cumsum(pershigh2obs)+1)-1)])[1:length(pershigh2obs)],]

mn<-monthsx[as.numeric(unique(format(ctc2$date,"%m")))]
lne<-aggregate(ctc2$date,by=list(format(ctc2$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc2$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc2$date,"%m")))]
mn[as.numeric(unique(format(ctc2$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc2$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc2$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc2$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc2$date[which(as.numeric(format(ctc2$date, "%m"))%in%unique(as.numeric(format(ctc2$date,"%m"))))],by=list(format( ctc2$date[which(as.numeric(format(ctc2$date, "%m"))%in%unique(as.numeric(format(ctc2$date,"%m"))))],"%m")),FUN=length)$x
highg2obs<-as_tibble(data.frame(mn,lne))

#highg2obs<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc2$date,"%m")))],aggregate(ctc2$date,by=list(format(ctc2$date,"%m")),FUN=length)$x))
names(highg2obs)<-c("months","lengths")
highg2obs$months<-factor(highg2obs$months, levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))


pershighmod<-lengthEvents(filtersx(mod$effekt,hthres,hbreaks[3]))
highmodt<-mod[filtersx(mod$effekt,hthres,hbreaks[3]),]
ctcmod<-highmodt[c(1,(cumsum(pershighmod)+1)[1:(length(cumsum(pershighmod)+1)-1)])[1:length(pershighmod)],]

mn<-monthsx[as.numeric(unique(format(ctcmod$date,"%m")))]
lne<-aggregate(ctcmod$date,by=list(format(ctcmod$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctcmod$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctcmod$date,"%m")))]
mn[as.numeric(unique(format(ctcmod$date,"%m")))]<-monthsx[as.numeric(unique(format(ctcmod$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctcmod$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctcmod$date,"%m"))), decreasing = FALSE)]<-aggregate( ctcmod$date[which(as.numeric(format(ctcmod$date, "%m"))%in%unique(as.numeric(format(ctcmod$date,"%m"))))],by=list(format( ctcmod$date[which(as.numeric(format(ctcmod$date, "%m"))%in%unique(as.numeric(format(ctcmod$date,"%m"))))],"%m")),FUN=length)$x
highgmod1<-as_tibble(data.frame(mn,lne))

#highgmod1<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctcmod$date,"%m")))],aggregate(ctcmod$date,by=list(format(ctcmod$date,"%m")),FUN=length)$x))
names(highgmod1)<-c("months","lengths")
highgmod1$months<-factor(highgmod1$months, levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

pershigh1mod<-lengthEvents(filtersx(mod$effekt,hthres,hbreaks[2]))
high1modt<-mod[filtersx(mod$effekt,hthres,hbreaks[2]),]
ctc1mod<-high1modt[c(1,(cumsum(pershigh1mod)+1)[1:(length(cumsum(pershigh1mod)+1)-1)])[1:length(pershigh1mod)],]

mn<-monthsx[as.numeric(unique(format(ctc1mod$date,"%m")))]
lne<-aggregate(ctc1mod$date,by=list(format(ctc1mod$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc1mod$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc1mod$date,"%m")))]
mn[as.numeric(unique(format(ctc1mod$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc1mod$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc1mod$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc1mod$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc1mod$date[which(as.numeric(format(ctc1mod$date, "%m"))%in%unique(as.numeric(format(ctc1mod$date,"%m"))))],by=list(format( ctc1mod$date[which(as.numeric(format(ctc1mod$date, "%m"))%in%unique(as.numeric(format(ctc1mod$date,"%m"))))],"%m")),FUN=length)$x
high1gmod<-as_tibble(data.frame(mn,lne))

#high1gmod<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc1mod$date,"%m")))],aggregate(ctc1mod$date,by=list(format(ctc1mod$date,"%m")),FUN=length)$x))
names(high1gmod)<-c("months","lengths")
high1gmod$months<-factor(high1gmod$months, levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

pershigh2mod<-lengthEvents(filtersx(mod$effekt,hthres,hbreaks[1]))
high2modt<-mod[filtersx(mod$effekt,hthres,hbreaks[1]),]
ctc2mod<-high2modt[c(1,(cumsum(pershigh2mod)+1)[1:(length(cumsum(pershigh2mod)+1)-1)])[1:length(pershigh2mod)],]

mn<-monthsx[as.numeric(unique(format(ctc2mod$date,"%m")))]
lne<-aggregate(ctc2mod$date,by=list(format(ctc2mod$date,"%m")),FUN=length)$x
mn[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc2mod$date,"%m")))])]<-monthsx[-as.numeric(unique(format(ctc2mod$date,"%m")))]
mn[as.numeric(unique(format(ctc2mod$date,"%m")))]<-monthsx[as.numeric(unique(format(ctc2mod$date,"%m")))]
lne[which(monthsx%in%monthsx[-as.numeric(unique(format(ctc2mod$date,"%m")))])]<-0
lne[sort(as.numeric(unique(format(ctc2mod$date,"%m"))), decreasing = FALSE)]<-aggregate( ctc2mod$date[which(as.numeric(format(ctc2mod$date, "%m"))%in%unique(as.numeric(format(ctc2mod$date,"%m"))))],by=list(format( ctc2mod$date[which(as.numeric(format(ctc2mod$date, "%m"))%in%unique(as.numeric(format(ctc2mod$date,"%m"))))],"%m")),FUN=length)$x
high2gmod<-as_tibble(data.frame(mn,lne))

#high2gmod<-as_tibble(data.frame(monthsx[as.numeric(unique(format(ctc2mod$date,"%m")))],aggregate(ctc2mod$date,by=list(format(ctc2mod$date,"%m")),FUN=length)$x))
names(high2gmod)<-c("months","lengths")
high2gmod$months<-factor(high2gmod$months, levels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

p40 <- ggplot() +
  geom_line(data=highgmod1, aes(x = months, y = lengths,colour = "Model",group=1),size=1)+
  geom_line(data=highgobs, aes(x = months, y = lengths,colour = "Observations",group=1),size=1)+
  theme(legend.title=element_blank())+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  xlab("Month") +
  ylab("Frequency")
  
p40

ggsave(paste("",dir,"highcap3freqmon.png",sep=""))
print("saved 67.image")

p41 <- ggplot() +
  geom_line(data=high2gmod, aes(x = months, y = lengths,colour = "Model", group=1),size=1)+
  geom_line(data=highg2obs, aes(x = months, y = lengths,colour = "Observations", group=1),size=1)+
  theme(legend.title=element_blank())+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  xlab("Month") +
  ylab("Frequency")

  
p41

ggsave(paste("",dir,"highcap1freqmon.png",sep=""))
print("saved 68.image")

p70<- ggplot() +
  geom_line(data=aggregate(high2modt$date,by =list(format(high2modt$date,"%m")),FUN = function(x){NROW(x)}), aes(x = Group.1, y = x,colour = "Model",group=1),size=1)+
  geom_line(data=aggregate(high2obst$date,by =list(format(high2obst$date,"%m")),FUN = function(x){NROW(x)}), aes(x = Group.1, y = x,colour = "Observations",group=1),size=1)+
  theme(legend.title=element_blank())+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  xlab("Month") +
  ylab("Frequency")

p70

ggsave(paste("",dir,"mhighcapfreqtot.png",sep=""))
print("saved 69.image")

p42 <- ggplot() +
  geom_line(data=high1gmod, aes(x = months, y = lengths,colour = "Model",group=1),size=1)+
  geom_line(data=highg1obs, aes(x = months, y = lengths,colour = "Observations",group=1),size=1)+
  theme(legend.title=element_blank())+
  scale_color_manual(values=c("Observations"="green","Model"="orange"))+
  xlab("Month") +
  ylab("Frequency")
  
p42

ggsave(paste("",dir,"highcap2freqmon.png",sep=""))
print("saved 70.image")

############################## rarest events (optional)

a <- rle(perslowmod)
b <- data.frame(length=a$lengths, values=a$values)
c<-aggregate(b, by=list(b$values), FUN=sum)
cx<-c[which(c$length<2),]
breaksr <- seq(1, max(cx$values), by=10) 
persduration.cutr <- cut(cx$values, breaksr, right=FALSE) 
persduration.freqr <- c(table(persduration.cutr),0)
lowmodr<-as_tibble(data.frame(breaksr,persduration.freqr))

#l1mr<-data.frame(lowmodr, rep(l1,length(lowmodr$breaksr)), rep("Model",length(lowmodr$breaksr)))
names(l1mr)<-c("breaks","Frequency","CF","type")

a <- rle(perslow1mod)
b <- data.frame(length=a$lengths, values=a$values)
c<-aggregate(b, by=list(b$values), FUN=sum)
cx<-c[which(c$length<2),]
breaks1r = seq(1, max(cx$values), by=10) 
persduration.cut1r = cut(cx$values, breaks1r, right=FALSE) 
persduration.freq1r = c(table(persduration.cut1r),0)
low1modr<-as_tibble(data.frame(breaks1r,persduration.freq1r))

l2mr<-data.frame(low1modr, rep(l2,length(low1modr$breaks1r)), rep("Model",length(low1modr$breaks1r)))
names(l2mr)<-c("breaks","Frequency","CF","type")

a <- rle(perslow2mod)
b <- data.frame(length=a$lengths, values=a$values)
c<-aggregate(b, by=list(b$values), FUN=sum)
cx<-c[which(c$length<2),]
breaks2r = seq(1, max(cx$values), by=10) 
persduration.cut2x = cut(cx$values, breaks2r, right=FALSE) 
persduration.freq2x = c(table(persduration.cut2x),0)
low2modr<-as_tibble(data.frame(breaks2r,persduration.freq2x))

l3mr<-data.frame(low2modr, rep(l3,length(low2modr$breaks2r)), rep("Model",length(low2modr$breaks2r)))
names(l3mr)<-c("breaks","Frequency","CF","type")

a <- rle(perslowobs)
b <- data.frame(length=a$lengths, values=a$values)
c<-aggregate(b, by=list(b$values), FUN=sum)
cx<-c[which(c$length<2),]
breaksor = seq(1, max(cx$values), by=10) 
persduration.cutr = cut(cx$values, breaksor, right=FALSE) 
persduration.freqr = c(table(persduration.cutr),0)
lowobsr<-as_tibble(data.frame(breaksor,persduration.freqr))

l1or<-data.frame(lowobsr, rep(l1,length(lowobsr$breaksor)), rep("Observations",length(lowobsr$breaksor)))
names(l1or)<-c("breaks","Frequency","CF","type")

a <- rle(perslow1obs)
b <- data.frame(length=a$lengths, values=a$values)
c<-aggregate(b, by=list(b$values), FUN=sum)
cx<-c[which(c$length<2),]
breaks1or = seq(1, max(cx$values), by=10) 
persduration.cut1r = cut(cx$values, breaks1or, right=FALSE) 
persduration.freq1r = c(table(persduration.cut1r),0)
low1obsr<-as_tibble(data.frame(breaks1or,persduration.freq1r))

l2or<-data.frame(low1obsr, rep(l2,length(low1obsr$breaks1or)), rep("Observations",length(low1obsr$breaks1or))) 
names(l2or)<-c("breaks","Frequency","CF","type")

a <- rle(perslow2obs)
b <- data.frame(length=a$lengths, values=a$values)
c<-aggregate(b, by=list(b$values), FUN=sum)
cx<-c[which(c$length<2),]
breaks2or <- seq(1, max(cx$values), by=10) 
persduration.cut2x <- cut(cx$values, breaks2or, right=FALSE) 
persduration.freq2x <- c(table(persduration.cut2x),0)
low2obsr<-as_tibble(data.frame(breaks2or,persduration.freq2x))

l3or<-data.frame(low2obsr, rep(l3,length(low2obsr$breaks2or)), rep("Observations",length(low2obsr$breaks2or)))
names(l3or)<-c("breaks","Frequency","CF","type")

lowr<-rbind(l1mr,l2mr,l3mr,l1or,l2or,l3or)


theme<-theme_set(theme_grey(base_size = 17))


p36 <- ggplot(data=lowr[which(lowr$Frequency!=0),], aes(x = CF, y = breaks, z = Frequency)) +
  geom_tile(aes(fill = Frequency)) +
  theme_grey(base_size = 17)+
  facet_grid(.~type)+
  xlab(paste(unit,"Threshold")) +
  ylab("Duration of Events(h)")
  
p36+
  theme_grey(base_size = 17)

ggsave(paste("",dir,"p36.png",sep=""))
print("saved 71.image")

theme<-theme_set(theme_classic(base_size = 17))

theme_set(theme_classic(base_size = 10))
p36
ggsave(paste("",dir,"ptst.png",sep=""))
print("saved 72.image")

}

}
